[
  {
    "title": "Front Matter",
    "slug": "front-matter",
    "content": "<p>Build a SmartSite is a guide to Web Development.</p><p>The purpose of <code>smartsite</code> is to provide interested individuals with a launch point for building a personal web application.</p><p>Before beginning, the individual must be able to:</p><ol type=\"a\">  <li>Download and install programs</li>  <li>Browse the internet</li>  <li>Use the command-line interface</li></ol><p>Using the command-line interface is likely the least familiar of the skills.Luckily, commands that are <strong>necessary</strong> for building the applicationwill be given by the walkthrough. Still, because the command-line will be one of the primary development tools, beginner level proficiency is recommended.</p><p>The guides will present a path of Node.js web development that it known to work.Differences in operating system and setup may require modifications to the instructions.</p><h2 id=\"theprocess\">The Process</h2><p>There is One Step:</p><ol><li>Follow the Walkthrough</li></ol>",
    "sectionType": "part",
    "sequence": 0,
    "parentSectionId": null,
    "preview": true,
    "childSections": [
      {
        "title": "Introduction",
        "slug": "introduction",
        "content": "<h2 id=\"howtoreadthewalkthrough\">How to Follow the Walkthrough</h2><p>The Walkthrough is presented in three sections:</p><ul><li>Setup</li><li>Basics</li><li>Features</li></ul><h3 id=\"setup\">Setup</h3><p>The Setup section ensures the developer has the required librariesand programs installed. Anyone who has been developing web applicationsfor any amount of time may already have libraries like Node.js and PostgreSQL installed.Regardless, go through the setup steps to ensure parity with the example application.</p><h3 id=\"thebasics\">The Basics</h3><p>The Basics covers the key building blocks for creating a web application.</p><ul><li>Deliver static HTML pages</li><li>Deliver dynamically rendered content</li><li>Provide interactive front-end content</li><li>Connect to a database</li><li>Save user information in the database</li></ul><p>After completing the Basics, the developer will have completed building afull-fledged Web 2.0 application. With curiosity and initiative, any type of webapplication can be built from the skills and tools outlined in the Basics.</p><h3 id=\"features\">Features</h3><p>The third section, Features, is an exploration of the range of applicationscan be built from the tooling of the Basics. Features contains walkthroughsfor extending the functionality of smartsite.</p><p>The Features are standalone front-end or full-stack modules that can be completed in any order.</p><h2 id=\"howtobegin\">How to Begin</h2><p>Begin with the <strong>Setup</strong> instructions -- install the libraries and run the Node installation commands.</p><p>As you continue through the tutorial, what began as a directory with not much more than a walkthrough blossoms into a featured and interactive web application. This application can serve as your personal site, small-business database system, or become a product prototype.</p><h2 id=\"whatnext\">What Next</h2><p>After you've comepleted building out <code>smartsite</code>, you will have the tools of web development in hand. With the skills, you can:</p><ul><li>Provide value on the internet with your app ideas</li><li>Continue learning web development in pursuit of a career in software</li><li>Prototype the next Big Idea</li></ul><p>If you find yourself building out cool new features in your <code>smartsite</code>, aid future learners by contributing a walkthrough to the <code>smartsite</code> parent repository. Contributions will be added to the <strong>Features</strong> section as an optional <code>smartsite</code> add-on. Thanks in advance!</p><p>Cheers and Happy Building.<br> -The Author</p>",
        "sectionType": "chapter",
        "sequence": 1,
        "parentSection": {
          "parentSectionPart": 0,
          "parentSectionType": "part",
          "parentSectionSequence": 0
        }
      }
    ]
  },
  {
    "title": "Introduction",
    "slug": "introduction",
    "content": "<h2 id=\"howtoreadthewalkthrough\">How to Follow the Walkthrough</h2><p>The Walkthrough is presented in three sections:</p><ul><li>Setup</li><li>Basics</li><li>Features</li></ul><h3 id=\"setup\">Setup</h3><p>The Setup section ensures the developer has the required librariesand programs installed. Anyone who has been developing web applicationsfor any amount of time may already have libraries like Node.js and PostgreSQL installed.Regardless, go through the setup steps to ensure parity with the example application.</p><h3 id=\"thebasics\">The Basics</h3><p>The Basics covers the key building blocks for creating a web application.</p><ul><li>Deliver static HTML pages</li><li>Deliver dynamically rendered content</li><li>Provide interactive front-end content</li><li>Connect to a database</li><li>Save user information in the database</li></ul><p>After completing the Basics, the developer will have completed building afull-fledged Web 2.0 application. With curiosity and initiative, any type of webapplication can be built from the skills and tools outlined in the Basics.</p><h3 id=\"features\">Features</h3><p>The third section, Features, is an exploration of the range of applicationscan be built from the tooling of the Basics. Features contains walkthroughsfor extending the functionality of smartsite.</p><p>The Features are standalone front-end or full-stack modules that can be completed in any order.</p><h2 id=\"howtobegin\">How to Begin</h2><p>Begin with the <strong>Setup</strong> instructions -- install the libraries and run the Node installation commands.</p><p>As you continue through the tutorial, what began as a directory with not much more than a walkthrough blossoms into a featured and interactive web application. This application can serve as your personal site, small-business database system, or become a product prototype.</p><h2 id=\"whatnext\">What Next</h2><p>After you've comepleted building out <code>smartsite</code>, you will have the tools of web development in hand. With the skills, you can:</p><ul><li>Provide value on the internet with your app ideas</li><li>Continue learning web development in pursuit of a career in software</li><li>Prototype the next Big Idea</li></ul><p>If you find yourself building out cool new features in your <code>smartsite</code>, aid future learners by contributing a walkthrough to the <code>smartsite</code> parent repository. Contributions will be added to the <strong>Features</strong> section as an optional <code>smartsite</code> add-on. Thanks in advance!</p><p>Cheers and Happy Building.<br> -The Author</p>",
    "sectionType": "chapter",
    "sequence": 1,
    "parentSection": {
      "parentSectionPart": 0,
      "parentSectionType": "part",
      "parentSectionSequence": 0
    }
  },
  {
    "title": "Setup",
    "slug": "setup",
    "content": "<h2 id=\"readmemd\">README.md</h2><p>This section ensures the you have the required libraries and programs installed.</p><p>We will be installing:</p><ul><li>Git</li><li>The Node ecosystem: node.js, <code>npm</code> </li><li><code>nvm</code> (MacOS only)</li></ul><p>If you have been developing in JavaScript for a while, you may already have these programs installed. Still, read through the setup steps to ensure your system is in parity with the example setup.</p>",
    "sectionType": "part",
    "sequence": 1,
    "parentSectionId": null,
    "childSections": [
      {
        "title": "Git My-app",
        "slug": "git-my-app",
        "content": "## Git `smartsite`\nGit the only developer tool required before beginning this walkthrough. It's required for you to run the first command, `git clone`, and sync the starting directory to your local computer.\n\n### What is Git?\n\nImagine every time you made a change to a project, you had to make a brand new directory, copy your existing work into it, make changes in this totally new directory, then _somehow_ totally replace the old work with the new work both locally and in production when the changes are finished. In the early days of the internet, this was solved with creative use of file transport protocol (FTP). The Git program both solves the tedious workflow and improves on full-file, FTP syncing.\n\nGit is a version control management system that maintains what the software looked like in the past and what it looks like now. It keeps track of each incremental change to the codebase which allows for efficient filesystem syncing between local and remote environments by only applying the changeset at the time of sync.\n\nA collection of files that is being tracked by Git is called a repository. The files on hard disk are called the Working Directory.\n\nA repository is a virtual collection, the working directory is the filesystem a developer is modifying. As changes in the working directory are accepted to be code complete, they are added via command to the Git repository. The repository can then be synced between local environments and remote environments.\n\nThe Git development workflow also provides the ability to split-off (or \"branch\") new development work from a pre-established \"master\" branch. This allows the developer to build new features on top of the currently sanctified codebase, only adding the a new changeset. Once the new changes are approved, finalizing the changes into the existing project takes one command. If the new changes end up not being desirable, they can be reverted, discarded and/or saved for a later date.\n\nIn essence, Git takes snapshots of application files over time and allows developers to manage each snapshot independent of one another. There may be a revision on the developer's local computer, a different revision being visited by live traffic in production, and an entirely different revision up for development team review on a shared repository management system like Github.\n\n### 1. Install Git\n\nTo get Git, use the [official installation guide](https://git-scm.com/book/en/v2/Getting-Started-Installing-Git) (https://git-scm.com/book/en/v2/Getting-Started-Installing-Git).\n\n\nYou're done with Git installation when you can run `git --version` and be presented with your installed Git gersion.\n\n<div class=\"filename\">command line</div>\n\n```\n$ git --version\n```\n\n### 2. Clone `smartsite`\nThe `git clone` command downloads a git repository from the internet to a local working directory. Within the terminal, navigate to the directory you'd like to save `smartsite` and run `git clone`.\n\n<div class=\"filename\">command line</div>\n\n```\n$ cd path/to/parent_directory\n$ git clone https://github.com/popdemtech/smartsite.git\n$ cd smartsite\n```\n\nThis series of commands downloads `smartsite` and places the terminal in the `smartsite` directory.\n\nThe starting `smartsite` directory is just this walkthrough. Following the steps provided, you will build out a Node.js web server, and the nearly empty directory will blossom into an internet application of whatever you wish it to be.\n\nWe just gotta create the application now. Let's get to it.\n\n### Resources\nA Simple Guide to Git: [http://rogerdudler.github.io/git-guide/](http://rogerdudler.github.io/git-guide/)",
        "sectionType": "chapter",
        "sequence": 1,
        "parentSection": {
          "parentSectionPart": 1,
          "parentSectionType": "part",
          "parentSectionSequence": 1
        }
      },
      {
        "title": "Install Nodejs",
        "slug": "install-nodejs",
        "content": "## Install Node.js\n\nThis walkthrough will cover building a web server application using Node.js. While JavaScript was initially developed for and still maintains its scripting dominance in a browser environment, Node.js is a JS runtime for use outside of a browser.\n\nNode.js is an open source development platform for executing JavaScript code server-side. While JavaScript runs natively in a browser (i.e. client-side), Node.js provides developers the platform with which to build applications for a controlled environment that runs on a host computer (server-side), separate from the JavaScript that is delivered to the client's browser. In this way, a Node.js application is comparable to PHP, Java, and Ruby, and other application environments that handle web-traffic requests, but are not delivered to the client.\n\nWindows users see [Install Node.js on Windows].\n\nMacOS users, check out [Install Node.js on MacOS] for installation instructions.\n\nLinux users, search a trusted search engine with the phrase \"install node js linux\" to find what you need.",
        "sectionType": "chapter",
        "sequence": 2,
        "parentSection": {
          "parentSectionPart": 1,
          "parentSectionType": "part",
          "parentSectionSequence": 1
        }
      },
      {
        "title": "Install Nodejs Windows",
        "slug": "install-nodejs-windows",
        "content": "## Install Node.js on Windows\n\n### 1. Navigate to nodejs.org\n\n<p style=\"text-align:center\">\n  <img src=\"/assets/img/posts/install-nodejs-windows/walkthrough_0.png\" style=\"width:50%;min-width:320px;\" />\n</p>\n\nNavigate to [nodejs.org](https://nodejs.org) and select the version of node you want to download. Even number versions have Long-Term Support (LTS).\n\nLong-term support \"typically guarantees that critical bugs will be fixed for a total of 30 months.\" Production applications should use LTS versions. Use a more recent odd number version to test out latest features.\n\nRead more about node's release schedule in the Resources.\n\n### 2. Setup Wizard\n\n<p style=\"text-align:center\">\n  <img src=\"/assets/img/posts/install-nodejs-windows/walkthrough_1.png\" style=\"width:50%;min-width:320px;\" />\n</p>\n\nOnce the installer finishes downloading, open the downloaded file to open the installation wizard.\n\n### 3. Accept Terms\n\n<p style=\"text-align:center\">\n  <img src=\"/assets/img/posts/install-nodejs-windows/walkthrough_2.png\" style=\"width:50%;min-width:320px;\" />\n</p>\n\nAccept the terms of the License Agreement if you agree.\n\n### 4. Select the Installation Directory\n\n<p style=\"text-align:center\">\n  <img src=\"/assets/img/posts/install-nodejs-windows/walkthrough_3.png\" style=\"width:50%;min-width:320px;\" />\n</p>\n\nThe default location, `C:\\Program Files\\nodejs\\`, is fine. If you install in a non-default location, ensure the directory is located within your command-line's `$PATH` variable.\n\n### 5. Customize Features\n\n<p style=\"text-align:center\">\n  <img src=\"/assets/img/posts/install-nodejs-windows/walkthrough_4.png\" style=\"width:50%;min-width:320px;\" />\n</p>\n\nClick next unless you are certain you want something different. I have never customized this step.\n\n### 6. Install Tools for Native Modules\n\nYou will need a few software tools to be installed in addition to NodeJS in order to compile certain JavaScript/C++ npm modules. NPM modules are 3rd party libraries that can be used to extend the functionality of your application.\n\nIf you decide not to install the tools, they can be installed later.\n\n<p style=\"text-align:center\">\n  <img src=\"/assets/img/posts/install-nodejs-windows/walkthrough_5.png\" style=\"width:50%;min-width:320px;\" />\n</p>\n\nI checked the box because I know I want the tools.\n\n### 7. Install\n\n<p style=\"text-align:center\">\n  <img src=\"/assets/img/posts/install-nodejs-windows/walkthrough_6.png\" style=\"width:50%;min-width:320px;\" />\n</p>\n\nInstall.\n\n### 8. Watch the Progress Bar\n\n<p style=\"text-align:center\">\n  <img src=\"/assets/img/posts/install-nodejs-windows/walkthrough_7.png\" style=\"width:50%;min-width:320px;\" />\n</p>\n\n<p style=\"text-align:center\">\n  <img src=\"/assets/img/posts/install-nodejs-windows/installing_node_js.gif\" style=\"width:50%;min-width:320px;\" />\n</p>\n\nThe installation took me \\~3 minutes total.\n\n### 9. Allow Node.js to make changes to the device\n\n<p style=\"text-align:center\">\n  <img src=\"/assets/img/posts/install-nodejs-windows/walkthrough_8.png\" style=\"width:50%;min-width:320px;\" />\n</p>\n\n### 10. After installation, Install Native Module Tools\n\n<p style=\"text-align:center\">\n  <img src=\"/assets/img/posts/install-nodejs-windows/walkthrough_9.png\" style=\"width:50%;min-width:320px;\" />\n</p>\n\nIf you selected \"Automatically install the necessary tools\" in **Step 6**, a window will appear with some information about the libraries that are about to be installed. Continue through the prompts.\n\n### 11. Finish Tools' Install in Powershell \n\n<p style=\"text-align:center\">\n  <img src=\"/assets/img/posts/install-nodejs-windows/walkthrough_10.png\" style=\"width:50%;min-width:320px;\" />\n</p>\n\nThe process will open a Powershell window with Administrator rights, and finish the installation in Powershell. Allow Powershell to make changes to the device.\n\n### 12. Wait for and Debug Tools Install\n\nThis installation process takes longer than the Node.js install. The installer recommends closing *all* programs other than the installer during the install process.\n\nI did not do that, and did not find the performance of my PC affected during install. However, I did experience an installation failure the first time...\n\n### 12a. Repair Native Modules Install\n\nIt is common for the native modules installation to \"fail\" the first time. It's so common the installation wizard comes with a Repair button. If the native modules installation fails the first time, reactivate the Node.js installer download, and select the 'Repair' option. See \"Repair Node Installation\" in the Resources for details. See the Resourcse as well if you have an installation failure not fixed by this solution:\n\nFind the downloaded file from **Step 1**, and select it.\n\n<p style=\"text-align:center\">\n  <img src=\"/assets/img/posts/install-nodejs-windows/walkthrough_11.png\" style=\"width:50%;min-width:320px;\" />\n</p>\n\nSelect next, then select 'Repair.'\n\n<p style=\"text-align:center\">\n  <img src=\"/assets/img/posts/install-nodejs-windows/walkthrough_12.png\" style=\"width:50%;min-width:320px;\" />\n</p>\n\n<p style=\"text-align:center\">\n  <img src=\"/assets/img/posts/install-nodejs-windows/walkthrough_13.png\" style=\"width:50%;min-width:320px;\" />\n</p>\n\n<p style=\"text-align:center\">\n  <img src=\"/assets/img/posts/install-nodejs-windows/walkthrough_14.png\" style=\"width:50%;min-width:320px;\" />\n</p>\n\n<p style=\"text-align:center\">\n  <img src=\"/assets/img/posts/install-nodejs-windows/walkthrough_15.png\" style=\"width:50%;min-width:320px;\" />\n</p>\n\n### 13. Check Installation\n\nNode and NPM should now be installed. If you installed the native modules, you will have those as well. From Windows Terminal (or similar), run the following commands and check the output:\n\n<div class=\"filename\">command line</div>\n\n```\n> node -v\nv16.13.2\n\n> npm -v\nv8.2.1\n```\n\n`node -v` checks the version of node, and `npm -v` checks the version of npm, node package manager.\n\nIf native modules were installed, run the following to check the version of the installed libraries:\n\n<div class=\"filename\">command line</div>\n\n```\n> choco list -lo\n\nChocolatey v0.10.15\nchocolatey 0.10.15\n...long list...\nvisualstudio-installer 2.0.2\nvisualstudio2019-workload-vctools 1.0.1\nvisualstudio2019buildtools 16.11.9.0\n21 packages installed.\n```\n\nIn particular, check for the existance of visualstudio-installer, visualstudio2019-workload-vctools, and visualstudio2019buildtools libraries. (Note: The exact version and name of the Visual Studio tool may have progressed to higher versions than in the example output.)\n\nNow that Node is installed, we'll get to building out `smartsite`. Keep the following in mind: Node.js is useful for more than serving web requests. Node.js can be used to build desktop applications, command-line scripts, developer libraries (things that can be `npm install`ed), and more. The Node.js ecosystem is ripe for software creation.\n\n### Resources\n\nNode.js Release Schedule and Information: [nodejs.org/en/about/releases](https://nodejs.org/en/about/releases/)\n\nManage PATH System Variable on Windows: [docs.oracle.com](https://docs.oracle.com/en/database/oracle/machine-learning/oml4r/1.5.1/oread/creating-and-modifying-environment-variables-on-windows.html#GUID-DD6F9982-60D5-48F6-8270-A27EC53807D0)\n\nInstall Tools for Native Modules: [github.com/nodejs/node-gyp#on-windows](https://github.com/nodejs/node-gyp#on-windows)\n\nRepair Node Installation: [stackoverflow.com/a/68912225](https://stackoverflow.com/a/68912225)",
        "sectionType": "section",
        "sequence": 1,
        "parentSection": {
          "parentSectionPart": 1,
          "parentSectionType": "chapter",
          "parentSectionSequence": 2
        }
      },
      {
        "title": "Install Nodejs Mac",
        "slug": "install-nodejs-mac",
        "content": "## Install Node.js on MacOS\n\nTo develop a Node.js application on MacOS, the Node binaries must be installed. This guide walks through installing Homebrew, Node.js, and Node Version Manager (nvm).\n\n### 1. Create a user with admin access.\nChances are you are already a user with admin access. If you are aware that you are not a user with admin access, follow [these steps](https://osxdaily.com/2017/07/17/how-create-new-admin-account-mac/) (osxdaily.com) to create such a user. You will need a user *with* admin access to create this new user, so contact an admin if necessary.\n\n### 2. Install Homebrew\nHomebrew is a package manager for MacOS. An OS package manager is used for downloading programs and libraries. Homebrew is used for installing and managing versions of CLI tools and other packages.\n\n<div class=\"filename\">command line</div>\n\n```\n$ ruby -e \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\"\n$ brew -v\n```\n\n### 3. Remove existing node versions\nIn case there is already a Node installation on the Mac, remove it. We will be using nvm to manage Node versions, and a pre-existing installation will hijack any invocations of the `node` executable.\n\n<div class=\"filename\">command line</div>\n\n```\n$ brew uninstall --force node\n```\n\n### 4. Install NVM\nNode Version Manager allows the developer to install and manage different versions of Node both a global and project-by-project basis.\n\n<div class=\"filename\">command line</div>\n\n```\n$ brew update\n$ brew install nvm\n```\n\n### 5. Follow the instructions output by the nvm installer\n<div class=\"filename\">command line output</div>\n\n```\nYou should create NVM's working directory if it doesn't exist:\n\n  mkdir ~/.nvm\n\nAdd the following to ~/.zshrc or your desired shell\nconfiguration file:\n\n  export NVM_DIR=\"$HOME/.nvm\"\n  [ -s \"/usr/local/opt/nvm/nvm.sh\" ] && \\. \"/usr/local/opt/nvm/nvm.sh\"  # This loads nvm\n  [ -s \"/usr/local/opt/nvm/etc/bash_completion.d/nvm\" ] && \\. \"/usr/local/opt/nvm/etc/bash_completion.d/nvm\"  # This loads nvm bash_completion\n\nYou can set $NVM_DIR to any location, but leaving it unchanged from\n/usr/local/opt/nvm will destroy any nvm-installed Node installations\nupon upgrade/reinstall.\n\nType `nvm help` for further information.\n```\n\nPractically, issue the following command:\n\n<div class=\"filename\">command line</div>\n\n```\n$ mkdir ~/.nvm\n```\n\nCopy the indicated output and paste it into `.zshrc`, and use the command `source` to load the new configuration into the active terminal.\n\n<div class=\"filename\">command line</div>\n\n```\n$ nano ~/.zshrc\n$ source ~/.zshrc\n```\n\n### 6. Install the latest long-term support version of Node.js.\n<div class=\"filename\">command line</div>\n\n```\n$ nvm install --lts\n$ nvm current\n```\n\n`nvm current` displays the currently active node version. It should be the version that was installed with `nvm install --lts`.\n\n### 7. Check the installations\nYou should now have nvm and Node.js installed. Check the installation. Here are the commands with example output.\n\n<div class=\"filename\">command line</div>\n\n```\n$ nvm -v\n0.39.1\n$ node -v\nv16.14.2\n```\n\nNow that Node is installed, we'll get to building out `smartsite`. Keep the following in mind: Node.js is useful for more than serving web requests. Node.js can be used to build desktop applications, command-line scripts, developer libraries (things that can be `npm install`ed), and more. The Node.js ecosystem is ripe for software creation.\n\n## Resources\n\nSimilar walkthrough: https://tecadmin.net/install-nvm-macos-with-homebrew/",
        "sectionType": "section",
        "sequence": 2,
        "parentSection": {
          "parentSectionPart": 1,
          "parentSectionType": "chapter",
          "parentSectionSequence": 2
        }
      },
      {
        "title": "Git Usage",
        "slug": "git-usage",
        "content": "## Git Usage\nGit is the industry-leading version control management tool. It provides character by character change tracking and syncing of changes between local and shared environment. Git commands and algorithms warrant a deep dive of their own. This walkthrough provides the simplest possible `git` workflow for a solo developer.\n\nA useful advantage are the branching and merge strategies provided by Git which allow for multiple developers to work within the same codebase while keeping in sync with other developers' changes. For a solo developer, these strategies are useful in organizing product development and capturing each incremental change in a visualizable format.\n\nGit is also required for Heroku, the deployed environment used in this walkthough. This will keep the files we develop locally in sync with the public server's filesystem.\n\n### 1. Create .gitignore file\nA `.gitignore` file is used to define which files and folders should not be saved to version control. Common elements not saved to version control are in-project dependency folders, such as `node_modules`, files containing sensitive information (such as private keys), and certain files used only by the developer's local operating system, such as Apple's `.DS_Store` file.\n\nCreate a file named `.gitignore` in the root directory with the following:\n\n<div class=\"filename\">.gitignore</div>\n\n```\n/node_modules\nnpm-debug.log\n.DS_Store\n/*.env\n```\n\n### 2. Save changes with `git`\nAs changes are made in local development, Git keeps track of them, but does not automatically save the changes to version control. Saving to version control is a two step process. First the changes must be \"staged\". This is essentially a holding area for changes that the developer can review before finalizing the changes. The second step is to finalize, or \"commit\", the changes.\n\nThe command to stage changes is `git add`. The command to finalize the changes into version control is `git commit`.\n\n1. `git add`\nGit's `add` command takes a list of files and directories that should be staged as a parameter.\n\n<div class=\"filename\">command line</div>\n\n```\n$ git add .\n```\n\nThe `.` symbol is shorthand for \"the current working directory.\" Calling `git add` with this parameter signals to Git to save all changes in the current directory. The command can also be run with a list file and directory names as parameters -- e.g. `git add index.js package.json`.\n\n2. `git commit`\nGit enforces that every commit have a commit message describing why the commit was made. A repository's commit messages should be a human-readable log of the changes over time. Use the `-m` flag with `git commit` to add a commit message inline. If the `-m` flag is not used, the terminal will open the default text editor for the developer to enter the commit message.\n\n<div class=\"filename\">command line</div>\n\n```\n$ git commit -m 'Initialize my app'\n```\n\nGit provides an immense catalog of functionality for repository management. As a developer's needs grow more complex, an expanded Git repetoire is a must. I recommend is this [Simple Guide to Git](http://rogerdudler.github.io/git-guide/)(http://rogerdudler.github.io/git-guide/) for next steps in building Git proficiency.",
        "sectionType": "chapter",
        "sequence": 3,
        "parentSection": {
          "parentSectionPart": 1,
          "parentSectionType": "part",
          "parentSectionSequence": 1
        }
      },
      {
        "title": "Initialize Node",
        "slug": "initialize-node",
        "content": "## Initialize Node\nIt's time to create the first files of the web application. \n\n### Initialize\nThe `npm init` command will start a setup wizard for the Node application. In Terminal, navigate to the application directory, and run `npm init`.\n\n<div class=\"filename\">command line</div>\n\n```bash\n$ cd path/to/smartsite\n$ npm init\n```\n\nFor `entry point:`, use `index.js`; it is the default option, and required for parity with the walkthroughs. The default options for the rest of the selections is fine. Feel free to investigate the meaning of each, and customize the values as desired. Selection made in this wizard can be changed.\n\nHere is example output from `npm init`:\n\n<div class=\"filename\">command line</div>\n\n```\n$ npm init\nThis utility will walk you through creating a package.json file.\nIt only covers the most common items, and tries to guess sensible defaults.\n\nSee `npm help init` for definitive documentation on these fields\nand exactly what they do.\n\nUse `npm install <pkg>` afterwards to install a package and\nsave it as a dependency in the package.json file.\n\nPress ^C at any time to quit.\npackage name: (smartsite) \nversion: (1.0.0) \ndescription: smartsite Web Application Guide\nentry point: (index.js) \ntest command: \ngit repository: (https://github.com/popdemtech/smartsite.git) \nkeywords: \nauthor: Popular Demand\nlicense: (ISC) \nAbout to write to /Users/popdemtech/popdemtech/smartsite/package.json:\n\n{\n  \"name\": \"smartsite\",\n  \"version\": \"1.0.0\",\n  \"description\": \"smartsite Web Application Guide\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\"\n  },\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"git+https://github.com/popdemtech/smartsite.git\"\n  },\n  \"author\": \"Popular Demand\",\n  \"license\": \"ISC\",\n  \"bugs\": {\n    \"url\": \"https://github.com/popdemtech/smartsite/issues\"\n  },\n  \"homepage\": \"https://github.com/popdemtech/smartsite#readme\"\n}\n\n\nIs this OK? (yes)\n``` \n\nThis command generates a `package.json` file in the directory in which it is run. `package.json` is used for configuration of Node.js applications, and will be revisited throughout the development process.\n\n### Start the application\nAn application is a software script that is executed on a computer. To \"start\" this application, like every software, application code must be written and a command that starts the application must be defined.\n\nNode.js scripts are run by passing its filename to the `node` executable. The `node` program reads the file, interprets the Javascript, and runs the functionality specified by the application.\n\nTo run the application, first create a file, `index.js` for the application code.\n\n1. Create `index.js`\nIn the root of the project, create a file titled `index.js`. Any valid JavaScript can go in this file -- a `console.log` statement is shown in the example.\n\n<div class=\"filename\">index.js</div>\n\n```javascript\nconsole.log('Welcome to SmaRtsite!');\n```\n\nAt this point, the application can be run with `node index.js`.\n\n2. Create the start script\nA Node.js application's `package.json` is the place to define commonly used commands such as `start` and `test`. A top-level property `\"scripts\"` is used to map developer-selected command names to executable scripts. `package.json` already contains a `test` script.\n\nAdd a script called `start` that executes the `node` executable with `index.js`, and save the file.\n\n<div class=\"filename\">package.json</div>\n\n```js\n{\n  ...,\n  \"scripts\": {\n    \"start\": \"node index.js\",\n    \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\"\n  },\n  ...\n}\n```\n\nA script defined in `\"scripts\"` can be invoked from the command line with `npm run [script]`.\n\n3. Run start script\n\n<div class=\"filename\">command line</div>\n\n```\n$ npm run start\n```\n\nYou should see the output `Welcome to SmaRtsite!` in the console. Just like that we have a simple yet functional Node.js application.",
        "sectionType": "chapter",
        "sequence": 4,
        "parentSection": {
          "parentSectionPart": 1,
          "parentSectionType": "part",
          "parentSectionSequence": 1
        }
      }
    ]
  },
  {
    "title": "Git My-app",
    "slug": "git-my-app",
    "content": "<h2 id=\"gitsmartsite\">Git <code>smartsite</code></h2><p>Git the only developer tool required before beginning this walkthrough. It's required for you to run the first command, <code>git clone</code>, and sync the starting directory to your local computer.</p><h3 id=\"whatisgit\">What is Git?</h3><p>Imagine every time you made a change to a project, you had to make a brand new directory, copy your existing work into it, make changes in this totally new directory, then <em>somehow</em> totally replace the old work with the new work both locally and in production when the changes are finished. In the early days of the internet, this was solved with creative use of file transport protocol (FTP). The Git program both solves the tedious workflow and improves on full-file, FTP syncing.</p><p>Git is a version control management system that maintains what the software looked like in the past and what it looks like now. It keeps track of each incremental change to the codebase which allows for efficient filesystem syncing between local and remote environments by only applying the changeset at the time of sync.</p><p>A collection of files that is being tracked by Git is called a repository. The files on hard disk are called the Working Directory.</p><p>A repository is a virtual collection, the working directory is the filesystem a developer is modifying. As changes in the working directory are accepted to be code complete, they are added via command to the Git repository. The repository can then be synced between local environments and remote environments.</p><p>The Git development workflow also provides the ability to split-off (or \"branch\") new development work from a pre-established \"master\" branch. This allows the developer to build new features on top of the currently sanctified codebase, only adding the a new changeset. Once the new changes are approved, finalizing the changes into the existing project takes one command. If the new changes end up not being desirable, they can be reverted, discarded and/or saved for a later date.</p><p>In essence, Git takes snapshots of application files over time and allows developers to manage each snapshot independent of one another. There may be a revision on the developer's local computer, a different revision being visited by live traffic in production, and an entirely different revision up for development team review on a shared repository management system like Github.</p><h3 id=\"1installgit\">1. Install Git</h3><p>To get Git, use the <a href=\"https://git-scm.com/book/en/v2/Getting-Started-Installing-Git\">official installation guide</a> (https://git-scm.com/book/en/v2/Getting-Started-Installing-Git).</p><p>You're done with Git installation when you can run <code>git --version</code> and be presented with your installed Git gersion.</p><div class=\"filename\">command line</div><pre><code>$ git --version</code></pre><h3 id=\"2clonesmartsite\">2. Clone <code>smartsite</code></h3><p>The <code>git clone</code> command downloads a git repository from the internet to a local working directory. Within the terminal, navigate to the directory you'd like to save <code>smartsite</code> and run <code>git clone</code>.</p><div class=\"filename\">command line</div><pre><code>$ cd path/to/parent_directory$ git clone https://github.com/popdemtech/smartsite.git$ cd smartsite</code></pre><p>This series of commands downloads <code>smartsite</code> and places the terminal in the <code>smartsite</code> directory.</p><p>The starting <code>smartsite</code> directory is just this walkthrough. Following the steps provided, you will build out a Node.js web server, and the nearly empty directory will blossom into an internet application of whatever you wish it to be.</p><p>We just gotta create the application now. Let's get to it.</p><h3 id=\"resources\">Resources</h3><p>A Simple Guide to Git: <a href=\"http://rogerdudler.github.io/git-guide/\">http://rogerdudler.github.io/git-guide/</a></p>",
    "sectionType": "chapter",
    "sequence": 1,
    "parentSection": {
      "parentSectionPart": 1,
      "parentSectionType": "part",
      "parentSectionSequence": 1
    }
  },
  {
    "title": "Install Nodejs",
    "slug": "install-nodejs",
    "content": "<h2 id=\"installnodejs\">Install Node.js</h2><p>This walkthrough will cover building a web server application using Node.js. While JavaScript was initially developed for and still maintains its scripting dominance in a browser environment, Node.js is a JS runtime for use outside of a browser.</p><p>Node.js is an open source development platform for executing JavaScript code server-side. While JavaScript runs natively in a browser (i.e. client-side), Node.js provides developers the platform with which to build applications for a controlled environment that runs on a host computer (server-side), separate from the JavaScript that is delivered to the client's browser. In this way, a Node.js application is comparable to PHP, Java, and Ruby, and other application environments that handle web-traffic requests, but are not delivered to the client.</p><p>Windows users see [Install Node.js on Windows].</p><p>MacOS users, check out [Install Node.js on MacOS] for installation instructions.</p><p>Linux users, search a trusted search engine with the phrase \"install node js linux\" to find what you need.</p>",
    "sectionType": "chapter",
    "sequence": 2,
    "parentSection": {
      "parentSectionPart": 1,
      "parentSectionType": "part",
      "parentSectionSequence": 1
    }
  },
  {
    "title": "Install Nodejs Windows",
    "slug": "install-nodejs-windows",
    "content": "<h2 id=\"installnodejsonwindows\">Install Node.js on Windows</h2><h3 id=\"1navigatetonodejsorg\">1. Navigate to nodejs.org</h3><p style=\"text-align:center\">  <img src=\"/assets/img/posts/install-nodejs-windows/walkthrough_0.png\" style=\"width:50%;min-width:320px;\" /></p><p>Navigate to <a href=\"https://nodejs.org\">nodejs.org</a> and select the version of node you want to download. Even number versions have Long-Term Support (LTS).</p><p>Long-term support \"typically guarantees that critical bugs will be fixed for a total of 30 months.\" Production applications should use LTS versions. Use a more recent odd number version to test out latest features.</p><p>Read more about node's release schedule in the Resources.</p><h3 id=\"2setupwizard\">2. Setup Wizard</h3><p style=\"text-align:center\">  <img src=\"/assets/img/posts/install-nodejs-windows/walkthrough_1.png\" style=\"width:50%;min-width:320px;\" /></p><p>Once the installer finishes downloading, open the downloaded file to open the installation wizard.</p><h3 id=\"3acceptterms\">3. Accept Terms</h3><p style=\"text-align:center\">  <img src=\"/assets/img/posts/install-nodejs-windows/walkthrough_2.png\" style=\"width:50%;min-width:320px;\" /></p><p>Accept the terms of the License Agreement if you agree.</p><h3 id=\"4selecttheinstallationdirectory\">4. Select the Installation Directory</h3><p style=\"text-align:center\">  <img src=\"/assets/img/posts/install-nodejs-windows/walkthrough_3.png\" style=\"width:50%;min-width:320px;\" /></p><p>The default location, <code>C:\\Program Files\\nodejs\\</code>, is fine. If you install in a non-default location, ensure the directory is located within your command-line's <code>$PATH</code> variable.</p><h3 id=\"5customizefeatures\">5. Customize Features</h3><p style=\"text-align:center\">  <img src=\"/assets/img/posts/install-nodejs-windows/walkthrough_4.png\" style=\"width:50%;min-width:320px;\" /></p><p>Click next unless you are certain you want something different. I have never customized this step.</p><h3 id=\"6installtoolsfornativemodules\">6. Install Tools for Native Modules</h3><p>You will need a few software tools to be installed in addition to NodeJS in order to compile certain JavaScript/C++ npm modules. NPM modules are 3rd party libraries that can be used to extend the functionality of your application.</p><p>If you decide not to install the tools, they can be installed later.</p><p style=\"text-align:center\">  <img src=\"/assets/img/posts/install-nodejs-windows/walkthrough_5.png\" style=\"width:50%;min-width:320px;\" /></p><p>I checked the box because I know I want the tools.</p><h3 id=\"7install\">7. Install</h3><p style=\"text-align:center\">  <img src=\"/assets/img/posts/install-nodejs-windows/walkthrough_6.png\" style=\"width:50%;min-width:320px;\" /></p><p>Install.</p><h3 id=\"8watchtheprogressbar\">8. Watch the Progress Bar</h3><p style=\"text-align:center\">  <img src=\"/assets/img/posts/install-nodejs-windows/walkthrough_7.png\" style=\"width:50%;min-width:320px;\" /></p><p style=\"text-align:center\">  <img src=\"/assets/img/posts/install-nodejs-windows/installing_node_js.gif\" style=\"width:50%;min-width:320px;\" /></p><p>The installation took me ~3 minutes total.</p><h3 id=\"9allownodejstomakechangestothedevice\">9. Allow Node.js to make changes to the device</h3><p style=\"text-align:center\">  <img src=\"/assets/img/posts/install-nodejs-windows/walkthrough_8.png\" style=\"width:50%;min-width:320px;\" /></p><h3 id=\"10afterinstallationinstallnativemoduletools\">10. After installation, Install Native Module Tools</h3><p style=\"text-align:center\">  <img src=\"/assets/img/posts/install-nodejs-windows/walkthrough_9.png\" style=\"width:50%;min-width:320px;\" /></p><p>If you selected \"Automatically install the necessary tools\" in <strong>Step 6</strong>, a window will appear with some information about the libraries that are about to be installed. Continue through the prompts.</p><h3 id=\"11finishtoolsinstallinpowershell\">11. Finish Tools' Install in Powershell</h3><p style=\"text-align:center\">  <img src=\"/assets/img/posts/install-nodejs-windows/walkthrough_10.png\" style=\"width:50%;min-width:320px;\" /></p><p>The process will open a Powershell window with Administrator rights, and finish the installation in Powershell. Allow Powershell to make changes to the device.</p><h3 id=\"12waitforanddebugtoolsinstall\">12. Wait for and Debug Tools Install</h3><p>This installation process takes longer than the Node.js install. The installer recommends closing <em>all</em> programs other than the installer during the install process.</p><p>I did not do that, and did not find the performance of my PC affected during install. However, I did experience an installation failure the first time…</p><h3 id=\"12arepairnativemodulesinstall\">12a. Repair Native Modules Install</h3><p>It is common for the native modules installation to \"fail\" the first time. It's so common the installation wizard comes with a Repair button. If the native modules installation fails the first time, reactivate the Node.js installer download, and select the 'Repair' option. See \"Repair Node Installation\" in the Resources for details. See the Resourcse as well if you have an installation failure not fixed by this solution:</p><p>Find the downloaded file from <strong>Step 1</strong>, and select it.</p><p style=\"text-align:center\">  <img src=\"/assets/img/posts/install-nodejs-windows/walkthrough_11.png\" style=\"width:50%;min-width:320px;\" /></p><p>Select next, then select 'Repair.'</p><p style=\"text-align:center\">  <img src=\"/assets/img/posts/install-nodejs-windows/walkthrough_12.png\" style=\"width:50%;min-width:320px;\" /></p><p style=\"text-align:center\">  <img src=\"/assets/img/posts/install-nodejs-windows/walkthrough_13.png\" style=\"width:50%;min-width:320px;\" /></p><p style=\"text-align:center\">  <img src=\"/assets/img/posts/install-nodejs-windows/walkthrough_14.png\" style=\"width:50%;min-width:320px;\" /></p><p style=\"text-align:center\">  <img src=\"/assets/img/posts/install-nodejs-windows/walkthrough_15.png\" style=\"width:50%;min-width:320px;\" /></p><h3 id=\"13checkinstallation\">13. Check Installation</h3><p>Node and NPM should now be installed. If you installed the native modules, you will have those as well. From Windows Terminal (or similar), run the following commands and check the output:</p><div class=\"filename\">command line</div><pre><code>&gt; node -vv16.13.2&gt; npm -vv8.2.1</code></pre><p><code>node -v</code> checks the version of node, and <code>npm -v</code> checks the version of npm, node package manager.</p><p>If native modules were installed, run the following to check the version of the installed libraries:</p><div class=\"filename\">command line</div><pre><code>&gt; choco list -loChocolatey v0.10.15chocolatey 0.10.15...long list...visualstudio-installer 2.0.2visualstudio2019-workload-vctools 1.0.1visualstudio2019buildtools 16.11.9.021 packages installed.</code></pre><p>In particular, check for the existance of visualstudio-installer, visualstudio2019-workload-vctools, and visualstudio2019buildtools libraries. (Note: The exact version and name of the Visual Studio tool may have progressed to higher versions than in the example output.)</p><p>Now that Node is installed, we'll get to building out <code>smartsite</code>. Keep the following in mind: Node.js is useful for more than serving web requests. Node.js can be used to build desktop applications, command-line scripts, developer libraries (things that can be <code>npm install</code>ed), and more. The Node.js ecosystem is ripe for software creation.</p><h3 id=\"resources\">Resources</h3><p>Node.js Release Schedule and Information: <a href=\"https://nodejs.org/en/about/releases/\">nodejs.org/en/about/releases</a></p><p>Manage PATH System Variable on Windows: <a href=\"https://docs.oracle.com/en/database/oracle/machine-learning/oml4r/1.5.1/oread/creating-and-modifying-environment-variables-on-windows.html#GUID-DD6F9982-60D5-48F6-8270-A27EC53807D0\">docs.oracle.com</a></p><p>Install Tools for Native Modules: <a href=\"https://github.com/nodejs/node-gyp#on-windows\">github.com/nodejs/node-gyp#on-windows</a></p><p>Repair Node Installation: <a href=\"https://stackoverflow.com/a/68912225\">stackoverflow.com/a/68912225</a></p>",
    "sectionType": "section",
    "sequence": 1,
    "parentSection": {
      "parentSectionPart": 1,
      "parentSectionType": "chapter",
      "parentSectionSequence": 2
    }
  },
  {
    "title": "Install Nodejs Mac",
    "slug": "install-nodejs-mac",
    "content": "<h2 id=\"installnodejsonmacos\">Install Node.js on MacOS</h2><p>To develop a Node.js application on MacOS, the Node binaries must be installed. This guide walks through installing Homebrew, Node.js, and Node Version Manager (nvm).</p><h3 id=\"1createauserwithadminaccess\">1. Create a user with admin access.</h3><p>Chances are you are already a user with admin access. If you are aware that you are not a user with admin access, follow <a href=\"https://osxdaily.com/2017/07/17/how-create-new-admin-account-mac/\">these steps</a> (osxdaily.com) to create such a user. You will need a user <em>with</em> admin access to create this new user, so contact an admin if necessary.</p><h3 id=\"2installhomebrew\">2. Install Homebrew</h3><p>Homebrew is a package manager for MacOS. An OS package manager is used for downloading programs and libraries. Homebrew is used for installing and managing versions of CLI tools and other packages.</p><div class=\"filename\">command line</div><pre><code>$ ruby -e \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\"$ brew -v</code></pre><h3 id=\"3removeexistingnodeversions\">3. Remove existing node versions</h3><p>In case there is already a Node installation on the Mac, remove it. We will be using nvm to manage Node versions, and a pre-existing installation will hijack any invocations of the <code>node</code> executable.</p><div class=\"filename\">command line</div><pre><code>$ brew uninstall --force node</code></pre><h3 id=\"4installnvm\">4. Install NVM</h3><p>Node Version Manager allows the developer to install and manage different versions of Node both a global and project-by-project basis.</p><div class=\"filename\">command line</div><pre><code>$ brew update$ brew install nvm</code></pre><h3 id=\"5followtheinstructionsoutputbythenvminstaller\">5. Follow the instructions output by the nvm installer</h3><div class=\"filename\">command line output</div><pre><code>You should create NVM's working directory if it doesn't exist:  mkdir ~/.nvmAdd the following to ~/.zshrc or your desired shellconfiguration file:  export NVM_DIR=\"$HOME/.nvm\"  [ -s \"/usr/local/opt/nvm/nvm.sh\" ] &amp;&amp; \\. \"/usr/local/opt/nvm/nvm.sh\"  # This loads nvm  [ -s \"/usr/local/opt/nvm/etc/bash_completion.d/nvm\" ] &amp;&amp; \\. \"/usr/local/opt/nvm/etc/bash_completion.d/nvm\"  # This loads nvm bash_completionYou can set $NVM_DIR to any location, but leaving it unchanged from/usr/local/opt/nvm will destroy any nvm-installed Node installationsupon upgrade/reinstall.Type `nvm help` for further information.</code></pre><p>Practically, issue the following command:</p><div class=\"filename\">command line</div><pre><code>$ mkdir ~/.nvm</code></pre><p>Copy the indicated output and paste it into <code>.zshrc</code>, and use the command <code>source</code> to load the new configuration into the active terminal.</p><div class=\"filename\">command line</div><pre><code>$ nano ~/.zshrc$ source ~/.zshrc</code></pre><h3 id=\"6installthelatestlongtermsupportversionofnodejs\">6. Install the latest long-term support version of Node.js.</h3><div class=\"filename\">command line</div><pre><code>$ nvm install --lts$ nvm current</code></pre><p><code>nvm current</code> displays the currently active node version. It should be the version that was installed with <code>nvm install --lts</code>.</p><h3 id=\"7checktheinstallations\">7. Check the installations</h3><p>You should now have nvm and Node.js installed. Check the installation. Here are the commands with example output.</p><div class=\"filename\">command line</div><pre><code>$ nvm -v0.39.1$ node -vv16.14.2</code></pre><p>Now that Node is installed, we'll get to building out <code>smartsite</code>. Keep the following in mind: Node.js is useful for more than serving web requests. Node.js can be used to build desktop applications, command-line scripts, developer libraries (things that can be <code>npm install</code>ed), and more. The Node.js ecosystem is ripe for software creation.</p><h2 id=\"resources\">Resources</h2><p>Similar walkthrough: https://tecadmin.net/install-nvm-macos-with-homebrew/</p>",
    "sectionType": "section",
    "sequence": 2,
    "parentSection": {
      "parentSectionPart": 1,
      "parentSectionType": "chapter",
      "parentSectionSequence": 2
    }
  },
  {
    "title": "Git Usage",
    "slug": "git-usage",
    "content": "<h2 id=\"gitusage\">Git Usage</h2><p>Git is the industry-leading version control management tool. It provides character by character change tracking and syncing of changes between local and shared environment. Git commands and algorithms warrant a deep dive of their own. This walkthrough provides the simplest possible <code>git</code> workflow for a solo developer.</p><p>A useful advantage are the branching and merge strategies provided by Git which allow for multiple developers to work within the same codebase while keeping in sync with other developers' changes. For a solo developer, these strategies are useful in organizing product development and capturing each incremental change in a visualizable format.</p><p>Git is also required for Heroku, the deployed environment used in this walkthough. This will keep the files we develop locally in sync with the public server's filesystem.</p><h3 id=\"1creategitignorefile\">1. Create .gitignore file</h3><p>A <code>.gitignore</code> file is used to define which files and folders should not be saved to version control. Common elements not saved to version control are in-project dependency folders, such as <code>node_modules</code>, files containing sensitive information (such as private keys), and certain files used only by the developer's local operating system, such as Apple's <code>.DS_Store</code> file.</p><p>Create a file named <code>.gitignore</code> in the root directory with the following:</p><div class=\"filename\">.gitignore</div><pre><code>/node_modulesnpm-debug.log.DS_Store/*.env</code></pre><h3 id=\"2savechangeswithgit\">2. Save changes with <code>git</code></h3><p>As changes are made in local development, Git keeps track of them, but does not automatically save the changes to version control. Saving to version control is a two step process. First the changes must be \"staged\". This is essentially a holding area for changes that the developer can review before finalizing the changes. The second step is to finalize, or \"commit\", the changes.</p><p>The command to stage changes is <code>git add</code>. The command to finalize the changes into version control is <code>git commit</code>.</p><ol><li><code>git add</code>Git's <code>add</code> command takes a list of files and directories that should be staged as a parameter.</li></ol><div class=\"filename\">command line</div><pre><code>$ git add .</code></pre><p>The <code>.</code> symbol is shorthand for \"the current working directory.\" Calling <code>git add</code> with this parameter signals to Git to save all changes in the current directory. The command can also be run with a list file and directory names as parameters -- e.g. <code>git add index.js package.json</code>.</p><ol start=\"2\"><li><code>git commit</code>Git enforces that every commit have a commit message describing why the commit was made. A repository's commit messages should be a human-readable log of the changes over time. Use the <code>-m</code> flag with <code>git commit</code> to add a commit message inline. If the <code>-m</code> flag is not used, the terminal will open the default text editor for the developer to enter the commit message.</li></ol><div class=\"filename\">command line</div><pre><code>$ git commit -m 'Initialize my app'</code></pre><p>Git provides an immense catalog of functionality for repository management. As a developer's needs grow more complex, an expanded Git repetoire is a must. I recommend is this <a href=\"http://rogerdudler.github.io/git-guide/\">Simple Guide to Git</a>(http://rogerdudler.github.io/git-guide/) for next steps in building Git proficiency.</p>",
    "sectionType": "chapter",
    "sequence": 3,
    "parentSection": {
      "parentSectionPart": 1,
      "parentSectionType": "part",
      "parentSectionSequence": 1
    }
  },
  {
    "title": "Initialize Node",
    "slug": "initialize-node",
    "content": "<h2 id=\"initializenode\">Initialize Node</h2><p>It's time to create the first files of the web application. </p><h3 id=\"initialize\">Initialize</h3><p>The <code>npm init</code> command will start a setup wizard for the Node application. In Terminal, navigate to the application directory, and run <code>npm init</code>.</p><div class=\"filename\">command line</div><pre><code class=\"bash language-bash\">$ cd path/to/smartsite$ npm init</code></pre><p>For <code>entry point:</code>, use <code>index.js</code>; it is the default option, and required for parity with the walkthroughs. The default options for the rest of the selections is fine. Feel free to investigate the meaning of each, and customize the values as desired. Selection made in this wizard can be changed.</p><p>Here is example output from <code>npm init</code>:</p><div class=\"filename\">command line</div><pre><code>$ npm initThis utility will walk you through creating a package.json file.It only covers the most common items, and tries to guess sensible defaults.See `npm help init` for definitive documentation on these fieldsand exactly what they do.Use `npm install &lt;pkg&gt;` afterwards to install a package andsave it as a dependency in the package.json file.Press ^C at any time to quit.package name: (smartsite) version: (1.0.0) description: smartsite Web Application Guideentry point: (index.js) test command: git repository: (https://github.com/popdemtech/smartsite.git) keywords: author: Popular Demandlicense: (ISC) About to write to /Users/popdemtech/popdemtech/smartsite/package.json:{  \"name\": \"smartsite\",  \"version\": \"1.0.0\",  \"description\": \"smartsite Web Application Guide\",  \"main\": \"index.js\",  \"scripts\": {    \"test\": \"echo \\\"Error: no test specified\\\" &amp;&amp; exit 1\"  },  \"repository\": {    \"type\": \"git\",    \"url\": \"git+https://github.com/popdemtech/smartsite.git\"  },  \"author\": \"Popular Demand\",  \"license\": \"ISC\",  \"bugs\": {    \"url\": \"https://github.com/popdemtech/smartsite/issues\"  },  \"homepage\": \"https://github.com/popdemtech/smartsite#readme\"}Is this OK? (yes)</code></pre><p>This command generates a <code>package.json</code> file in the directory in which it is run. <code>package.json</code> is used for configuration of Node.js applications, and will be revisited throughout the development process.</p><h3 id=\"starttheapplication\">Start the application</h3><p>An application is a software script that is executed on a computer. To \"start\" this application, like every software, application code must be written and a command that starts the application must be defined.</p><p>Node.js scripts are run by passing its filename to the <code>node</code> executable. The <code>node</code> program reads the file, interprets the Javascript, and runs the functionality specified by the application.</p><p>To run the application, first create a file, <code>index.js</code> for the application code.</p><ol><li>Create <code>index.js</code>In the root of the project, create a file titled <code>index.js</code>. Any valid JavaScript can go in this file -- a <code>console.log</code> statement is shown in the example.</li></ol><div class=\"filename\">index.js</div><pre><code class=\"javascript language-javascript\">console.log('Welcome to SmaRtsite!');</code></pre><p>At this point, the application can be run with <code>node index.js</code>.</p><ol start=\"2\"><li>Create the start scriptA Node.js application's <code>package.json</code> is the place to define commonly used commands such as <code>start</code> and <code>test</code>. A top-level property <code>\"scripts\"</code> is used to map developer-selected command names to executable scripts. <code>package.json</code> already contains a <code>test</code> script.</li></ol><p>Add a script called <code>start</code> that executes the <code>node</code> executable with <code>index.js</code>, and save the file.</p><div class=\"filename\">package.json</div><pre><code class=\"js language-js\">{  ...,  \"scripts\": {    \"start\": \"node index.js\",    \"test\": \"echo \\\"Error: no test specified\\\" &amp;&amp; exit 1\"  },  ...}</code></pre><p>A script defined in <code>\"scripts\"</code> can be invoked from the command line with <code>npm run [script]</code>.</p><ol start=\"3\"><li>Run start script</li></ol><div class=\"filename\">command line</div><pre><code>$ npm run start</code></pre><p>You should see the output <code>Welcome to SmaRtsite!</code> in the console. Just like that we have a simple yet functional Node.js application.</p>",
    "sectionType": "chapter",
    "sequence": 4,
    "parentSection": {
      "parentSectionPart": 1,
      "parentSectionType": "part",
      "parentSectionSequence": 1
    }
  },
  {
    "title": "Basics",
    "slug": "basics",
    "content": "<h2 id=\"readmemd\">README.md</h2><p>This section covers implementing key building blocks for creating a web application.</p><ul><li>The webserver</li><li>The view layer</li><li>User authentication</li><li>Databases</li><li>Environment variables</li><li>A deployed environment</li></ul><p>The section concludes with building a full-stack feature using all of the covered components.</p>",
    "sectionType": "part",
    "sequence": 2,
    "parentSectionId": null,
    "childSections": [
      {
        "title": "Create Webserver",
        "slug": "create-webserver",
        "content": "## Create the Web Server\nAs it stands, `smartsite` is a functioning Node.js application, but it doesn't do much. It prints a message in the terminal. We're here to build an application that serves web traffic. This means a user can navigate to our web pages and functionality from an internet browser.\n\nFor the purposes of this guide, the term \"web server\" should be taken to mean an application that serves web traffic. The term \"web server\" can (and often does) apply to any physical or digital component that makes up the OSI model. These components funtionally operate different levels of abstraction, and in the most general sense, constitute a pipeline of request handling. Node.js web servers operate at the \"Application Layer\" of the model.\n\nA web server library written for the JavaScript ecosystem will be included into application scripts. There are many such libraries in the Node.js ecosystem from which to choose. The ideal library for our purposes provides a developer friendly abstraction over the gritty details of TCP and HTTP communication protocols. A large network of developers using the library is a strong bonus as well. Express [https://expressjs.com](https://expressjs.com) is a web framework that checks all of the boxes.\n\n### Express\n\nExpress provides an abstraction over low-level HTTP handling by using sensible defaults for HTTP configuration, while still allowing for low-level configuation as the needs of the application are discovered. For the developer, Express provides a straight-forward, route declaration approach for serving web requests.\n\nExpress has been a mainstay library for since the early days of Node.js, and beginner to advanced online resources can be found with ease.\n\n### 1. Install Express\n\nUse `npm` to install Express. Within `smartsite`'s root directory, run the following:\n\n<div class=\"filename\">command line</div>\n\n```\n$ npm install express\n```\n\nThis command adds Express as a dependency to the application, and installs the library into the `node_modules` folder. Since Express is the first external library added to the application, the `node_modules` folder will be created in the root directory.\n\n### 2. Create the Express server\nExpress provides JavaScript classes and functions that, when used within a Node.js script, start a webserver process. To do so, we'll need to `require` the Express library, then instantiate an instance of Express.\n\nAn instance of Express is conventionally called `app`. The instance provides methods for routing HTTP requests, rendering HTML views, registering a template engine, and configuring middleware. `smartsite` will utilize all of these methods.\n\nFirst, modify `index.js` to import in the `express` library and instantiate an `app`. Register a `GET` route to the root route, `/`.\n\n<div class=\"filename\">index.js</div>\n\n```javascript\nconst express = require('express');\nconst app = express();\nconst PORT = 3000;\n\napp.get('/', function(request, response) {\n  response.send('<h1>Welcome to SmaRtsite!</h1>');\n});\n\napp.listen(PORT, () => {\n  console.log(`SmaRtsite listening on port ${PORT}`);\n});\n```\n\n### 3. Run the Application\nStarting the application with `npm run start` will begin the Express server. Based on the code above, this web server can be accessed by navigating to `http://localhost:3000` in a web browser.\n\nOpen a web browser and navigate to `localhost:3000`. You should see a large heading with the words \"Welcome to SmaRtsite!\".\n\n[image welcome to my app]\n\n### 6. Git commit the changes\nThis was a significant unit of development. The Express library was added and the initial web route was added to the application. `git commit` the changes to signify the completion of this development.\n\n<div class=\"filename\">command line</div>\n\n```\n$ git add .\n$ git commit -m 'Add express'\n```\n\n### Resources\nExpress: [expressjs.com](https://expressjs.com)",
        "sectionType": "chapter",
        "sequence": 1,
        "parentSection": {
          "parentSectionPart": 2,
          "parentSectionType": "part",
          "parentSectionSequence": 2
        }
      },
      {
        "title": "Filesystem Watcher",
        "slug": "filesystem-watcher",
        "content": "## Add a Filesystem Watcher\nA filesystem watcher is a program that ensures a running development application is providing the most recent changes to code. The use case for a filesystem watcher is best illustrated by example. \n\n1. Ensure the node server is running `npm run start`\n\n2. Modify a `index.js`\nThe current state of the root route in `index.js` is that it returns an HTML string with the phrase `Hello World`.\n\n<div class=\"filename\">index.js</div>\n\n```javascript\napp.get('/', function(request, response) {\n  response.send('<h1>Welcome to SmaRtsite!</h1>');\n});\n```\n\nChange the sent response to read `Hello World` instead of `Welcome to SmaRtsite`, and save the file.\n\n<div class=\"filename\">index.js</div>\n\n```javascript\napp.get('/', function(request, response) {\n  response.send('<h1>Hello World!</h1>');\n});\n```\n\n3. Check for changes\nIn the broswer, navigate to `localhost:3000`, and check out the heading. It still says `Hello World!`.\n\nThis is because when the application is run with `node index.js`, all application files are cached in the state they were in when the command was invoked. To see the modified response, stop the currently running server with `CMD+C` or `CTRL+C` depending on your operating system, and restart it with `npm run start`. Navigating to the browser now will display the updated text.\n\nRestarting the server after every change is tedious and will seem *more* tedious over time. And presents a near impossible developer experience long-term. As such, `smartsite` will implement the file watching library `nodemon`.\n\n### 1. Add nodemon\nNodemon is a library that is used to initialize a process from the local operating system, and is therefore a development dependency rather than an application dependency. Install the library as a dev dependency.\n\n1. Install nodemon\n<div class=\"filename\">command line</div>\n\n```bash\n$ npm install --save-dev nodemon\n```\n\n2. Use nodemon\nnodemon wraps the `node` process with an additional file-checking functionality. Change the start script within `package.json` to use `nodemon` instead of `node` to start the server process.\n\n<div class=\"filename\">package.json</div>\n\n```javascript\n{\n  ...,\n  \"scripts\": {\n    \"start\": \"npx nodemon .\",\n    ...\n  },\n  ...\n}\n```\n\nThe `npx` command can be thought of as \"**n**ode **p**ackage e**x**ecute.\" This signals to use the executable provided by a program found within the local `node_modules` directory -- in this case `nodemon`.\n\n3. Restart the server\nRunning `npm run start` will now invoke `nodemon`. `nodemon` will start the application as usual and restart the server process as code within the directory is changed. Restart the server.\n\n<div class=\"filename\">command line</div>\n\n```\n$ npm run start\n```\n\n4. Modify the code\nChange the text sent from the root route back to `Welcome to SmaRtsite`, and *do not* restart the server.\n\n<div class=\"filename\">index.js</div>\n\n```javascript\napp.get('/', function(request, response) {\n  response.send('<h1>Welcome to SmaRtsite!</h1>');\n});\n```\n\n5. Check for changes\nIn the broswer, navigate to `localhost:3000`, and check out the heading. It now says `Welcome to SmaRtsite!` without needing a server restart. The filesystem watcher is working!\n\n### 6. Git commit the changes\nThis was a significant unit of development. A development library was added, and it's functionality was fully implemented. `git commit` the changes to signify the completion of this development.\n\n<div class=\"filename\">command line</div>\n\n```\n$ git add .\n$ git commit -m 'Add nodemon'\n```\n\n### Resources\nNodemon: [npmjs.com/package/nodemon](https://www.npmjs.com/package/nodemon)",
        "sectionType": "section",
        "sequence": 1,
        "parentSection": {
          "parentSectionPart": 2,
          "parentSectionType": "chapter",
          "parentSectionSequence": 1
        }
      },
      {
        "title": "Sending Web Pages",
        "slug": "sending-web-pages",
        "content": "## Sending Web Pages\nCurrently, the application is configured to send an HTML string when the root route, `/`, is requested. While this is a valid use of Express route handling, a better approach is to keep end-user presentation and the application logic into separate files.\n\n<dl>\n    <dt>Application Logic</dt>\n    <dd>The scripted code that handles the request/response cycle</dd>\n    <dt>Presentation</dt>\n    <dd>The response displayed to the consumer</dd>\n</dl>\n\nThe separation of concerns between the routing and view layers is standard practice. This technique allows developer to optimize and organize the two areas separately which will become more important as the application grows.\n\n### The Presentation Layer\nIt is safe to expect web-traffic to be viewed using a internet browsing application such as Chrome or Microsoft Edge. Modern internet broswers are equipped to translate many common web response formats into human usable form. The most familiar of these formats is likely HTML.\n\nTo start `smartsite`'s presentation layer, we will send a basic HTML file.\n\n1. Create a file named `index.html` in the root directory.\n\n<div class=\"filename\">index.html</div>\n\n```html\n<!DOCTYPE html>\n<head>\n  <title>SmaRtsite</title>\n</head>\n<html>\n  <body>\n    <h1>Welcome to SmaRtsite!</h1>\n  </body>\n</html>\n```\n\n2. Send the `index.html` as the response from `/`.\nModify the route handler of `/` to use `sendFile` instead of `send`.\n\n<div class=\"filename\">index.js</div>\n\n```javascript\napp.get('/', function(request, response) {\n  response.sendFile(__dirname + '/index.html');\n});\n```\n\n`__dirname` is a Node.js variable containing the directory name of the currently executing file. Because we know the location of `index.html` to be in the same directory as `index.js`, simply appending the HTML's filename to `__dirname` yields the correct location for the file.\n\n### Resources\nSeparation of Concerns: [https://deviq.com/principles/separation-of-concerns](https://deviq.com/principles/separation-of-concerns)\n\nWhat is HTML?: [https://www.hostinger.com/tutorials/what-is-html](https://www.hostinger.com/tutorials/what-is-html)",
        "sectionType": "chapter",
        "sequence": 2,
        "parentSection": {
          "parentSectionPart": 2,
          "parentSectionType": "part",
          "parentSectionSequence": 2
        }
      },
      {
        "title": "View Templates",
        "slug": "view-templates",
        "content": "## View Templates\n\nStatic HTML files make up the majority of web pages delivered on the internet. An HTML file is considered \"static\" because the content is the same regardless of user identity or any other real-time factors. The benefit of a web *application* is that the application layer has the ability to process the user request and deliver a dynamic experience.\n\nThe ability to deliver a dynamic experience at the view layer is accomplished by use of **view templating.** This allows developers to create files that are a mix of static content and variables which are determined at the time the template is rendered, e.g. in response to a user request.\n\nA template file is written in a **template language**. Template languages are often HTML-like, and support variable injection and often more complex scripting logic such as `for` loops. Modern web browsers cannot natively read the template language. A **templating engine** handles the conversion of a template and variables to an HTML file which is then delivered to the users' browsers.\n\nA view template may have the content `<p>Hello, {{ user.name }}!</p>`, and a template engine would render `<p>Hello, Alexa!</p>`.\n\nThere are several template languages from which to choose. Because of the separation of presentational concerns from application logic, a given language is usually not specfic to a given application architecture, e.g. Node.js. Learning the template language once is transferrable  The application logic will invoke the template *engine* with parameters for which template file to render and what variables should be rendered therein, so it is important to choose a language with a respective template engine compatible with the application.\n\nGiven the ubiquity of view templating across all web server architectures, the problem of compatibility is not generally a concern. Many architectures come with built-in template rendering and a default templating language, and a developer can customize away from the default by adding a new rendering library.\n\n### Resources\n\nTemplate Engines: [https://expressjs.com/en/guide/using-template-engines.html](https://expressjs.com/en/guide/using-template-engines.html)",
        "sectionType": "section",
        "sequence": 1,
        "parentSection": {
          "parentSectionPart": 2,
          "parentSectionType": "chapter",
          "parentSectionSequence": 2
        }
      },
      {
        "title": "Add Template Engine",
        "slug": "add-template-engine",
        "content": "## Add a Template Engine\nThe Express ecosystem supports many trusted template languages. `smartsite` will use the Liquid template language.\n\n### 1. Install template libraries\nThe Node.js application requires functionality for parsing and rendering the template language into HTML. The package `liquidjs` provides the JavaScript bindings for Liquid template rendering. use `npm install` to add the library.\n\n<div class=\"filename\">command line</div>\n\n```\n$ npm install liquidjs\n```\n\n### 2. Register the Liquid template engine\nUsing `liquidjs` as the template engine in the application server requires importing the library, initializing it, and registering it with the Express `app`.\n\nCode like the following should be added to `index.js` before the route declarations.\n\n<div class=\"filename\">index.js</div>\n\n```javascript\nconst { Liquid } = require('liquidjs');\napp.engine('liquid', new Liquid().express());\n```\n\nExpress' `app.engine` method relates a file extension with a rendering engine. As Liquid files are created, they should be created with the `.liquid` file extension (e.g. `filename.liquid`). Express allows multiple `app.engine`s to be set. As such, multiple extensions and multiple rendering engines are valid.\n\n### 3. Create a view template\nA liquid template file supports all valid HTML with the additional functionality of variable rendering and logicial operators. They use a file extension of `.liquid` instead of `.html`. Copy the current `index.html` into a new file named `index.liquid` in the root directory of the application.\n\n<div class=\"filename\">index.liquid</div>\n\n```html\n<!DOCTYPE html>\n<head>\n  <title>SmaRtsite</title>\n</head>\n<html>\n  <body>\n    <h1>Welcome to SmaRtsite!</h1>\n  </body>\n</html>\n```\n\n### 4. Render the view template\nTo send a static HTML file, Express' `response.sendFile` method was used. In the case of view template rendering, a different method must be used to indicate the desired response to send to the user must first be generated through a templating engine, `response.render`.\n\n`response.render` accepts two parameters, 1) the filename and 2) an object of variables with which to render the file.\n\n1. Use `response.render` within the root route handler in place of `response.sendFile`.\n\n<div class=\"filename\">index.js</div>\n\n```javascript\napp.get('/', function(request, response) {\n  response.render(__dirname + '/index.liquid');\n});\n```\n\n2. Save and navigate to `localhost:3000`.\n\n[image welcome to my app]\n\n\n### 5. Configure view options\nAn Express application can be configured with a variety of view options. Setting these options globally well explicity set filesystem architecture, and often allows for cleaner code in Express middleware and improves developer experience.\n\nTo continue the trend of clearly separating concerns, the architecture of `smartsite` will utilize a views directory. Once created, files that are meant to be rendered and/or sent as a user response should be placed in this folder to clearly separate the presentation layer from the JavaScript logic.\n\n1. Create a new folder named `views` in the root directory\nExpress, by default, will look for views (i.e. templates) in a directory named `views`. Specifically, it will look for a directory matching the definition `process.cwd() + '/views'`, where `process.cwd()` is the \"current working directory\" (`cwd`). As most node applications initialize from the root directory, the expanded file path is `<root directory>/views`. Although `smartsite` will utilize the default, this setting is configurable.\n\n2. Move `index.liquid` into the `views` folder.\n\n<div class=\"filename\">views/index.liquid</div>\n\n```html\n<!DOCTYPE html>\n<head>\n  <title>SmaRtsite</title>\n</head>\n<html>\n  <body>\n    <h1>Welcome to SmaRtsite!</h1>\n  </body>\n</html>\n```\n\nAt this point, visiting `localhost:3000` should lead to an error response returned. follow the next step to correct this.\n\n3. Modify `index.js` to render `views/index.liquid`\nWith the Express application set to default its search for views in `/views`, route handlers no longer have to specify the full file path to renderable files. Modify the handler of `/` by removing references to `_dirname`.\n\n<div class=\"filename\">index.js</div>\n\n```javascript\napp.get('/', function(request, response) {\n  response.render('index.liquid');\n});\n```\n\n`localhost:3000` should now render the familiar \"Welcome!\" message.\n\n4. Set the view engine\nExpress' `app.set` method provides a way for developers to configure application-wide settings. A standard setting is \"view engine\" which is used to configure the default file extension for views. Adding the view engine setting allows for developers to omit the file extension from calls to `app.render`.\n\nAdd the setting to `index.js` and remove the `.liquid` extension in the root route.\n\n```javascript\napp.set('view engine', 'liquid');\n\napp.get('/', function(request, response) {\n  response.render('index');\n});\n```\n\nThe application should work as expected.\n\n### 6. `git commit`\nConfiguring and initializing the view engine within `smartsite` is a significant unit of development. This is a perfect time to bookmark filesystem state within version control.\n\n<div class=\"filename\">command line</div>\n\n```\n$ git status\n$ git add .\n$ git commit -m 'Add template engine'\n```\n\n**Keep in mind:** As application development continues, place template files in the `/views` directory with a file extension of `.liquid`. The files may contain static or dynamic content.\n\n### Resources\nExpress' `app.set`: [https://expressjs.com/en/api.html](https://expressjs.com/en/api.html#app.set)\n\nExpress' `response.render`: [https://expressjs.com/en/api.html](https://expressjs.com/en/api.html#res.render)",
        "sectionType": "section",
        "sequence": 2,
        "parentSection": {
          "parentSectionPart": 2,
          "parentSectionType": "chapter",
          "parentSectionSequence": 2
        }
      },
      {
        "title": "Dynamic Content",
        "slug": "dynamic-content",
        "content": "## Dynamically Render Content\n\nA benefit of using view templates is the ability to add content to be rendered at the point of a user request. Within a Liquid template, use the syntax `{{ variable_name }}` to indicate a value passed at render time should be rendered to string. In addition, Liquid's `if/else` syntax `{% if variable_name %} ... {% else %} ... {% endif %}`, offers basic logical switching to determine what block of content to render based on whether the variable is defined at render time. If the statement evaluates to true, \n\nTo directly render a variable, use the double curly brace syntax, `{{ }}`. To script non-rendered view logic, use the curly brace and percent sign syntax, `{% %}`.\n\n### 1. Modify the view to respond to dynamically injected variables.\nAdd a section to `index.liquid` that renders passed in variables. \n\n<div class=\"filename\">views/index.liquid</div>\n\n```html\n<!DOCTYPE html>\n<head>\n  <title>SmaRtsite</title>\n</head>\n<html>\n  <body>\n    <h1>Welcome to SmaRtsite!</h1>\n    <p>This application is running in the <b>{{ nodeEnv }}</b> environment.</p>\n    {% if debug %}\n      <p><b>Debug Information</b></p>\n      <p>Node version: {{ nodeVersion }}</p>\n      <p>Server Time: {{ serverTime }}</p>\n    {% endif %}\n    <p></p>\n  </body>\n</html>\n```\n\nNotice that the \"Debug Information\" section will only render if the `debug` variable is defined. If you navigate to the page at `localhost:3000`, there will be no visible difference. We need to render the page with at least the `debug` variable.\n\n### 2. Render the template with variables.\nModify the `/` route handler to define the variables `debug`, `nodeVersion`, and `serverTime`, and pass them in as the second parameter to `response.render`.\n\n<div class=\"filename\">index.js</div>\n\n```javascript\napp.get('/', function(request, response) {\n  const debug = request.query.debug;\n  const nodeVersion = process.version;\n  const serverTime = new Date();\n  response.render('index', { debug, nodeVersion, serverTime });\n});\n```\n\nNotice the definition of the `debug` variable: `request.query.debug`. The `query` property of Express `Request` objects returns the query parameters section of the requested URL string. By default, query parameters found at `request.query` are formatted as a JavaScript object. For example, the query string of `?debug=true&limit=10` will be of the form `{ debug: 'true', limit: '10' }`.\n\n**Note:** Query string values are necessarily coerced to string for HTTP transport. While a developer may intend to use a boolean or number value from the query string, Express provides the values as strings that must be type cast for use as a boolean or number, etc.\n\n### 3. Load the page\nWith the above changes in place, loading the page at `localhost:3000` renders the same landing page.\n\nTo see the new changes, request the page with a `debug` query string parameter: `localhost:3000?debug=true`. The page should now display a section of \"Debug Information.\"\n\n[image debug information]\n\n### 4. `git commit`\nDynamically rendering the index view within `smartsite` is a significant unit of development. This is a perfect time to save state to version control.\n\n<div class=\"filename\">command line</div>\n\n```\n$ git status\n$ git add .\n$ git commit -m 'Dynamically render index.liquid'\n```\n\n### Review\n\nDynamic display content must be located in the `/views` directory with a file extension of `.liquid`. The files may contain static or dynamic content. If the content should be dynamically rendered, provide an object of local variables as the second parameter `response.render` within the route handler.\n\nThe Liquid template language provides additional functiontality to the HTML specification in the form of flow control (`if/else`), iteration, and many more advanced operations. Visit the Liquid reference guide in **Resources** section to explore Liquid's full feature set.\n\n### Resources\nLiquid Template Language: [https://shopify.github.io/liquid/](https://shopify.github.io/liquid/)",
        "sectionType": "section",
        "sequence": 3,
        "parentSection": {
          "parentSectionPart": 2,
          "parentSectionType": "chapter",
          "parentSectionSequence": 2
        }
      },
      {
        "title": "Liquid Templating",
        "slug": "liquid-templating",
        "content": "## Liquid Templating\nA benefit of a template engine is the ability to separate units of presentation. This allows developers to define view logic once, and reuse the template across multiple pages. This concept will become more explicit by practice. This section details reusing template components between pages to eliminate the need to repeat and maintain separate view scripts.\n\n### 1. Create a new page\nWithin the `views` directory, create a new file names `hello-world.liquid`.\n\n<div class=\"filename\">views/hello-world.liquid</div>\n\n```html\n<!DOCTYPE html>\n<head>\n  <title>SmaRtsite</title>\n</head>\n<html>\n  <body>\n    <h1>Hello World!</h1>\n\n    {% if showDog %}\n      <img src=\"https://i.imgur.com/5Swc751.png\" alt=\"brown dog marley\" width=\"150px\"/>\n    {% endif %}\n\n    <p>Show Marley with query parameter <code>showDog</code>.</p>\n    <p><code>Page loaded at {{ serverDate }}.</code></p>\n  </body>\n</html>\n```\n\n### 2. Create a new route\nRegister a route with the application to allow users to access the new page from a web browser.\n\n<div class=\"filename\">index.js</div>\n\n```javascript\napp.get('/hello-world', function(request, response) {\n  const showDog = request.query.showDog;\n  response.render('hello-world', {\n    showDog,\n    serverDate: new Date()\n  });\n});\n```\n\nWith the server running (`npm run start`), navigate to `localhost:3000/hello-world`, and you should be presented with the greeting \"Hello World!\"\n\n### The Need for Templating\n\nTake a look at `index.liquid` and `hello-world.liquid`. Both pages have the standard HTML boilerplate -- `<html>`, `<head>`, `<body>` -- in common. In fact, any new HTML page will need the basic HTML layout. As front-end development development, it is highly likely that `CSS` and JavaScript assets will be shared between pages. Given the current paradigm of fully separating each web page, a developer adding a global CSS asset would have to add a `<link>` tag *each* .liquid file.\n\nStandard application of the DRY principle (Don't Repeat Yourself) dictates we isolate and define repeated patterns, and reference the one-time definition where necessary. To DRY up `smartsite`'s presentational layer, we need to isolate the base HTML markup layout, and implement the layout in each of the view scripts. This strategy is known as \"template inheritance.\"\n\n### 3. Add a Liquid `layout`\nLiquid has a standard concept of a \"layout\" template. A layout template defines whatever view logic it is meant to encapsulate, and defines areas within its markup meant to be customized by each implementer of the layout.\n\nCreate a file to serve as the layout. This file will contain HTML boilerplate, as well as a delimited section for child pages to provide custom content.\n\n<div class=\"filename\">views/default-layout.liquid</div>\n\n```html\n<!DOCTYPE html5>\n<html>\n  <head>\n    <title>smartsite</title>\n  </head>\n  <body>\n    <header>\n      <a href=\"/\">home</a>\n    </header>\n    {% block content %}\n      default-html.liquid's default content is showing.\n    {% endblock %}\n    <br/><br/>\n    <footer>&copy; by Popular Demand</footer>\n  </body>\n</html>\n```\n\nThe syntax `{% block <block_name> %}{% endblock %}` specifies an area of the template to be overwritten by child pages. A developer can provide default markup within the layouts `block`; the default content is rendered if the child page does not define its own markup for the area.\n\n### 4. Use the layout\nThe `block` to be referenced in the sub-pages is named `content`. An individual sub-page must reference the parent layout, `default-layout.liquid`, and define its own `content` block. A reference to the parent layout is defined with a `layout` block.\n\nModify `hello-world.liquid` to implement the layout and define custom `content`.\n\n<div class=\"filename\">views/hello-world.liquid</div>\n\n```html\n{% layout 'default-layout.liquid' %}\n\n{% block content %}\n  <h1>Hello World!</h1>\n\n  {% if showDog %}\n    <img src=\"https://i.imgur.com/5Swc751.png\" alt=\"brown dog marley\" width=\"150px\"/>\n  {% endif %}\n\n  <p>Show Marley with query parameter <code>showDog</code>.</p>\n  <p><code>Page loaded at {{ serverDate }}.</code></p>\n{% endblock %}\n```\n\nNotice this page no longer features any boiler plate HTML. It only defines two features -- a `layout`\nblock and a `content` block.\n\nFrom the browser, reload the `/hello-world` route to be delivered the page with its newly defined layout. The main content of the pages, a heading and two paragraphs should remain visible. There should also be two elements added from the `default-layout.liquid` layout -- a page header with a link to the root route and a footer element with site information.\n\n### 5. Refactor `index.liquid`\n<dl>\n  <dt>Refactor</dt>\n  <dd>restructure the code of an application so as to improve it without altering functionality</dd>\n</dl>\n\nIsolating the base HTML into a layout was an improvement to the codebase in terms of maintainability. Let's reuse this architecture in all of the pages of the application.\n\n<div class=\"filename\">views/index.liquid</div>\n\n```html\n{% layout 'default-layout.liquid' %}\n\n{% block content %}\n  <h1>Welcome to SmaRtsite!</h1>\n  {% if debug %}\n    <p><b>Debug Information</b></p>\n    <p>Node version: {{ nodeVersion }}</p>\n    <p>Server Time: {{ serverTime }}</p>\n  {% endif %}\n{% endblock %}\n```\n\nAgain, the child page must define its parent `layout` and the `content` block to fill in the layout's `content` block.\n\nNavigating to the root route, `/`, in the broswer should render the `Welcome to SmaRtsite!` heading as well as the Header and footer defined in `default-layout.liquid`.\n\n### Review\n\n`block` is a standard tag provided by Liquid. A layout file uses a `block` tag to define an area that will be replaces with a child page's content. A child page uses `block` to define what to render in its layout's identically named `block`.\n\n`layout` is a functional tag provided by Liquid. It is used in a child page to define what layout the defined markup should be rendered within.\n\nIn the specific case of these changes, \"`content`\" is a developer defined variable name that references an area within the parent layout to be replaced by the markup of a identically named block within the child page.\n\n\n### 6. Add a link to Hello World!\nAs new pages are added to the application, it is good practice to give users an easy method of navigating to the page. Below the heading on the index page, add a link to `hello-world`. (**Note:** In this code block and going forward, only the affected parts of the code are shown. It's unnecessary to alter the unshown elements. Use discernment.)\n\n<div class=\"filename\">views/index.liquid</div>\n\n```html\n<h1>Welcome to SmaRtsite!</h1>\n<p>Links</p>\n<ul>\n  <li><a href=\"/hello-world\">hello-world</a></li>\n</ul>\n```\n\n### 7. `git commit`\nCreating a view layout architecture within `smartsite` is a significant unit of development. Time to save to version control.\n\n<div class=\"filename\">command line</div>\n\n```\n$ git status\n$ git add .\n$ git commit -m 'Add default layout and hello-world'\n```\n\n### Reference\n1. Liquid's `layout`: [https://liquidjs.com/tags/layout.html](https://liquidjs.com/tags/layout.html)",
        "sectionType": "section",
        "sequence": 4,
        "parentSection": {
          "parentSectionPart": 2,
          "parentSectionType": "chapter",
          "parentSectionSequence": 2
        }
      },
      {
        "title": "Deployed Env Heroku",
        "slug": "deployed-env-heroku",
        "content": "## A Deployed Environment\n\nSo far, `smartsite` has only been served from a local development server. To open the application for public web traffic, the application has to have a public IP address, the proper configuration with OSI layer-7 programs allowing public web traffic. Chances are you do not want to open your personal computer to public traffic. As well, learning how to provision a operating system level server is a walkthrough in its own. Luckily, there are Platforms-as-a-Service that provide fully-provisioned server space for launching public web applications with ease. One such platform is Heroku.\n\n### Heroku\n\nHeroku provides the public server space `smartsite` needs. The Heroku platform offers server-processing in the form of what they call \"dynos.\" Heroku's free-tier includes unlimited dynos and 550 dyno hours per month. Verifying the account with a credit card will increase the number of free dyno hours to 1100. Dynos on the free tier will sleep after 30 minutes of inactivity. Visiting the web address of a sleeping dyno will take longer than usual to render the first request as the dyno is activated from the sleeping state.\n\nWhen an application is ready for production-level availability, simply upgrade the dyno to a paid tier to have the application accessible 24/7. At the time of this writing, paid tiers start at $7 per month per dyno.\n\nIn addition to upgrading application availability, Heroku has an Add-ons marketplace which provides database, cache, and application monitoring services to name a few. These services include industry standard tools specially configured for plug-and-play interfacing with the Heroku platform. Each add-on has it's own tiered pricing system, and there are many with a free tier which match Heroku's free tier on being perfectly suited for learning and prototyping.",
        "sectionType": "chapter",
        "sequence": 3,
        "parentSection": {
          "parentSectionPart": 2,
          "parentSectionType": "part",
          "parentSectionSequence": 2
        }
      },
      {
        "title": "Deploying To Heroku",
        "slug": "deploying-to-heroku",
        "content": "## Deploying to Heroku\n\n### Prerequisites\nHeroku manages application deployments with Git. A Git application repository is Prerequisite 0, and necessary for Heroku deployment. A `smartsite` Git repository was initialized in a previous section, but keep this requirement in mind for any future new build.\n\n1. Create a Heroku account\nTo get started with Heroku, you will need a Heroku account. If you do not yet have a Heroku account, navigate to [heroku.com](https://heroku.com) and create one.\n\n2. Install the Heroku CLI\nHeroku provides a command-line interface so that creating, configuring, and maintaining Heroku applications and add-ons is as easy as a terminal command. This is very powerful functionality that ultimately could be done via Heroku's web interface, yet the Heroku terminal commands are much more concise approach to accomplishing these tasks. Install the [Heroku CLI](https://devcenter.heroku.com/articles/heroku-cli) (https://devcenter.heroku.com/articles/heroku-cli).\n\n### 1. `heroku create`\nRun the `heroku create` command. Use the optional `<appName>` parameter to create a user friendly slug.\n\n<div class=\"filename\">command line</div>\n\n```bash\n$ heroku create <appName>\n```\nReplace `<appName>` with your choice of app name. This affects the application's URL. For example, `heroku create smartsite` will be accessible from the URL `smartsite.herokuapp.com`. The output of the command will list the remote application's URL.\n\n<div class=\"filename\">command line</div>\n\n```bash\n$ heroku create smartsite\nCreating ⬢ smartsite... done\nhttps://smartsite.herokuapp.com/ | https://git.heroku.com/smartsite.git\n````\n\nHeroku subdomains must be unique. If the `<appName>` selected is already in use, you will need to re-run the command with a new name. If no `<appName>` is provided, creates the app with a random slug. For example `heroku create` with no name specified will create the URL with a random subdomain such as `sleepy-meadow-81798.herokuapp.com`.\n\nNotice as well that the output of the `create` command also lists the URL for the application's Heroku Git repository. This is Heroku's copy of the filesystem to which `git commit`ed changesets will be applied.\n\n### 2. `git commit`\nThe most recent git commit is what will go live on Heroku. If there are local changes to the working directory that are not committed, they will not be made live on Heroku. Keep this in mind, and use it when appropriate. For now, we will save all local changes to the local git repository and sync the changes to Heroku.\n\n<div class=\"filename\">command line</div>\n\n```\n$ git status\n$ git add .\n$ git commit -m 'Create commit'\n```\n\n### 3. Push to Heroku\nThe `heroku create` command added a remote git repository on Heroku's servers. See this new remote by running the command `$ git remote -v`. Push the code to this remote.\n\n<div class=\"filename\">command line</div>\n\n```\n$ git push heroku [branchName]\n```\n\nYou can watch the build logs output in the terminal. Whether the deployment is successful or not is displayed in the terminal at the end of the logs.\n\n### 4. Access the application.\nThe deployed application can be accessed by navigating in the browser to the URL output by Step 1. You can also open the deployed application with the command `heroku open`.\n\n<div class=\"filename\">command line</div>\n\n```bash\n$ heroku open\n```\n\n### Resources\nThe Heroku CLI: [https://devcenter.heroku.com/articles/heroku-cli](https://devcenter.heroku.com/articles/heroku-cli)",
        "sectionType": "section",
        "sequence": 1,
        "parentSection": {
          "parentSectionPart": 2,
          "parentSectionType": "chapter",
          "parentSectionSequence": 3
        }
      },
      {
        "title": "Authentication",
        "slug": "authentication",
        "content": "## Authentication\n**Authentication** is the process of verifying the identity of an individual. User authentication allows developers of a web application to craft individualized experiences. In practice, this means allowing access to priveleged material such as creating database records and visiting . This ability to deliver dynamic content individualized per visitor session is the general differentiator between a web*site* and a web *application*.\n\nThe ability to register a user account with the app, and sign in and out on request is the basis of user authentication. Identity and Access Management systems is a discipline in its own right. It is a foundational component to the interactive internet. Consider the example of a social media platform.\n\nOnce a user logs in, the application can display content based on user preferences and saved data. Consider the FaceBook profile page. Every user of FaceBook can navigate to `facebook.com/profile`, and be presented with a profile page. Despite receiving the same webpage template, the page is customized to display the feed and information of the currently logged in user.\n\nFurther, if a user *is not* a logged in user of FaceBook, the page does not display and instead redirects to registration form. The ability to gate features is an additional benefit of adding an authentication component to a web application.\n\n### Authorization\n**Authorization** is a term closely related to Authentication. Where authentication refers to the ability to verify the user's identity, authorization refers to allowing or restricting a user's access to certain resources.\n\nIn the example of a social media network, a user that has *not* authenticated with the server (i.e. not signed in) will likely be blocked from accessing a `/profile` page. Further, even if a user is signed in, certain actions like updating a different user's profile information is likely prohibited. For Software-as-a-Service (SAAS) web applications, authorization comes in the form of allowing and restricting application features based on a user's payment tier.\n\nWhile the need for authorization is generally universal for web applications, authorization concerns are specific to the \"business logic\" or domain rules of the application. Questions like how many tiers of user access are necessary and what resources should be available to whom are answered in examination of the real-world business rules the application is built to model.",
        "sectionType": "chapter",
        "sequence": 4,
        "parentSection": {
          "parentSectionPart": 2,
          "parentSectionType": "part",
          "parentSectionSequence": 2
        }
      },
      {
        "title": "Add Auth",
        "slug": "add-auth",
        "content": "## Add Authentication with Auth0\n`smartsite` will utilize the Auth0 service for authentication. Auth0 is a drop-in IAM solution to add authentication and authorization services to an application. Notably, it comes with single-sign on which will allow users of `smartsite` to sign up with the social provider (e.g. Google, Apple) of their choice. In addition to the fundamental authentication flow featured in `smartsite` Basics, Auth0 offers further authentication features such as multi-factor authentication, custom landing pages, and multi-domain applications.\n\n### 1. Sign up for Auth0\nAuth0 provides a user interface for configuring applications' authentication settings. Setting up an application in the interface is a step-by-step walkthrough process.\n\n1. Sign up for Auth0's free tier\n2. Navigate to the Applications Dashboard\n3. \"Create Application\". Set name and select \"Regular Web Application\"\n4. Select Node.js from the list of supported frameworks and \"Integrate now\"\n5. Set the \"Allowed Callback URL\"\n  * Set this value to `https://localhost:3001/callback`.\n  * More the callback URL is covered in the \"Caddy reverse proxy\" section.\n* Set \"Allowed Logout URLs\"\n  * Set this value to `https://localhost:3001`\n\n### 2. Add Auth0 to `smartsite`\nNow that the third-party service is configured to accept requests, we must now add code within `smartsite` that makes calls to Auth0's application interface (API). While using raw HTTP calls to accomplish this is possible, `smartsite` will utilize Auth0 provided API wrapping library, `express-openid-connect`. This package abstracts the HTTP routing and configuration to JavaScript functions and classes with developer-friendly interfaces.\n\n1. Install the `express-openid-connect` authentication middleware.\n\n<div class=\"filename\">command line</div>\n\n```\n$ npm install express-openid-connect\n```\n\n2. Copy the configuration code provided by Auth0's Quick Start wizard.\n\nThe Express OpenID library provides a router that defines authentication routes -- `/login`, `/logout`, and `/callback` -- for the application. Under the hood, the package is using the familiar syntax for defining a route for an Express app.\n\n```javascript\napp.get('/login', handleLogin);\napp.get('/logout', handleLogout);\n```\n\nInstead of the end using developer having to define this logic or handling functions, `express-openid-connect` exposes a configuration object interface. The developer simply initializes the router with application specific configuration, and all authentication routing is forwarded to Auth0 as necessary.\n\nBetter yet, Auth0 provides the configuration object and JavaScript snippet within their Quick Start interface. The snippet goes in `index.js`. It requires the `auth` router from `express-openid-connect`, and configures the `auth` router with variables provided by Auth0.\n\n<div class=\"filename\">index.js</div>\n\n```javascript\nconst { auth } = require('express-openid-connect');\n\nconst config = {\n  authRequired: false,\n  auth0Logout: true,\n  secret: 'a long, randomly-generated string stored in env',\n  baseURL: 'https://localhost:3001',\n  clientID: '[UNIQUE CLIENT ID]',\n  issuerBaseURL: 'https://[UNIQUE ID].us.auth0.com'\n};\n\n// auth router attaches /login, /logout, and /callback routes to the baseURL\napp.use(auth(config));\n```\n\nNext, the snippet provides an example route that utilizes the `isAuthenticated` helper method provided by the `auth` middleware. `smartsite` already has a `/` route, so if you intend to keep the example route, rename its path to avoid pathname conflicts.\n\n<div class=\"filename\">index.js</div>\n\n```javascript\n// req.oidc is provided from the auth router\n// isAuthenticated is a method on the req.oidc object\napp.get('/auth-check', (req, res) => {\n  res.send(req.oidc.isAuthenticated() ? 'Logged in' : 'Logged out');\n});\n```\n\n### 3. Set up an HTTPS proxy\nNotice that the `baseURL` Auth0 is aware of is `https://localhost:3001`. Auth0 requires authentication traffic be delivered via the HTTP**Secure** protocol. HTTPS is an extension to the HTTP protocol, but includes layers of security via encryption and certificate checking to ensure the identity of web servers.\n\nThe Auth0 configuration is different in two ways from the Express server in `index.js`:\n\n<ol>\n  <li>It is served over the <pre>HTTPS</pre> protocol.</li>\n  <li>Its port address is 3001.</li>\n</ol>\n\nIn this step, we'll set up a webserver to traffic (i.e. proxy) HTTPS web traffic at port 3001 to the Express server listening at port 3000. When the proxy server is running, the application available at both `http://localhost:3000` and `https://localhost:3001`.\n\nNote: This solution is for local development. The proxy server will not need to be run in production because Heroku defaults to serving all web traffic over HTTPS.\n\nInstall the `@leafac/caddy` npm library as a dev dependency.\n\n<div class=\"filename\">command line</div>\n\n```\n$ npm i --save-dev @leafac/caddy\n```\n\n### 4. Create a start script for the proxy server\n\nAdd a script, `https-proxy`, to `package.json`:\n\n<div class=\"filename\">package.json</div>\n\n```javascript\n\"scripts\": {\n  ...,\n  \"https-proxy\": \"npx @leafac/caddy reverse-proxy --from localhost:3001 --to localhost:3000\"\n}\n```\n\nThe caddy library defaults to interpreting the `--from` parameter as `https` and the `to` parameter as `http` -- exactly what is needed in this case.\n\nWe can now run `npm run https-proxy` and the proxy server will initialize and forward traffic HTTPS traffic at port 3001 to port 3000. You will have to open seperate terminal windows to run `npm run start` and `npm run https-proxy` concurrently. Alternatively, look into an npm library like [`npm-run-all`](https://www.npmjs.com/package/npm-run-all) for a tool to run both commands from one terminal window.\n\n### 5. Test locally\n1. Within `index.js`, alter `/` route to pass the `isAuthenticated()` boolean to the front end.\n\n<div class=\"filename\">index.js</div>\n\n```javascript\napp.get('/', function(request, response) {\n  response.render('index', {\n    loggedIn: request.oidc.isAuthenticated()\n  });\n});\n```\n\n2. Alter `index.liquid` to show a Logout or Login button depending on whether there is a currently logged in user. Within the list of links:\n\n<div class=\"filename\">index.liquid</div>\n\n```html\n<li>\n  {% if loggedIn %}\n  <a href=\"/logout\">Logout</a>\n  {% else %}\n  <a href=\"/login\">Login</a>\n  {% endif %}\n</li>\n``` \n\n3. To see the full changes, first run the Express and Caddy servers (`npm run start` and `npm run dev-proxy` respectively.) Next, open a browser to `localhost:3001`, and navigate through the authentication flow.\n\n<ol>\n  <li>Click Login</li>\n  <li>Authenticate with Auth0</li>\n  <li>Be redirected back to the base URL, <pre>localhost:3001</pre>.</li>\n  <li>Click Logout</li>\n</ol>\n\n### 6. Git commit the changes\nThis was a significant unit of development. The server now has the ability to authenticate users, albeit only for the local environment. We will look at authentication for the deployed environment in the next section. For now, `git commit`!\n\n<div class=\"filename\">command line</div>\n\n```\n$ git add .\n$ git commit -m 'Add auth in development'\n```\n\n### Resources\nAuth0: https://auth0.com/docs/\n\nAuth0 Explainer Video: https://auth0.com/resources/videos/auth0-explainer-video\n\nAuth0 Express: https://auth0.com/docs/quickstart/webapp/express\n\nHTTPS in Development: https://auth0.com/docs/libraries/secure-local-development\n\nRun Node Commands Simultaneously: https://itnext.io/4-solutions-to-run-multiple-node-js-or-npm-commands-simultaneously-9edaa6215a93",
        "sectionType": "section",
        "sequence": 1,
        "parentSection": {
          "parentSectionPart": 2,
          "parentSectionType": "chapter",
          "parentSectionSequence": 4
        }
      },
      {
        "title": "Auth Deployed",
        "slug": "auth-deployed",
        "content": "## Authentication in the Deployed Environment\nTo get authentication accessible to an internet audience, we will have to get the feature live in a deployed environment. After some minor changes to the Auth0 configuration and application code, the application will be ready for deploy to Heroku.\n\nThe application, both within the code and within the Auth0 interface, is currently configured to use `localhost` addresses for callbacks and redirects. The base URL in the deployed state will be different -- `<your_app_slug>.herokuapp.com` if you are following this walkthrough.\n\nThe first approach to look at is using the same Auth0 application for local development and in the deployed environment. There are use cases for this method, but it is not the most robust solution.\n\n### Authentication Using the Same Auth0 Application\nWithin the Auth0 interface, the application will need to be configured to listen for traffic coming from both the development server *and* the live deployment server. Notably, these servers have different root URLs. \n\n### 1. Modify the Auth0 configuration\n\nAdd `https://<your-app>.herokuapp.com` alongside the `https://localhost` entries.\n\n[image callback_urls.png]\n\nThe \"Allowed Callback URLs\" and \"Allowed Logout URLs\" fields accept comma-separated values. Be sure to use `https` as you type these values. Save changes.\n\n### 2. Modify the Express server\nWithin `index.js`, alter the Auth0 configuration to conditionally use the Heroku URL as the application's `baseURL`.\n\n<div class=\"filename\">index.js</div>\n\n```javascript\n// Auth0\nconst config = {\n  baseURL:\n    process.env.NODE_ENV == 'production' ? 'https://<your-app>.herokuapp.com' : 'https://localhost:3001',\n  ...\n};\n```\n\n### 3. Modify the Procfile\nThe conditional added in step 2 evaluates to true if the `NODE_ENV` environment variable is set to `'production'`. If the env variable is not set or is set to a different value, the conditional will evaluate to false. We will force the environment variable to be set to `'production'` when Heroku starts the server process.\n\nA common method of providing environment variables to a process is to define them immediately before the process command. The `Procfile` contains the command Heroku uses to start the web server. Define `NODE_ENV` at the start of the `web` process.\n\n<div class=\"filename\">Procfile</div>\n\n```\nweb: NODE_ENV=production npm run start\n```\n\n4. Deploy the application to Heroku.\n`git add` and `commit` all changes, then push the Git repository to Heroku.\n\n<div class=\"filename\">command line</div>\n\n```\n$ git add .\n$ git commit -m 'Add auth for Heroku'\n$ git push heroku master\n```\n\nWhen the deploy is finished and if all is configured properly, the application will be available at its deployed URL with the authentication feature. Use the `heroku open` utility to open the app in a web browser.\n\n<div class=\"filename\">command line</div>\n\n```\n$ heroku open\n```\n\n### Resources\nEnvironment Variables in Node.js: [https://www.twilio.com/blog/working-with-environment-variables-in-node-js-html](https://www.twilio.com/blog/working-with-environment-variables-in-node-js-html)",
        "sectionType": "section",
        "sequence": 2,
        "parentSection": {
          "parentSectionPart": 2,
          "parentSectionType": "chapter",
          "parentSectionSequence": 4
        }
      },
      {
        "title": "Environment Variables",
        "slug": "environment-variables",
        "content": "## Environment Variables\nThe need for environment specific configuration is inherent in developing a web application. Environment variables are variables that describe the environment in which the application or script is being invoked. `smartsite` is currently configured to run in two environments: a developer's local system and Heroku for production. As we encountered in the last section, a web application will likely be required to have different configuration for the different environments.\n\nSpecifically, the application needed to be aware of which environment it was running in to know with what `baseUrl` to configure the Auth0 middleware.\n\n<div class=\"filename\">index.js</div>\n\n```javascript\nconst config = {\n  baseURL:\n    process.env.NODE_ENV == 'production' ? 'https://<your-app>.herokuapp.com' : 'https://localhost:3001',\n  ...\n};\n```\n\nEnvironment variables are the solution for the differing configuration variables, yet the implementation varies. Currently, `smartsite` uses an inline ternary operator to determine a selection between two publically available datum. This solution a) does not scale, and b) will not work for datasets we would not like to be publically exposed.\n\nTo get a good grasp on the issues of scalability and security, let's look at the example of adding a new application configuration that will need to be different per environment. For illustration, we'll consider adding database credentials. A database connection requires the Node.js application to be configured with a username, password, and host URL to authenticate with the database server. These values will be different between environments.\n\nAs a look ahead, the foundations covered here will be implemented in the **Database** section.\n\n### Scalability\nBecause `smartsite` runs in only two environments, checking if an environment variable is one of the possible values is able to be accomplished in one line. But what if there were more than two environments? To use the example of adding database credentials, the application will need to be configured for development, production and *test* environment -- this would require a check for one of three values.\n\n<div class=\"filename\">pseudocode</div>\n\n```\nconst dbHost = process.env.NODE_ENV == 'production' ? 'production.database' : process.env.NODE_ENV == 'test' ? 'test.database' : 'development.database';\n```\n\nThis process is barely legible using ternary operators, and a `switch` statement is likely more suited:\n\n<div class=\"filename\">pseudocode</div>\n\n```javascript\nlet dbHost;\nswitch(process.env.NODE_ENV) {\n  case 'production':\n    dbHost = 'production.database'\n  case 'test':\n    dbHost = 'test.database'\n  default:\n    dbHost = 'development.database'\n}\n```\n\nThis is barely more readable. Developers must now contend with minimum 9-line `switch` statements for each database configuration variable. If this pattern continues into future development, each new database, third-party integration or *<reason>* to use environment variables will come with the same burden of clutter.\n\nA solution for scalability looks like keeping configuration variables stored in environment-specific objects. When the application boots up, select the appropriate configuration object based on `NODE_ENV`.\n\n<div class=\"filename\">pseudocode</div>\n\n```javascript\n// index.js\nconst environments = {\n  \"development\": {\n    \"dbUser\": \"popdemtech\",\n    \"dbPassword\": \"popdemtech123\",\n    \"dbName\": \"smartsite\",\n    \"dbHost\": \"localhost:5432\"\n  },\n  \"production\": {\n    \"dbUser\": \"smartsite\",\n    \"dbPassword\": \"myappXYZ123\",\n    \"dbName\": \"smartsite\",\n    \"dbHost\": 'heroku-postgres://smartsite',\n  },\n  \"test\": {\n    \"dbUser\": \"popdemtech\",\n    \"dbPassword\": \"popdemtech123\",\n    \"dbName\": \"smartsite-test\",\n    \"dbHost\": \"localhost:5432\"\n  }\n};\n\nconst config = environments[process.env.NODE_ENV] || environments['development'];\n```\n\nBy collecting variables into environment specific objects, using environment variables within application scripts is as simple as accessing the appropriate property on the environment specific `config` object. Because checking `NODE_ENV` occurs at the point of selecting the correct `config` object, the need for `switch` statments and ternary operators is removed.\n\n<div class=\"filename\">pseudocode</div>\n\n```javascript\n\nconst dbHost = process.env.NODE_ENV == 'production' ? 'production.database' : process.env.NODE_ENV == 'test' ? 'test.database' : 'development.database';\n\n// turns into\n\nconst dbHost = config.dbHost;\n```\n\nThis solves scalability in the following ways:\n\n1. As new **environment variables** are added, the process for development is to add the variable to each environment's object, and access the variable within the JavaScript as `config.<property>`.\n\n2. As new **environments** are added -- such as a remote test environment for a continuous integration workflow -- configuring a environment is as simple as adding a new top-level configuration object, and setting `NODE_ENV` to the proper value at server initialization.\n\n3. There is no complex logic involved in determining the correct set of environment variables to use.\n\n### Security\nThe need for security arises when a web application needs access to data that should not be checked into source code. This is clearly illustrated in the example database credentials within the `environments` object:\n\n<div class=\"filename\">pseudocode</div>\n\n```javascript\nconst environments = {\n  \"production\": {\n    \"dbUser\": \"smartsite\",\n    \"dbPassword\": \"myappXYZ123\",\n    \"dbName\": \"smartsite\",\n    \"dbHost\": 'heroku-postgres://smartsite',\n  }\n};\n```\n\nIf this code is checked into the source repository using `git commit`, a nefarious internet abuser would be able to impersonate the application, and gain full access to the database. While there are many safeguards in place to encrypt transmissions carrying the source code, e.g. HTTPS, there are many areas of the deployment pipeline where application code is readable in plaintext.\n\n**Do not save private keys and passwords to source code.** More than a best practice, this is standard operating procedure for organizational and user security.\n\nWe have been speaking of environment variables in terms of their use in a web application, but have glossed over their practical feature as it pertains to application development at large. An environment variable, conventionally written in `ALL_CAPS` snakecase, is set at the *operating system* or *process* level. This is external to the JavaScript application. The `process.env` variable within Node.js has access to these lower-level variables.\n\nAfter setting the variables within the operating system environment, using these variables within the app is as simple as `process.env`.\n\n<div class=\"filename\">pseudocode</div>\n\n```javascript\nconst environments = {\n  \"production\": {\n    \"dbUser\": process.env.DB_USER,\n    \"dbPassword\": process.env.DB_PASS,\n    \"dbName\": process.env.DB_NAME,\n    \"dbHost\": process.env.DB_HOST,\n  }\n};\n```\n\nWhile the secure variable now will be defined external to the application, an open question remains: *\"Where will environment variables be defined?\"*\n\nFor local development, a file that's been added to `.gitignore` suffices. Heroku, the deployed environment, provides both a CLI and graphic interface for entering custom environment variables.\n\n### Review\nEnvironment variables provide a standard interface for developers to specifiy configuration on a per-environment basis. By extracting environment-dependent configuration into a structured object, we simplify the application code. The code is simplified by a reduction of logic and a compacting of locations where environment variable data can be found.\n\nEnvironment variables are also used to keep secure data out of application logic. By defining and providing variables *external* to the application, these values are not accessible to unethical hackers who may get access to source code.\n\n### Resources\nEnvironment variable: [https://en.wikipedia.org/wiki/Environment_variable](https://en.wikipedia.org/wiki/Environment_variable)\n\nWorking with Environment Variables in Node.js: [https://www.twilio.com/blog/working-with-environment-variables-in-node-js-html](https://www.twilio.com/blog/working-with-environment-variables-in-node-js-html)\n\nThe Twelve Factor App (Config): [https://12factor.net/config](https://12factor.net/config)\n",
        "sectionType": "chapter",
        "sequence": 5,
        "parentSection": {
          "parentSectionPart": 2,
          "parentSectionType": "part",
          "parentSectionSequence": 2
        }
      },
      {
        "title": "Using Env Vars",
        "slug": "using-env-vars",
        "content": "## Using Environment Variables\nAs covered in the last section, environment variables are used to capture environment specifc configuration. We will use the conventions outlined in the previous section to handle environment variables in `smartsite`.\n\nThe Node.js community has converged on the `dotenv` library to manage environment variables in application code. We will add `dotenv` to the application and use environment variables to manage Auth0 configuration variables.\n\n### 1. Install dotenv\nDotenv will be used in all environments. Save it as an application dependency.\n\n<div class=\"filename\">command line</div>\n\n```\n$ npm install dotenv\n```\n\n### 2. Create .env\nDotenv works by reading a file named `.env` located in the root directory. Variables defined in `.env` using the format `VARIABLE_NAME=\"value\"` are read into the application and made available on the `process.env` object.\n\n1. Create `.env`\nIn the root directory, create a new file named `.env`. In this file, define a variable for Auth0 base URL.\n\n<div class=\"filename\">.env</div>\n\n```\nAUTH0_BASE_URL=\"https://localhost:3001\"\n```\n\n### 3. Use the variables in the application\nUsing the dotenv library within the web application involves importing the library, and calling it's `config()` method. This method call attaches the variables to `process.env`, and should be invoked as early in the application script as necessary.\n\n1. Require `dotenv`\n\n<div class=\"filename\">index.js</div>\n\n```javascript\nrequire('dotenv').config();\n```\n\n2. Set `baseUrl` to the environment variable\nReplace the ternary operation with the `AUTH0_BASE_URL` environment variable.\n\n<div class=\"filename\">index.js</div>\n\n```javascript\n// Auth0\nconst config = {\n  ...\n  baseURL: process.env.AUTH0_BASE_URL,\n  ...\n};\n```\n\n3. Restart the server\nTest that the new configuration works by restarting the server and walking through the authentication steps. Remember to start the HTTPS proxy in a separate terminal window. Expect the features to work as before.\n\n<div class=\"filename\">command line</div>\n\n```\n$ npm run start\n$ npm run https-proxy\n```\n\n### 3. Migrate Auth0 configuration\nUsing the same process as outlined, we will migrate more Auth0 configuration to the `.env` file. The criteria used to determine which properties should be managed as environment variables are whether a) the property is configurable within the Auth0 dashboard, b) the property is likely to change if a different Auth0 application is used as a backend, and c) if the data should be kept secure.\n\n* Configurable within Auth0\n  * `baseURL`\n  * `routes.callback`\n* Different per Auth0 application\n  * `clientID`\n  * `issuerBaseURL`\n* Should be kept secure\n  * `secret`\n\n1. Add the specified data to `.env`\n\n<div class=\"filename\">.env</div>\n\n```\nAUTH0_BASE_URL=\"https://localhost:3001\"\nAUTH0_CALLBACK_ROUTE=\"/auth0/callback\"\nAUTH0_CLIENT_ID=\"BdsyUqLCLcMDv21lT9VzCRuo8fP2xvZl\"\nAUTH0_ISSUER_BASE_URL=\"https://dev-r6lb7q89.us.auth0.com\"\nAUTH0_SECRET=\"a long, randomly-generated string stored in env\"\n```\n\n2. Use environment variables to configure Auth0\nReplace the hard-coded strings used to configure the Auth0 middleware with `process.env` variables.\n\n<div class=\"filename\">index.js</div>\n\n```javascript\n// Auth0\nconst config = {\n  authRequired: false,\n  auth0Logout: true,\n  secret: process.env.AUTH0_SECRET,\n  baseURL: process.env.AUTH0_BASE_URL,\n  clientID: process.env.AUTH0_CLIENT_ID,\n  issuerBaseURL: process.env.AUTH0_ISSUER_BASE_URL,\n  routes: {\n    callback: process.env.AUTH0_CALLBACK_ROUTE\n  }\n};\n```\n\n### 4. Generate a `secret` string\nThe Auth0 configuration object's `secret` key is used to encrypt the user's session cookie. This value should be a \"long, random string.\" Technically, the value provided by Auth0's Quick Start satisfies this constraint. To generate a more random string, Auth0 recommends the OpenSSL command line utility.\n\n<div class=\"filename\">macOS/*nix command line</div>\n\n```\n$ openssl rand -hex 32\n```\n\n<div class=\"filename\">Windows command line</div>\n\n```\n> & 'C:\\Program Files\\Git\\usr\\bin\\openssl.exe' rand -hex 32\n```\n\nIf none of the above options work, an online random string generator will do.\n\n3. Replace the environment variable with the output from the command.\n<div class=\"filename\">.env</div>\n\n```\nAUTH0_SECRET=\"ce0b8df696236657682ca78c233b174b1d7581761467270256d778baf1fb9cd5\"\n```\n\n### 5. Restart the server\nChanges to the `.env` file do not trigger the `nodemon` filesystem watcher to restart the Express server. Stop and restart the server process for the application to reflect changes to the `.env` file.\n\n<div class=\"filename\">command line</div>\n\n```\n$ npm run start\n```\n\nThe authentication flow should perform as usual.\n\n### 6. Add a Route\nAdd to the chronicle of `smartsite` by adding a webpage that renders dynamic content based on environment variables.\n\n1. Create a `GET` route\nDefine a route on the Express app that renders a template, `env-vars.liquid`, with local variables.\n\n<div class=\"filename\">index.js</div>\n\n```javascript\napp.get('/env-vars', function (request, response) {\n  const isProduction = process.env.NODE_ENV == 'production';\n  const auth0BaseUrl = process.env.AUTH0_BASE_URL;\n  response.render('env-vars', { isProduction, auth0BaseUrl })\n});\n```\n\n2. Create the view template\nDisplay the `isProduction` and `auth0BaseUrl` local variables within a simple template.\n\n<div class=\"filename\">app/views/env-vars.liquid</div>\n\n```html\n{% layout 'layouts/default-html.liquid' %}\n{% block content %}\n<div>\n  <h1>Environment Variables</h1>\n\n  <p>\n    This webpage has been\n    {% if isProduction %}\n      <b> served from the production environment.</b>\n    {% else %}\n      <b> served from a non-production environment.</b>\n    {% endif %}\n  </p>\n\n  <p>\n    The Auth0 base URL is\n    {% if auth0BaseUrl %}\n      <b>{{ auth0BaseUrl }}</b>\n    {% else %}\n      <b> not defined.</b>\n    {% endif %}\n  </p>\n</div>\n{% endblock %}\n```\n\n3. Add this new page to the site navigation in `index.liquid`.\n\n<div class=\"filename\">app/views/index.liquid</div>\n\n```html\n<li><a href=\"/env-vars\">env-vars</a></li>\n```\n\nWith your development server started, you can now navigate to `/env-vars` from the home page and visualize some of the application's environment variables.\n\n[env-vars-webpage.png image]\n\nThis simplistic page is for demonstration purposes; the primary takeaway should be the new abilities to set application configuration on a per-environment basis.\n\n### 6. Distribute Environment Variables\nEnvironment variables should be kept out of version control. If you used the `.gitignore` provided by this walkthough, `.env` is already included to be ignored.\n\nDespite keeping the sensitive information out of the version control, developers will need a way to share a list of what environment variables are required to configure the application. The standard solution to this is to distribute a `.env.dist` file with source control which contains the environment variable names, but not the sensitive values.\n\nThe `.env.dist` file should be kept up to date as more environment variables are added to the application. This file can be used to onboard new developers to the project, as well it records a list of what environment variables need to be set for the application to run properly in any new environment.\n\n1. Ensure `.env` is an ignored file in `.gitignore`.\n\n2. Create a `.env.dist` file\nCreate the new file mirroring `.env`, but with the sensitive values removed. Discernment dictates the only value that raises security flags is `AUTH0_SECRET`, so its value will be redacted.\n\n<div class=\"filename\">.env.dist</div>\n\n```\nAUTH0_BASE_URL=\"https://localhost:3001\"\nAUTH0_CALLBACK_ROUTE=\"/auth0/callback\"\nAUTH0_CLIENT_ID=\"BdsyUqLCLcMDv21lT9VzCRuo8fP2xvZl\"\nAUTH0_ISSUER_BASE_URL=\"https://dev-r6lb7q89.us.auth0.com\"\nAUTH0_SECRET=\n```\n\n### 7. Git commit all changes\nEnvironment variables configuration is now complete, and the application is working locally. Time to `git commit` the changes in preparation for deployment to Heroku.\n\nUse the command `git status` before running `git add` to ensure `.env` is not saved to version control. `.env.dist` should be listed as an \"untracked file\".\n\n<div class=\"filename\">command line</div>\n\n```\n$ git status\n$ git add .\n$ git commit -m 'Use Auth0 environment variables'\n```\n\n### Resources\nDotenv: [https://www.npmjs.com/package/dotenv](https://www.npmjs.com/package/dotenv)\n\nOpenSSL on Windows: [https://stackoverflow.com/a/68253950/18752242](https://stackoverflow.com/a/68253950/18752242)\n\nRandom String Generator: [https://www.random.org/strings/](https://www.random.org/strings/)\n",
        "sectionType": "section",
        "sequence": 1,
        "parentSection": {
          "parentSectionPart": 2,
          "parentSectionType": "chapter",
          "parentSectionSequence": 5
        }
      },
      {
        "title": "Env Vars In Production",
        "slug": "env-vars-in-production",
        "content": "## Environment Variables in Production\nA cursory glance at the code changes in the last section reveals that we have removed references to `https://<your-app>.herokuapp.com`, but have yet to replace this value. When `require('dotenv').config()` is invoked, *no values will be appended to* `process.env` *since there is no* `.env` *file in the filesystem pushed to Heroku.*\n\nDifferent deployment strategies have different requirements for how environment variables are set. Deployment onto a remote Linux machine may require accessing the server via SSH and manualy creating a `.env` file in the remote environment. Containerized deployment often uses platform-specific configuation files -- such as `docker-compose.yml` for organizing the environment.\n\nHeroku's platform-as-a-service solves deployed environment variables in simple terms. Each Heroku application comes with a Settings page for configuring variables within Heroku's web UI. As well, the `heroku` CLI utility provides a one-line command for setting environment variables remotely.\n\n### Heroku Configuration Variables: Graphic Interface\nHeroku calls environment variables \"Config Vars,\" and these can be found within an application's Settings page.\n\n[heroku application settings.png]\n\nClick \"Reveal Config Vars\" button to show all variables and reveal input fields to edit them. If there are no Config Vars, a descriptive message will be shown. In both cases, a developer can add a new configuration variable directly in this interface by entering a new `KEY` and `VALUE`, and clicking \"Add\".\n\n[heroku empty config vars.png]\n\nFeel free to use the graphic interface to set environment variables. The `smartsite` walkthrough details using Heroku's CLI to accomplish this task.\n\n### Heroku Config Vars: Command-Line Interface\nThe Heroku CLI allows developers to manage Heroku apps directly from the terminal. An app's config vars are accessible via the subcommand `config`. Issuing the command `heroku config --help` displays options for the subcommand.\n\n<div class=\"filename\">command line</div>\n\n```\n$ heroku config --help\ndisplay the config vars for an app\n\nUSAGE\n  $ heroku config\n\nOPTIONS\n  -a, --app=app        (required) app to run command against\n  -j, --json           output config vars in json format\n  -r, --remote=remote  git remote of app to use\n  -s, --shell          output config vars in shell format\n\nCOMMANDS\n  config:edit   interactively edit config vars\n  config:get    display a single config value for an app\n  config:set    set one or more config vars\n  config:unset  unset one or more config vars\n```\n\n### 1. Set a Config Var\nIssue the command `heroku config:set` to set the `NODE_ENV` configuration variable to `production`.\n\n**Note:** Remember what Heroku calls \"config vars\" are more provided to the running application as environment variables.\n\n<div class=\"filename\">command line</div>\n\n```\n$ heroku config:set NODE_ENV=production\n```\n\nCheck that the variable is set by issuing the command `heroku config` with no options.\n\n### 2. Set Auth0 Configuration\nUse the sme process to set a config var for each of the Auth0 environment variables. The one variable which must be different from local configuration is `AUTH0_BASE_URL`. The example commands cover two methods of setting the variables: one at a time and many at once.\n\n<div class=\"filename\">command line</div>\n\n```\n$ heroku config:set AUTH0_BASE_URL=https://<your-app>.herokuapp.com\n$ heroku config:set AUTH0_CALLBACK_ROUTE=/auth0/callback\n$ heroku config:set AUTH0_CLIENT_ID=<your-client-id> AUTH0_ISSUER_BASE_URL=<your-issuer-url> AUTH0_SECRET=<your-secret>\n```\n\nCheck that the variables are set by issuing the command `heroku config` with no options.\n\n### 3. Deploy to Heroku\nNow that the Heroku is aware of the environment variables the Node.js application requires, it is safe to deploy to Heroku without causing an application crash.\n\n<div class=\"filename\">command line</div>\n\n```\n$ git push heroku master\n$ heroku open\n```\n\nAfter the deployment process, run `heroku open` to open the Heroku app. Test that all changes are successful by traversing the authentication flow. Navigate to the `/env-vars` route to see the programmed display messages.\n\n### Resources\nHeroku config CLI: [https://devcenter.heroku.com/articles/config-vars](https://devcenter.heroku.com/articles/config-vars)",
        "sectionType": "section",
        "sequence": 2,
        "parentSection": {
          "parentSectionPart": 2,
          "parentSectionType": "chapter",
          "parentSectionSequence": 5
        }
      },
      {
        "title": "Databases",
        "slug": "databases",
        "content": "## Databases\n\nEnd-users of an application are more engaged if the web application is dynamic. This dynamism can be accomplished with presentational logic alone, yet an improvement to user engagement a web application can provide is if data state can be saved and retrieved across user sessions.\n\nAs an example, imagine a feature that allows the user to log in and create an invoice. A user can log in and create a document with this Invoice Creator. The usefulness of the Invoice Creator application can be increased for the user if, the next time they log in, they see a list of previously created documents. A further increase in feature set -- such as the ability to edit previously saved documents -- is an increase of usability.\n\nA solution to saving and retrieving user data is to save this data in a database.\n\nApproaching the term from a general sense, a database is for persistent data storage. Data storage can be handled in many ways. At the most basic, pen and paper or Google Sheets suffice. Different technical solutions may require different paradigms of database solutions.\n\nA solution to saving and retrieving user data is to save this data in a persisted storage database. This data stays in the application's database when the user is logged in or not, and can be retrieved by the user interacting with the web page or by a developer running analytics on the data.\n\n\n### Deciding on Database Software\nTo reiterate, a database is for persistent data storage. Data storage can be handled in many ways. At the most basic, pen and paper or Google Sheets suffice. Different technical solutions may require different paradigms of database solutions -- such as relational, graph or time-series.\n\n[image of relational and influxdb architecture]\n\nThe question to answer when deciding on a products database technology is, as usual:\n\nWhat is it for?\n\n* What types of data will go in the database?\n* Are there clear domain models or is there simply a need to set and retrieve singular datum?\n* Is this data clearly represented by relationships between the domain models (e.g. books and authors)?\n* Will the data need to be queried for time-series (e.g. a graph display temperature sensor measurements)\n* Do the objects of a given domain model always have the sames attributes or can different objects have different attribute structures?\n* Who is the end user of the queries for the database -- end-users of the product or business analytics tools like Tableau?\n\nFinally, consider overarching questions that relate to development and maintance of the database:\n* What is the budget for the database?\n* What is the time-budget for implementing a database? A developer will have more speed with technology they are already familiar with.\n* What is the experience of maintainers with the technology?\n* Is there a solution offered on the technology platform already in production (e.g. Heroku, AWS)?\n\nFrom questions such as these, parse out the top three considerations that are important to the decision.\n\nFor `smartsite`, three requirements stick out:\n\n* Heroku add-ons: `smartsite` already deployed on Heroku. A single-click, Heroku add-on will be ideal.\n* Free tier: `smartsite` is an open-source walkthrough that offers introductory Node.js guidance for developers of all budgets.\n* SQL: SQL is **the** industry standard language of relational databases. It's likely a builder of `smartsite` is already familiar with its syntax, and, if not, there are decades worth of resources to extend one's knowledge of it.\n\n`smartsite` will use PostgreSQL as its persistent database. Postgres is a open-source and battle-tested SQL based database server and library. There is a Heroku add-on, Heroku Postgres, that will be used for the production database. Locally, developers will need to install the Postgres database.",
        "sectionType": "chapter",
        "sequence": 6,
        "parentSection": {
          "parentSectionPart": 2,
          "parentSectionType": "part",
          "parentSectionSequence": 2
        }
      },
      {
        "title": "Install Postgres Windows",
        "slug": "install-postgres-windows",
        "content": "## 1. Install PostgreSQL on Windows\nThere is a PostgreSQL installer distributed by Enterprise DB (EDB), an enterprise-level Postgres solution. Download the Windows installer from EDB, and follow the steps. https://www.enterprisedb.com/downloads/postgres-postgresql-downloads\n\nKeep note of what is set as the installation directory. The default location is a `C:\\Program Files\\PostgreSQL\\[##]` directory, where `[##]` is the numerical version number of the installation. For example, the installation directory for version 14 is `C:\\Program Files\\PostgreSQL\\14\\`.\n\nKeep note of the password set for the default user as well.\n\n### 2. Configure binary paths\nThe PostgreSQL installation comes with a library of binary executables. These executables, such as `psql`, `pg_dump`, and `createdb`, live within the `/bin` directory of the installation folder, and are how a computer user or different program can interact with the database server. The binary path will be the installation directory from Step 1 suffixed with `\\bin\\`.\n\nFor example, the default binary path for version 14 is `C:\\Program Files\\PostgreSQL\\14\\bin`.\n\n**Note:** Within any software package or application, binary files and executables are conventionally placed within a directory named `\\bin\\`. PostgreSQL follows this convention.\n\n#### Add the binary path to `$PATH`\nTo be able to interact with the database servers, we will need to be able to run the binary exectuables from the terminal. For this, add the binary path to the system's `$PATH` variable\n\n1. Search Windows for the Edit System Environment Variables dialog by pressing Windows key and typing \"environment variables\". Select the result, and a System Properties dialog should appear.\n\n[env-vars-windows.png]\n\n2. Click \"Environment Variables...\" at the bottom of the dialog.\n3. The Environment Variables window is split top and bottom as \"User variables\" and \"System variables\". Within \"System variables,\" double-click the row for the variable name \"Path\".\n\n[3_env-vars.png]\n\n4. Within the Edit environment varibale window that appearch, click the New button, and paste the binary path for PostgreSQL.\n5. Click OK on each of the windows opened for this process.\n6. The PostgreSQL executables have been added to the `$PATH`. To test this, start a new terminal instance and `psql` to see the output of the command.\n\n\n#### Add the binary path to pgAdmin\nThe EDB Installation wizard installs the pgAdmin program, a graphical interface for PostgreSQL. This is can be an alternative interface to access database servers, databases, tables, and other\n* Login to pgAdmin as the default user, `postgres`, using the password set within the installation wizard.\n* Open Preferences dialog, and add the binary path to the version of Postgres you have installed. The location for this is found at File > Preferences > Paths > Binary Paths > PostgreSQL Binary Path > [YOUR_VERSION].\n\n[pgadmin_binary_paths.png]\n\n### 3. Start the Database\n\n1. Start a database server\nThe `pg_ctl` command is used to manage Postgres database servers. Start and stop a database server by specifying the data directory, and supplying the `start` or `stop` subcommand, respectively. The data directory was set in the installation wizard. It defaults to `<postgresql_installation_directory>\\data\\`.\n\n<div class=\"filename\">command line</div>\n\n```\n> pg_ctl restart -D C:\\Program Files\\PostgreSQL\\14\\data\\\n> pg_ctl stop -D C:\\Program Files\\PostgreSQL\\14\\data\\\n> pg_ctl start -D C:\\Program Files\\PostgreSQL\\14\\data\\\n```\n\n### 4. Create a non-default user\nThe `createuser` command is used to create PostgreSQL users. Note that this is a separate list of users than the Windows login users. For example, it is common to create a separate user per software application with database access.\n\n<div class=\"filename\">command line</div>\n\n```\n> createuser --superuser --pwprompt --username=postgres $Env:Username\n```\n\nThis command:\n* creates a user\n* with superuser privileges\n* prompts for the user's password after creation\n* connects to the database server as the `postgres` user\n* sets the user's name to `$Env:Username`, an environment variable within Windows Terminal\n\n### 5. Create a non-default database\nThe `createdb` command is used to create PostgreSQL databases. The database server serves a \"database cluster.\" A database cluster collection of databases that is managed by a single instance of a running database server. In file system terms, it is a single directory in which all data will be stored (i.e. Postgres' `/data` directory.)\n\nThe PostgreSQL installer created a default database named `postgres`. It is convention for each software program to have its own, uniquely-named database. For practice and utility with the `psql` command in upcoming sections, create a new database named after your Windows user.\n\n<div class=\"filename\">command line</div>\n\n```\n> createdb $Env:Username --username=$Env:Username\n```\n\nThis command:\n* creates a database\n* named after the logged in user\n* using the PostgreSQL user named after the logged in user\n\n### 6. Test the Installation\nIf all has gone well, you have the PostgreSQL command-line tools, a running database server, and a user and database within that server. Test all of these by issuing the `psql` command from the command line. This command defaults to connecting with a username of the currently logged in user, and connecting to a database with the same name as the logged in user. This simple command will test all three aspects of installation.\n\n<div class=\"filename\">command line</div>\n\n```\n> psql\n```\n\n### References\nManaging Postgres users and privileges: [https://kb.objectrocket.com/postgresql/how-to-list-users-in-postgresql-782](https://kb.objectrocket.com/postgresql/how-to-list-users-in-postgresql-782)\n\nPostgreSQL Security Best Practices: [https://resources.2ndquadrant.com/hubfs/Whitepaper PDFs/PostgreSQL_Security_Best_Practices_Whitepaper.pdf](https://resources.2ndquadrant.com/hubfs/Whitepaper%20PDFs/PostgreSQL_Security_Best_Practices_Whitepaper.pdf)\n\nHow to start PostgreSQL on Windows: [https://stackoverflow.com/questions/36629963/how-can-i-start-postgresql-on-windows](https://stackoverflow.com/questions/36629963/how-can-i-start-postgresql-on-windows)",
        "sectionType": "section",
        "sequence": 1,
        "parentSection": {
          "parentSectionPart": 2,
          "parentSectionType": "chapter",
          "parentSectionSequence": 6
        }
      },
      {
        "title": "Install Postgres Mac",
        "slug": "install-postgres-mac",
        "content": "## Install PostgreSQL on Mac with Homebrew\n\nHomebrew is a popular package manager for MacOS. A package manager provides the ability to quickly install packages, their dependency packages, and keep the packages up to date. \"Packages\" are software libraries and executables generally runnable from a command-line interface.\n\n1. Install Homebrew\nWhile we will use Homebrew to install PostgreSQL and its dependencies, we first need to install the Homebrew package itself. If you do not already have Homebrew installed, run the following from a MacOS terminal:\n\n<div class=\"filename\">command line</div>\n\n```bash\n$ /usr/bin/ruby -e \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\"\n```\n\n2. Install PostgreSQL\n\n<div class=\"filename\">command line</div>\n\n```bash\n$ brew update\n$ brew install postgresql\n$ postgres --v\n```\n\n3. Create a database cluster\nA database storage area on disk must be initialized before. A database cluster is a collection of databases that is managed by a single instance of a running database server. In file system terms, it is a single directory in which all data will be stored. There is no default location for this to be stored; we will set the location to be `/usr/local/var/postgres`:\n\n<div class=\"filename\">command line</div>\n\n```bash\n$ initdb /usr/local/var/postgres\n```\n\nYou may see the error message: `initdb: directory \"/usr/local/var/postgres\" exists but is not empty`. It means the folder you are attempting to create already exists. You are safe to move on to the next step.\n\n4. Start the database server\nUse the command [`pg_ctl`](https://www.postgresql.org/docs/current/app-pg-ctl.html) to control PostgreSQL database servers. The parameter to the `-D` flag indicates the data directory. Use the data directory created in the previous step via `initdb`.\n\n<div class=\"filename\">command line</div>\n\n```bash\n$ pg_ctl -D /usr/local/var/postgres start\n```\nThis will log the initialization processes, output `server started`, and return function of the CLI to the user. This command started the database process in the background. To stop the database process, run\n\n<div class=\"filename\">command line</div>\n\n```bash\n$ pg_ctl -D /usr/local/var/postgres stop\n```\n\n5. Create a database\nWithin the database cluster, the `initdb` command created a database named `postgres`. Make an additional database named by your MacOS username with the following command:\n\n<div class=\"filename\">command line</div>\n\n```bash\n$ createdb $USER\n```\n\n### References\nManaging Postgres users and privileges: [https://kb.objectrocket.com/postgresql/how-to-list-users-in-postgresql-782](https://kb.objectrocket.com/postgresql/how-to-list-users-in-postgresql-782)\n\nPostgreSQL Security Best Practices: [https://resources.2ndquadrant.com/hubfs/Whitepaper PDFs/PostgreSQL_Security_Best_Practices_Whitepaper.pdf](https://resources.2ndquadrant.com/hubfs/Whitepaper%20PDFs/PostgreSQL_Security_Best_Practices_Whitepaper.pdf)",
        "sectionType": "section",
        "sequence": 2,
        "parentSection": {
          "parentSectionPart": 2,
          "parentSectionType": "chapter",
          "parentSectionSequence": 6
        }
      },
      {
        "title": "Using Psql",
        "slug": "using-psql",
        "content": "## Using `psql`\nThe command `psql` allows the developer to enter into a PostgreSQL command line environment for executing SQL and other tasks involving the data in the database. Despite, the examples in this section using the `$` bash shell prompt, these commands work on Windows as well as Unix-based systems.\n\nTo enter into the postgres shell, use the command `psql` and indicate the database. If `psql` is used with no arguments, a database of the current user's name is assumed.\n\n<div class=\"filename\">command line</div>\n\n```\n$ psql postgres\n```\n\nIn this mode, the command line is prefixed by `[DATABASE NAME]=#`. To see this in action, type `exit` to exit the process for the `postgres` database, and enter into a session with the database named by your username by using `psql` with no arguments.\n\n<div class=\"filename\">command line</div>\n\n```\npostgres=# exit\n\n$ psql # Run this command with no arguments\n\n# List databases\npopdemtech=# \\l\n\n# List users\npopdemtech=# \\du\n```\n\nSee the Reference of this section for more utilities available within the `psql` environment.\n\n7. Get database connection info\nAs part of the NodeJS walkthrough, we will be creating application databases, tables, and queries within the NodeJS application using a JavaScript library specfically for interfacing with the PostgreSQL server.\n\nLike a web server, the PostgreSQL server is accessed via TCP -- that is to say, the web application opens a connection to the database server, requests for data, and receives a response. To successfully connect to the data server, and retrieve data, the web application needs to have record of:\n* The database server host location\n* The specific database's name\n* The user attempting access, and\n* The user's password\n\nThe host for local development is `localhost`. The database name, user name, and password are known by the developer.\n\nTo see connection information, enter the `psql` interface and use the `\\conninfo` command. It will output the database, user, and port of the active `psql` session.\n\n<div class=\"filename\">command line</div>\n\n```\n$ psql databasename\ndatabasename=# \\conninfo\nYou are connected to database \"databasename\" as user \"popdemtech\" via socket in \"/tmp\" at port \"5432\".\n```\n\nA separate database is recommended per web application, and, although user and password can be shared between applications, there are benefits to using unique users and passwords per application as well. This can be called the \"Principle of Least Privilege,\" and revolves around database security.\n\nMost high-level languages (e.g. JavaScript) come with wrapper libraries that handle Postgres database creation. It will likely be necessary to create the `user` and `password` using `psql` or similar utilities.\n\nSee the References for further on PostgreSQL user management and security.\n\n### References\n\nPSQL utilities: [https://www.postgresguide.com/utilities/psql/](https://www.postgresguide.com/utilities/psql/)",
        "sectionType": "section",
        "sequence": 3,
        "parentSection": {
          "parentSectionPart": 2,
          "parentSectionType": "chapter",
          "parentSectionSequence": 6
        }
      },
      {
        "title": "Postgres In Node",
        "slug": "postgres-in-node",
        "content": "## Setting up PostgreSQL in an NodeJS Application\nPostgreSQL is a separate server than the NodeJS web server. It provides a TCP interface to access and modify data in the database. The NodeJS application must be configured to connect to a PostgreSQL database server.\n\nOnce the connection with PostgreSQL is configured, we will introduce a JavaScript library, Sequalize, to provide a developer-friendly interface for the data models and queries.\n\n### 1. Install Sequelize and Postgres Libraries\nUse the package manager to add the sequeilze and postgres client libraries.\n\n<div class=\"filename\">command line</div>\n\n```\n$ npm install --save sequelize sequelize-cli pg pg-hstore \n```\n\n`sequelize` and `sequelize-cli` are the developer interface, and contain the functions and classes we will be using primarily. `pg` and `pg-hstore` are lower-level client drivers between Node and Postgres. These libraries are required for runtime in production, so use the `--save` flag to add them as dependencies in `package.json`.\n\n### 2. Initialize Sequelize\n1. Create a file in the root of the project named `.sequelizerc` with the following contents:\n\n<div class=\"filename\">.sequelizerc</div>\n\n```javascript\nconst path = require('path');\n\nmodule.exports = {\n  'config': path.resolve('config', 'sequelize.js'),\n  'models-path': path.resolve('models'),\n  'migrations-path': path.resolve('db', 'migrations'),\n  'seeders-path': path.resolve('db', 'seeds'),\n};\n```\n\n2. Run the `sequelize-cli init` command for the library to add the required boilerplate.\n\n<div class=\"filename\">command line</div>\n\n```\n$ npx sequelize-cli init\n```\n\nBased on the configuration within `.sequelizerc`, the command creates following folders:\n* config/sequelize.js -- the Sequelize config file which tells CLI how to connect with database\n* models -- the directory for the data models for your project\n* db/migrations -- the directory for the database migration files\n* db/seeds -- the directory for the database seed files\n\n### 3. Configure database credentials\nFor the Node.js application to connect to the Postgres server, it must be configured with the a) server's address, b) user name, and c) user password. The file `./config/sequelize.js`, contains the database connection configuration for three environments -- `development`, `test`, and `production`. set the username, password, database, and dialect.\n\nChange the username and password for the `development` connection to credentials of your Postgres user. Change the database to the name of the database your application should use. Sequelize will create the database if one by the name specified does not already exist. Change the dialect to `postgres`. \n\nThe `test` and `production` configurations will need to be corrected before running database transactions in those environment.\n\n<div class=\"filename\">config/sequelize.js</div>\n\n```\nmodule.exports = {\n  \"development\": {\n    \"username\": \"root\",        // Change this\n    \"password\": null,          // Change this\n    \"database\": \"my-service\",  // Change this\n    \"host\": \"127.0.0.1\",\n    \"dialect\": \"postgres\"      // Change this\n  },\n  ...\n}\n```\n\nAs shown in the code example, export the configuration object using `module.exports = ` at the beginning of the file.\n\n### 4. Create the database\nCreate the application's database.\n\n<div class=\"filename\">command line</div>\n\n```\n$ npx sequelize db:create\n```\n\n### Resources\n`sequlize-cli` documentation: [https://github.com/sequelize/cli](https://github.com/sequelize/cli)\n\nWhat is an ORM?: [https://stackoverflow.com/a/1279678/18752242](https://stackoverflow.com/a/1279678/18752242)",
        "sectionType": "section",
        "sequence": 4,
        "parentSection": {
          "parentSectionPart": 2,
          "parentSectionType": "chapter",
          "parentSectionSequence": 6
        }
      },
      {
        "title": "Using Sequelize",
        "slug": "using-sequelize",
        "content": "## Using Sequelize in a Node.js Application\nSequelize is an ORM -- an Object Relational Mapping library. The benefit of an ORM is that it abstracts SQL query dialect into application language. It also converts the response of any query into application level data types such as arrays or custom objects. Sequelize and many other ORM libraries call these custom objects \"models.\" \n\nA database table is a collection of objects with specified data attributes. Viewed as a table, there is a row for each specific object and columns for attributes an object can have. A ficticious \"posts\" that contains a collection of resources with the attributes of title, content, and created_at.\n\n```\npostgres=# select * from posts;\nid | title               | content                         | publishDate \n---+---------------------+---------------------------------+------------------------\n1  | My First Post       | Hello World!                    |  2022-04-03 12:00:00-06\n2  | How to JavaScript   | Objects and functions.          |  2022-04-04 12:00:00-06\n3  | SOLID Breakfast     | The principles of SOLID design. |  2022-04-05 12:00:00-06\n(3 rows)\n```\n\nIn an ORM, this structure is made accessible in the programming language, such as JavaScript's class objects. These models are an abstraction that represents a table in the database.\n\nWe can use `sequelize-cli` to generate both the database tables and JavaScript classes. \n\n### 1. Generate a `posts` migration and JS classes using the `model:generate` command.\n\n<div class=\"filename\">command line</div>\n\n```\n$ npx sequelize model:generate --name Post --attributes title:string,content:text,publishDate:date\n```\nThis creates two files\n* models/post.js\n* db/migrations/[timestamp]-create-post.js\n\n### 2. Run the migration.\nMigration files are used to keep track of changes made to a database. Migrations are used to track creating tables, adding and removing columns to existing tables, and other operations. Migration files record how to transition the database to a new state, and how to rollback the changes to get back to the older state.\n\nDatabase migration files are like a version control system for the application database, and provide replayable changes that keep the variety of development databases, test databases, and production databases in sync.\n\nLooking at the migration file generated by `model:generate`, we can see that Sequelize added two attributes `createdAt` and `updatedAt`. This is convention, and the values will be set and kept up to date by the Sequelize engine.\n\nRun the migration command to create the `posts` table in the database.\n\n<div class=\"filename\">command line</div>\n\n```\n$ npx sequelize db:migrate\n```\n\nThis command executes the following steps:\n* Ensures a table called SequelizeMeta is in database. This table is used to record which migrations have run on the database.\n* Runs any migration files which haven't run yet. This is possible by checking SequelizeMeta table.\n\nIn this case, the `create-post` migration file will be executed against the database resulting in a new `posts` table being created.\n\n### 3. Seed the database\nTo \"seed\" the database is to programmatically insert values into the database -- no user interaction required. This is useful for transferring a known data set into the database or populating tables with dummy data for development.\n\n1. Track development seeds within database.\nUnlike migrations, database seeding events are not stored anywhere by default. This means every time the `db:seed:all` command is run, the database will be re-seeded with previously run seeds. To change from the default behavior, add the configuration `\"seederStorage\": \"sequelize\"` to the development object of `config/sequelize.js`.\n\nThis will save to the database which seeds have been run, allowing for use of the developer friendly `db:seed:all`.\n\n<div class=\"filename\">config/sequelize.js</div>\n\n```\nmodule.exports = {\n  \"development\": {\n    ...,\n    \"seederStorage\": \"sequelize\"\n  },\n  ...\n}\n```\n\n2. Generate a new seed file\nUse the `seed:generate` command provided by `sequelize-cli` to generate a seed file for the Post model.\n\n<div class=\"filename\">command line</div>\n\n```\n$ npx sequelize seed:generate --name first-posts\n```\n\nThis command creates a file, `db/seeds/[timestamp]-first-posts.js`. Like a migration, the seed file implements an `up/down` interface. The `up` command specifies what actions should be performed to seed the database. The `down` function should specify how to undo the actions.\n\n3. Define a few post objects in an array:\n\n<div class=\"filename\">db/seeds/[timestamp]-first-posts.js</div>\n\n```javascript\nconst posts = [{\n  title: 'Hello World',\n  content: 'This is the first post!',\n  publishDate: new Date('2022-01-01'),\n  createdAt: new Date(),\n  updatedAt: new Date()\n}, {\n  title: 'Lorem Ipsum',\n  content: `\n    Lorem Ipsum is simply dummy text of the printing and typesetting industry.\n    Lorem Ipsum has been the industry's standard dummy text ever since the 1500s,\n    when an unknown printer took a galley of type and scrambled it to make a type specimen book.\n    Contrary to popular belief, Lorem Ipsum is not simply random text.\n    It has roots in a piece of Latin literature from 45 BC.\n  `,\n  publishDate: new Date('2022-01-02'),\n  createdAt: new Date(),\n  updatedAt: new Date()\n}];\n```\n\n4. Define the `up` and `down` methods\nIn the `up` method, use the provided `queryInterface` class to bulk insert the posts into the database.\n\n<div class=\"filename\">db/seeds/[timestamp]-first-posts.js</div>\n\n```javascript\nasync up (queryInterface, Sequelize) {\n  await queryInterface.bulkInsert('Posts', posts, {});\n},\n```\n\nIn the `down` method, perform the reverse action of the `up` method by deleting the posts. To use Sequelize's `Op` (short for \"operation\") library, import it at the top of the file.\n\n<div class=\"filename\">db/seeds/[timestamp]-first-posts.js</div>\n\n```javascript\nconst { Op } = require(\"sequelize\");\n\nconst posts = [...];\n\nmodule.exports = {\n  async up (queryInterface, Sequelize) { ... },\n\n  async down (queryInterface, Sequelize) {\n     await queryInterface.bulkDelete('Posts', {\n      title: {\n        [Op.in]: posts.map((post) => post.title)\n      }\n     }, {});\n  }\n}\n```\n\nThis `bulkDelete` query generates the following SQL:\n```\nDELETE FROM \"Posts\" WHERE posts.title IN [\"Hello World\", \"Lorem Ipsum\"];\n```\n\n3. Seed the database\n\n<div class=\"filename\">command line</div>\n\n```\n$ npx sequelize-cli db:seed:all\n```\nThis command inserts the records into the database.\n\n### 4. Display database records\nThe purpose of a database is to keep data organized. The purpose of keeping the data around is for human end-users to view and manipulate. To get the data viewable by the user, we will provide a webpage that lists the data. As part of handling the webpage request, we will query the database for the records, and supply the records as template variables.\n\n1. Create the route.\nCreate a route `/posts` in `index.js`.\n\n<div class=\"filename\">index.js</div>\n\n```javascript\napp.get('/posts', (request, response) => {\n  response.render('posts', {\n    posts: []\n  });\n});\n```\n\n2. Create the template\nCreate a new file, `app/views/posts.liquid` with the following code:\n\n<div class=\"filename\">views/posts.liquid</div>\n\n```html\n{% layout 'layouts/default-html.liquid' %}\n{% block content %}\n<div>\n  <h1>Posts</h1>\n\n  {% for post in posts %}\n    <h2>{{ post.title }}</h2>\n    <p><i>{{ post['publishDate'] }}</i></p>\n    <p>{{ post['content'] }}</p>\n  {% else %}\n    <p><i>There are no posts to display.</i></p>\n  {% endfor %}\n</div>\n{% endblock %}\n```\n\nNavigate to `localhost:3000/posts`. Because the `posts` template variable is hard-coded to be an empty array, you should see a page that says \"There are no posts to display.\"\n\n3. Query the database for posts\nSequelize as an ORM provides JavaScript classes as abstraction over the SQL query language. The `Post` class found in `models/post.js` is such a class. We will import the class into `index.js` and use the `.findAll()` method to populate the `posts` template variable.\n\n<div class=\"filename\">index.js</div>\n\n```javascript\nconst { Post } = require('./models');\n\napp.get('/posts', async function(request, response) {\n  response.render('posts', {\n    posts: await Post.findAll()\n  });\n});\n```\n\nWith the addition of the asynchronous method `Post.findAll()`, we must also label the route handling function as `async`. Notice the addtion of the keyword `async` before the function defintion.\n\nPlace the require statement at near the top of the file with the other `require` statements. Place the route near the other routes definitions.\n\nRefreshing the `/posts` web page now shows the two posts seeded in the database.\n\n4. Add a link to Posts on the homepage.\nShow off the database! Add a navigation link to the `views/index.liquid`.\n\n<div class=\"filename\">index.liquid</div>\n\n```html\n<li><a href=\"/posts\">Posts</a></li>\n```\n\n### Resources\n\nSequelize model basics: [https://sequelize.org/docs/v6/core-concepts/model-basics](https://sequelize.org/docs/v6/core-concepts/model-basics)\n\nSequelize Seeds: [https://sequelize.org/docs/v6/other-topics/migrations](https://sequelize.org/docs/v6/other-topics/migrations/#creating-the-first-seed)\n\nSequelize Query Interface: [https://sequelize.org/docs/v6/other-topics/query-interface/](https://sequelize.org/docs/v6/other-topics/query-interface/)\n\nSequelize `QueryInterface` API : [https://sequelize.org/api/v6/class/src/dialects/abstract/query-interface.js](https://sequelize.org/api/v6/class/src/dialects/abstract/query-interface.js~queryinterface)",
        "sectionType": "section",
        "sequence": 5,
        "parentSection": {
          "parentSectionPart": 2,
          "parentSectionType": "chapter",
          "parentSectionSequence": 6
        }
      },
      {
        "title": "Deployed Database",
        "slug": "deployed-database",
        "content": "## Database in the Deployed Environment\nEach environment -- development, test, production, etc -- will likely use a different PostgreSQL database server. This means the Node.js application will need to be configured with a database URL and user credentials at a per environment specification. Sequelize's `config` file provides the location to specify these differences.\n\nThe platform we will be using to host the PostgreSQL server is Heroku Postgres, an add-on provided by Heroku. There is a free tier with paid plans available to increase data capacity and concurrency as the application storage and/or traffic grows. Heroku Postgres configures the server URL and user credentials, and provides these values via an environment variable, `DATABASE_URL`.\n\n### 1. Add the Heroku Postgres add-on\n1. From the command-line interface, use the `heroku addons:create` command to add the Heoku Postgres add-on, hobby-dev tier.\n\n<div class=\"filename\">command line</div>\n\n```\n$ heroku addons:create heroku-postgresql:hobby-dev\n```\n\n2. Use the `DATABASE_URL` environment variable in production\nWithin the `config/sequelize.js` **production** object, set the keys `use_environment_variable` and `ssl.rejectUnauthorized`. Remove the unneeded piecewise credentials; `DATABASE_URL` contains user and database location information. The following code snippet includes the full `production` object.\n\n<div class=\"filename\">config/sequelize.js</div>\n\n```\n\"production\": {\n  \"use_env_variable\": \"DATABASE_URL\",\n  \"dialect\": \"postgres\",\n  \"dialectOptions\": {\n    \"ssl\": {\n      \"rejectUnauthorized\": false\n    }\n  }\n}\n```\n\n3. Ensure the NODE_ENV environment variable is set on Heroku server.\n\n<div class=\"filename\">command line</div>\n\n```\n$ heroku config:set NODE_ENV=production\n```\n\n### 2. Run the application\n1. Commit and push the new changes to Heroku\n\n<div class=\"filename\">command line</div>\n\n```\n$ git add .\n$ git commit -m 'Use Heroku Postgres'\n$ git push heroku HEAD\n```\n\n2. Run the database migration on Heroku\nUse the `heroku run` command to execute the Sequelize CLI commands in Heroku's server environment.\n\n<div class=\"filename\">command line</div>\n\n```\n$ heroku run npx sequelize db:migrate --env production\n```\n\n3. Seed the database\n\n<div class=\"filename\">command line</div>\n\n```\n$ heroku run npx sequelize db:seed:all\n```\n\n4. View the app\nIssue the command `heroku open` to open the deployed application. Navigate to the `/posts` route to see the seeded posts.\n\n<div class=\"filename\">command line</div>\n\n```\n$ heroku open\n```\n\nThat's a deployed database! This simple tool is the backbone of the internet. Now that we have a database live on the interconnected web, we are able to provide our users with experiences on our web apps that can be customized on a per user basis.\n\nWe will be looking at saving user generated information in upcoming sections.\n\n### Resources\n\nHeroku Postgres: [https://devcenter.heroku.com/articles/heroku-postgresql](https://devcenter.heroku.com/articles/heroku-postgresql)\n\nSequelize Heroku Postgres Settings: [https://github.com/sequelize/sequelize/issues/956](https://github.com/sequelize/sequelize/issues/956#issuecomment-778149933)\n\nDeploy Sequelize to Heroku: [https://anjelicaa.medium.com](https://anjelicaa.medium.com/deploying-a-node-js-postgres-sequelize-app-to-heroku-da3dc9de07cd)\n",
        "sectionType": "section",
        "sequence": 6,
        "parentSection": {
          "parentSectionPart": 2,
          "parentSectionType": "chapter",
          "parentSectionSequence": 6
        }
      },
      {
        "title": "User Interaction Project",
        "slug": "user-interaction-project",
        "content": "## Capturing User Information\r\nThe strength of a database comes into play when the developer uses it to capture user interaction within the web application. This saved information can then be displayed to the user to demonstrate the applications interactivity.\r\n\r\n### Click Tracker Application\r\nThis feature will allow any user to click a button and counter will increment. This counter increments over time as users click the button. If you think about it, users from anywhere on the globe can log into this application, and click this button. Pretty cool.\r\n\r\nThis feature will require:\r\n* a button\r\n* text displaying how many times the button has been clicked\r\n\r\n### 1. Decide the data model\r\nThis feature will require that we persist the total number of times a button has been clicked in a database. To accomplish this, we will create a database table, `Clicks`.\r\n```\r\nClicks\r\n-----------+-------------+\r\nuser       | VARCHAR\r\ncreatedAt  | DATE\r\nupdatedAt  | DATE\r\n```\r\n\r\nTo find how many times the button has been clicked, a SQL `COUNT(*)` command can be used. This data model has the additional benefit of saving user information with the click event. This will be aided by the authentication system, and allows for a follow-up feature of displaying how many times a particular user has clicked the button.\r\n\r\nGenerate a model and migration using Sequelize's `model:generate` command, and migrate the database with `db:migrate`.\r\n\r\n<div class=\"filename\">command line</div>\r\n\r\n```\r\n$ npx sequelize model:generate --name Click --attributes user:string\r\n$ npx sequelize db:migrate\r\n```\r\n\r\n### 2. Create the web page route\r\nWithin `index.js`, create a route, `/click-tracker`. This route should render a page `click-tracker.liquid`.\r\n\r\nThe number of times the button has been clicked in total will be saved in a database, and fetched at the initial user request. The liquid-HTML template will be rendered with this number. Hard-code the value to 10 for now.\r\n\r\n1. Import the `Click` class from Sequelize's model directory.\r\n\r\n<div class=\"filename\">index.js</div>\r\n\r\n```javascript\r\nconst { Post, Click } = require('./app/models');\r\n```\r\n\r\n2. Create the route.\r\nThe route handler must be labeled async to be able to use the asynchronous `await Click.count()`. Send the result of `Click.count()` to the view as the template variable `timesClicked`.\r\n\r\n<div class=\"filename\">index.js</div>\r\n\r\n```javascript\r\napp.get('/click-tracker', async function (request, response) {\r\n  response.render('click-tracker', {\r\n    timesClicked: await Click.count()\r\n  });\r\n});\r\n```\r\n\r\n3. Create the webpage.\r\nA view template named `click-tracker.liquid` must be created.\r\n\r\n<div class=\"filename\">views/click-tracker.liquid</div>\r\n\r\n```html\r\n{% layout 'layouts/default-html.liquid' %}\r\n{% block content %}\r\n<h1>Click Tracker</h1>\r\n<button id=\"click-me\">Click Me!</button>\r\n<p>This button has been clicked <span id=\"times-clicked\">{{ timesClicked }}</span> times.</p>\r\n{% endblock %}\r\n```\r\n\r\nYou should now be able to start the server, navigate to `https://localhost:3000/click-tracker`, and see the desired initial page.\r\n\r\n### 3. Handle user interaction\r\nAt this point, nothing happens if a user clicks the on-screen button. Let's change this by adding a JavaScript click event listener on the button. Add a `<script>` tag within the `content` block.\r\n\r\n<div class=\"filename\">views/click-tracker.liquid</div>\r\n\r\n```html\r\n<script>\r\n  const button = document.getElementById('click-me');\r\n  button.addEventListener('click', function(event) {\r\n    console.log('Button clicked!');\r\n  });\r\n</script>\r\n```\r\n\r\n### 4. Make API request on click\r\nFor the moment, the click handling function only prints out `'Button clicked!'`. The desired functionality is for the button click to initiate a request to the webserver. The webserver will receive the request and add a `Click` database record.\r\n\r\nFrom the front-end, we will use the Fetch API to make and handle the network request. The Fetch API provides a JavaScript interface for fetching resources and interacting with the HTTP pipeline. Within a browser (e.g. Chrome), a global  `fetch()` method provides an easy-to-use way to fetch resources asynchronously across the network.\r\n\r\nThe `fetch()` method returns a Promise. A JavaScript Pro\r\n\r\nReplace the `console.log` within the click handler with a `fetch` call.\r\n\r\n<div class=\"filename\">views/click-tracker.liquid</div>\r\n\r\n```html\r\n<script>\r\n  const button = document.getElementById('click-me');\r\n  button.addEventListener('click', function(event) {\r\n    fetch('/api/clicks', { method: 'POST' })\r\n    .then((response) => {\r\n      response.ok ? console.log('Click Added') : console.log('Error Occured');\r\n    });\r\n  });\r\n</script>\r\n```\r\nThe `response.ok` is a utility property on the `Response` object returned by `fetch`. A response with an HTTP status code 200-299 has and `ok` value of `true`.\r\n\r\n### 5. Create the API route\r\nIn line with RESTful standards, we will make a route that accepts a `POST` request to `/clicks` to create a click resource. The the `POST` request is successful, we will return to the user the new total number of clicks in the database.\r\n\r\n1. Create the POST `/clicks` route\r\n\r\n<div class=\"filename\">indes.js</div>\r\n\r\n```javascript\r\napp.post('/api/clicks', async function(request, response) {\r\n  const user = request.oidc.user ? request.oidc.user.email : null;\r\n  await Click.create({ user: user });\r\n  response.json({ timesClicked: await Click.count() });\r\n});\r\n```\r\n\r\n### 6. Handle an error using Express middleware\r\nDue to validations and user input errors, creating database records is a process that is expectedly error prone. Click Tracker deals with a relatively small model with no truly custom user input, yet it is good practice to handle where known errors may arise and deliver useful information to the front-end application and user.\r\n\r\nThe Express way to handle errors is to use its middleware framework. We have already used Express' middleware in implementing the `auth()` functionality. The middleware framework is a pipeline of functions that have access to the `request` and `response` objects. A given middleware can execute any code and make changes to the `request` and `response` objects. When it is done with its computation, it must end the request/response cycle or call the `next` middleware function in the pipeline.\r\n\r\nIn this way, every route that is defined -- e.g. `GET /hello-world` -- is part of the middleware pipeline. The routes created thus far end the request/response cycle by not calling a `next` middleware. In fact, because `next` has not been needed, I have left this variable out of the route handler definitions. An Express route handler has the following signature:\r\n\r\n<div class=\"filename\">pseudocode</div>\r\n\r\n```javascript\r\nconst routeHandler = function(request, response, next) { ... };\r\napp.get('/path', routeHandler);\r\n```\r\n\r\nA middleware handler has the similar signature:\r\n\r\n<div class=\"filename\">pseudocode</div>\r\n\r\n```javascript\r\nconst middleware = function(request, response, next) { ... };\r\napp.use(middlewareHandler);\r\n```\r\n\r\nError handling middleware has a slightly differing signature; the first parameter is a JavaScript error object.\r\n\r\n<div class=\"filename\">pseudocode</div>\r\n\r\n```javascript\r\nconst errorHandlingMiddleware = function(error, request, response, next) { ... };\r\napp.use(errorHandlingMiddleware);\r\n```\r\nThe application knows to use the error handling middleware if `next` is invoked with an error object.\r\n\r\n1. Create the error handling middleware.\r\nAs will all middleware, Express will invoke the functions in the order they are applied to the application with `app.use()`, top to bottom. As such, `app.use` this middleware below the route definitions within `index.js`.\r\n\r\n<div class=\"filename\">index.js</div>\r\n\r\n```javascript\r\napp.use(function (error, request, response, next) {\r\n  if (!error.apiError) {\r\n    return next(error, request, response, next);\r\n  }\r\n  response.status(error.statusCode);\r\n  response.json({ message: error.message });\r\n});\r\n\r\n```\r\nThis code checks for the existance of the a property `apiError` on the `error` parameter. If it is not present, the function passes the error to the next error handling middleware. If the property is present, the status of the response is set to the statusCode of the error, and a JSON response is returned with the error's message.\r\n\r\nAn important aspect of this code is that it returns a JSON response. Express' default error handler returns an HTML response. For `pd-service`, we will standardize this behavior and return JSON in case of error.\r\n\r\n2. Invoke the error handler in case of application error.\r\nWith the error handler is in place, the route handler must be changed to pass any errors to the error handling middleware. The third parameter, `next`, should be added to the handler's function definition. It has always been passed in at runtime, but because it was unnecessary, it hasn't been added to the code until now.\r\n\r\n`Click.create` will throw an error if the create is unsuccessful. Wrap this function call in a `try/catch` block. If an error is caught, set the properties on it the custom error handling middleware is expecting -- `apiError` and `statusCode` -- and invoke the `next` middleware the error.\r\n\r\n<div class=\"filename\">index.js</div>\r\n\r\n```javascript\r\napp.post('/api/clicks', async function(request, response, next) {\r\n  const user = request.oidc.user ? request.oidc.user.email : null;\r\n  try {\r\n    await Click.create({ user: user });\r\n    response.json({ timesClicked: await Click.count() });\r\n  } catch (e) {\r\n    e.apiError = true;\r\n    e.statusCode = 422;\r\n    next(e);\r\n  }\r\n});\r\n```\r\n\r\nWith the last line -- `next(e)` -- the request/response cycle is moved to the error handling middleware pipeline.\r\n\r\n### 7. Handle the API response\r\nThe sequence of events currently programmed is the following:\r\n* User clicks the button\r\n* A `fetch` request is made to the `/clicks` route\r\n* The route processes the request and returns a JSON response\r\n\r\nA response handler must be written within the front-end JavaScript to process the response.\r\n\r\nThe `fetch` call resolves to a `Response` interface that represents the response to a request. The `json()` method on this interface returns a promise of the result of parsing the response body into JSON. We'll want to access the `timesClicked` property we set on the response body.\r\n\r\n<div class=\"filename\">views/click-tracker.liquid</div>\r\n\r\n```html\r\n<script>\r\n  const button = document.getElementById('click-me');\r\n  button.addEventListener('click', function(event) {\r\n    fetch('/api/clicks', { method: 'POST' })\r\n    .then((response) => {\r\n      if (!response.ok) return;\r\n      \r\n      response.json()\r\n      .then((data) => {\r\n        document.getElementById('times-clicked').innerHTML = data.timesClicked;\r\n      });\r\n    });\r\n  });\r\n</script>\r\n```\r\nThe script makes use of a preset `<span id=\"times-clicked\">`, and replaces the value that present there with the more recent count of clicks.\r\n\r\nYou should now be able to click the button multiple times and see the number on screen increment by one each time. If you refresh the page, the number will remain at the last seen value.\r\n\r\n### 8. Handle the API error response\r\nIt is good practice to inform the user of an application error. It's wise to consider whether the user can be helped by the error. For example, it's prudent to show the user if the error is due to an input validation error; the user can change their input and correct the problem. If the error is due to an obscure error the user cannot correct, such as invalid database credentials failing authentication, it is more appropriate to show the user a generic error or none at all.\r\n\r\nThe case of the Click Tracker application coming into an error state fits into the latter distinction. The plan is to place an error message within the HTML. It will be hidden by default, but when an error response is received, it will be displayed. Whenever a new request is initalized -- when the user re-clicks the button -- the error message will be re-hidden while the new `fetch` request is sent and allowed to return successfully or not.\r\n\r\n1. Add the HTML/CSS for error handling.\r\nFor this, we will need to add the error message element, and set it to be hidden by default. Add the new element after the `click-me` button. Add the style tags within the `content` block.\r\n\r\n<div class=\"filename\">views/click-tracker.liquid</div>\r\n\r\n```html\r\n<span id=\"error\" class=\"hidden\">Oops, something happened.</span>\r\n\r\n<style>\r\n  .hidden {\r\n    display: none;\r\n  }\r\n\r\n  #error {\r\n    color: red;\r\n  }\r\n</style>\r\n```\r\n\r\n2. Add error handling JavaScript\r\nWhen an error response is encountered, remove the `hidden` class on the `#error` element to remove the `display: none` attribute. In the case of resubmitting the button click, hide the element again by re-adding the `hidden` class.\r\n\r\n<div class=\"filename\">views/click-tracker.liquid</div>\r\n\r\n```html\r\n<script>\r\n  const button = document.getElementById('click-me');\r\n  button.addEventListener('click', function(event) {\r\n    document.getElementById('error').classList.add('hidden');\r\n\r\n    fetch('/api/clicks', { method: 'POST' })\r\n    .then((response) => {\r\n      if (!response.ok) {\r\n        document.getElementById('error').classList.remove('hidden');\r\n        return;\r\n      };\r\n\r\n      response.json()\r\n      .then((data) => {\r\n        document.getElementById('times-clicked').innerHTML = data.timesClicked;\r\n      });\r\n    });\r\n  });\r\n</script>\r\n```\r\n\r\nTo test the error handling, you can force the API to return an error response.\r\n\r\n<div class=\"filename\">index.js</div>\r\n\r\n```javascript\r\napp.post('/api/clicks', async function(request, response, next) {\r\n  // const user = request.oidc.user ? request.oidc.user.email : null;\r\n  // try {\r\n  //   await Click.create({ user: user });\r\n  //   response.json({ timesClicked: await Click.count() });\r\n  // } catch (e) {\r\n  //   e.apiError = true;\r\n  //   e.statusCode = 422;\r\n  //   next(e);\r\n  // }\r\n\r\n  const e = new Error();\r\n  e.apiError = true;\r\n  e.statusCode = 500;\r\n  next(e);\r\n});\r\n\r\n```\r\n\r\nBe sure to revert this intermediate step for the application to function as planned long-term.\r\n\r\n### 9. Add a homepage link\r\nAdd the Click Tracker app to the list of pages on the homepage.\r\n\r\n<div class=\"filename\">views/index.liquid</div>\r\n\r\n```html\r\n<li><a href=\"/click-tracker\">Click Tracker</a></li>\r\n```\r\n\r\n### 10. Commit and deploy\r\n1. Commit the repository\r\nGit commit the new changes and deploy to Heroku to see the results in a deployed environment.\r\n\r\n<div class=\"filename\">command line</div>\r\n\r\n```\r\n$ git add .\r\n$ git commit -m 'Add Click Tracker'\r\n$ git push heroku HEAD\r\n```\r\n\r\n2. Migrate the production database\r\nThere is now a new table the application expects to be in the database. A database migration must be run on the Heroku Postgres instance to create this table.\r\n\r\n<div class=\"filename\">command line</div>\r\n\r\n```\r\n$ heroku run sequelize db:migrate\r\n```\r\n\r\n3. Run the deployed application\r\n\r\n<div class=\"filename\">command line</div>\r\n\r\n```\r\n$ heroku open\r\n```\r\n\r\nNavigate to `/click-tracker` directly or via the homepage link, and verify the incrementing Click Tracker.\r\n\r\n### Resources\r\n\r\nWhat is Web 2.0?: [https://www.znetlive.com/blog/web-2-0/](https://www.znetlive.com/blog/web-2-0/)\r\n\r\nUsing the Fetch API: [https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch)\r\n\r\nExpress Error Handling: [http://expressjs.com/en/guide/error-handling.html](http://expressjs.com/en/guide/error-handling.html)\r\n\r\nJavaScript Promises: [https://nodejs.dev/learn/understanding-javascript-promises](https://nodejs.dev/learn/understanding-javascript-promises#chaining-promises)",
        "sectionType": "chapter",
        "sequence": 7,
        "parentSection": {
          "parentSectionPart": 2,
          "parentSectionType": "part",
          "parentSectionSequence": 2
        }
      }
    ]
  },
  {
    "title": "Create Webserver",
    "slug": "create-webserver",
    "content": "<h2 id=\"createthewebserver\">Create the Web Server</h2><p>As it stands, <code>smartsite</code> is a functioning Node.js application, but it doesn't do much. It prints a message in the terminal. We're here to build an application that serves web traffic. This means a user can navigate to our web pages and functionality from an internet browser.</p><p>For the purposes of this guide, the term \"web server\" should be taken to mean an application that serves web traffic. The term \"web server\" can (and often does) apply to any physical or digital component that makes up the OSI model. These components funtionally operate different levels of abstraction, and in the most general sense, constitute a pipeline of request handling. Node.js web servers operate at the \"Application Layer\" of the model.</p><p>A web server library written for the JavaScript ecosystem will be included into application scripts. There are many such libraries in the Node.js ecosystem from which to choose. The ideal library for our purposes provides a developer friendly abstraction over the gritty details of TCP and HTTP communication protocols. A large network of developers using the library is a strong bonus as well. Express <a href=\"https://expressjs.com\">https://expressjs.com</a> is a web framework that checks all of the boxes.</p><h3 id=\"express\">Express</h3><p>Express provides an abstraction over low-level HTTP handling by using sensible defaults for HTTP configuration, while still allowing for low-level configuation as the needs of the application are discovered. For the developer, Express provides a straight-forward, route declaration approach for serving web requests.</p><p>Express has been a mainstay library for since the early days of Node.js, and beginner to advanced online resources can be found with ease.</p><h3 id=\"1installexpress\">1. Install Express</h3><p>Use <code>npm</code> to install Express. Within <code>smartsite</code>'s root directory, run the following:</p><div class=\"filename\">command line</div><pre><code>$ npm install express</code></pre><p>This command adds Express as a dependency to the application, and installs the library into the <code>node_modules</code> folder. Since Express is the first external library added to the application, the <code>node_modules</code> folder will be created in the root directory.</p><h3 id=\"2createtheexpressserver\">2. Create the Express server</h3><p>Express provides JavaScript classes and functions that, when used within a Node.js script, start a webserver process. To do so, we'll need to <code>require</code> the Express library, then instantiate an instance of Express.</p><p>An instance of Express is conventionally called <code>app</code>. The instance provides methods for routing HTTP requests, rendering HTML views, registering a template engine, and configuring middleware. <code>smartsite</code> will utilize all of these methods.</p><p>First, modify <code>index.js</code> to import in the <code>express</code> library and instantiate an <code>app</code>. Register a <code>GET</code> route to the root route, <code>/</code>.</p><div class=\"filename\">index.js</div><pre><code class=\"javascript language-javascript\">const express = require('express');const app = express();const PORT = 3000;app.get('/', function(request, response) {  response.send('&lt;h1&gt;Welcome to SmaRtsite!&lt;/h1&gt;');});app.listen(PORT, () =&gt; {  console.log(`SmaRtsite listening on port ${PORT}`);});</code></pre><h3 id=\"3runtheapplication\">3. Run the Application</h3><p>Starting the application with <code>npm run start</code> will begin the Express server. Based on the code above, this web server can be accessed by navigating to <code>http://localhost:3000</code> in a web browser.</p><p>Open a web browser and navigate to <code>localhost:3000</code>. You should see a large heading with the words \"Welcome to SmaRtsite!\".</p><p>[image welcome to my app]</p><h3 id=\"6gitcommitthechanges\">6. Git commit the changes</h3><p>This was a significant unit of development. The Express library was added and the initial web route was added to the application. <code>git commit</code> the changes to signify the completion of this development.</p><div class=\"filename\">command line</div><pre><code>$ git add .$ git commit -m 'Add express'</code></pre><h3 id=\"resources\">Resources</h3><p>Express: <a href=\"https://expressjs.com\">expressjs.com</a></p>",
    "sectionType": "chapter",
    "sequence": 1,
    "parentSection": {
      "parentSectionPart": 2,
      "parentSectionType": "part",
      "parentSectionSequence": 2
    }
  },
  {
    "title": "Filesystem Watcher",
    "slug": "filesystem-watcher",
    "content": "<h2 id=\"addafilesystemwatcher\">Add a Filesystem Watcher</h2><p>A filesystem watcher is a program that ensures a running development application is providing the most recent changes to code. The use case for a filesystem watcher is best illustrated by example. </p><ol><li><p>Ensure the node server is running <code>npm run start</code></p></li><li><p>Modify a <code>index.js</code>The current state of the root route in <code>index.js</code> is that it returns an HTML string with the phrase <code>Hello World</code>.</p></li></ol><div class=\"filename\">index.js</div><pre><code class=\"javascript language-javascript\">app.get('/', function(request, response) {  response.send('&lt;h1&gt;Welcome to SmaRtsite!&lt;/h1&gt;');});</code></pre><p>Change the sent response to read <code>Hello World</code> instead of <code>Welcome to SmaRtsite</code>, and save the file.</p><div class=\"filename\">index.js</div><pre><code class=\"javascript language-javascript\">app.get('/', function(request, response) {  response.send('&lt;h1&gt;Hello World!&lt;/h1&gt;');});</code></pre><ol start=\"3\"><li>Check for changesIn the broswer, navigate to <code>localhost:3000</code>, and check out the heading. It still says <code>Hello World!</code>.</li></ol><p>This is because when the application is run with <code>node index.js</code>, all application files are cached in the state they were in when the command was invoked. To see the modified response, stop the currently running server with <code>CMD+C</code> or <code>CTRL+C</code> depending on your operating system, and restart it with <code>npm run start</code>. Navigating to the browser now will display the updated text.</p><p>Restarting the server after every change is tedious and will seem <em>more</em> tedious over time. And presents a near impossible developer experience long-term. As such, <code>smartsite</code> will implement the file watching library <code>nodemon</code>.</p><h3 id=\"1addnodemon\">1. Add nodemon</h3><p>Nodemon is a library that is used to initialize a process from the local operating system, and is therefore a development dependency rather than an application dependency. Install the library as a dev dependency.</p><ol><li>Install nodemon</li></ol><div class=\"filename\">command line</div><pre><code class=\"bash language-bash\">$ npm install --save-dev nodemon</code></pre><ol start=\"2\"><li>Use nodemonnodemon wraps the <code>node</code> process with an additional file-checking functionality. Change the start script within <code>package.json</code> to use <code>nodemon</code> instead of <code>node</code> to start the server process.</li></ol><div class=\"filename\">package.json</div><pre><code class=\"javascript language-javascript\">{  ...,  \"scripts\": {    \"start\": \"npx nodemon .\",    ...  },  ...}</code></pre><p>The <code>npx</code> command can be thought of as \"<strong>n</strong>ode <strong>p</strong>ackage e<strong>x</strong>ecute.\" This signals to use the executable provided by a program found within the local <code>node_modules</code> directory -- in this case <code>nodemon</code>.</p><ol start=\"3\"><li>Restart the serverRunning <code>npm run start</code> will now invoke <code>nodemon</code>. <code>nodemon</code> will start the application as usual and restart the server process as code within the directory is changed. Restart the server.</li></ol><div class=\"filename\">command line</div><pre><code>$ npm run start</code></pre><ol start=\"4\"><li>Modify the codeChange the text sent from the root route back to <code>Welcome to SmaRtsite</code>, and <em>do not</em> restart the server.</li></ol><div class=\"filename\">index.js</div><pre><code class=\"javascript language-javascript\">app.get('/', function(request, response) {  response.send('&lt;h1&gt;Welcome to SmaRtsite!&lt;/h1&gt;');});</code></pre><ol start=\"5\"><li>Check for changesIn the broswer, navigate to <code>localhost:3000</code>, and check out the heading. It now says <code>Welcome to SmaRtsite!</code> without needing a server restart. The filesystem watcher is working!</li></ol><h3 id=\"6gitcommitthechanges\">6. Git commit the changes</h3><p>This was a significant unit of development. A development library was added, and it's functionality was fully implemented. <code>git commit</code> the changes to signify the completion of this development.</p><div class=\"filename\">command line</div><pre><code>$ git add .$ git commit -m 'Add nodemon'</code></pre><h3 id=\"resources\">Resources</h3><p>Nodemon: <a href=\"https://www.npmjs.com/package/nodemon\">npmjs.com/package/nodemon</a></p>",
    "sectionType": "section",
    "sequence": 1,
    "parentSection": {
      "parentSectionPart": 2,
      "parentSectionType": "chapter",
      "parentSectionSequence": 1
    }
  },
  {
    "title": "Sending Web Pages",
    "slug": "sending-web-pages",
    "content": "<h2 id=\"sendingwebpages\">Sending Web Pages</h2><p>Currently, the application is configured to send an HTML string when the root route, <code>/</code>, is requested. While this is a valid use of Express route handling, a better approach is to keep end-user presentation and the application logic into separate files.</p><dl>    <dt>Application Logic</dt>    <dd>The scripted code that handles the request/response cycle</dd>    <dt>Presentation</dt>    <dd>The response displayed to the consumer</dd></dl><p>The separation of concerns between the routing and view layers is standard practice. This technique allows developer to optimize and organize the two areas separately which will become more important as the application grows.</p><h3 id=\"thepresentationlayer\">The Presentation Layer</h3><p>It is safe to expect web-traffic to be viewed using a internet browsing application such as Chrome or Microsoft Edge. Modern internet broswers are equipped to translate many common web response formats into human usable form. The most familiar of these formats is likely HTML.</p><p>To start <code>smartsite</code>'s presentation layer, we will send a basic HTML file.</p><ol><li>Create a file named <code>index.html</code> in the root directory.</li></ol><div class=\"filename\">index.html</div><pre><code class=\"html language-html\">&lt;!DOCTYPE html&gt;&lt;head&gt;  &lt;title&gt;SmaRtsite&lt;/title&gt;&lt;/head&gt;&lt;html&gt;  &lt;body&gt;    &lt;h1&gt;Welcome to SmaRtsite!&lt;/h1&gt;  &lt;/body&gt;&lt;/html&gt;</code></pre><ol start=\"2\"><li>Send the <code>index.html</code> as the response from <code>/</code>.Modify the route handler of <code>/</code> to use <code>sendFile</code> instead of <code>send</code>.</li></ol><div class=\"filename\">index.js</div><pre><code class=\"javascript language-javascript\">app.get('/', function(request, response) {  response.sendFile(__dirname + '/index.html');});</code></pre><p><code>__dirname</code> is a Node.js variable containing the directory name of the currently executing file. Because we know the location of <code>index.html</code> to be in the same directory as <code>index.js</code>, simply appending the HTML's filename to <code>__dirname</code> yields the correct location for the file.</p><h3 id=\"resources\">Resources</h3><p>Separation of Concerns: <a href=\"https://deviq.com/principles/separation-of-concerns\">https://deviq.com/principles/separation-of-concerns</a></p><p>What is HTML?: <a href=\"https://www.hostinger.com/tutorials/what-is-html\">https://www.hostinger.com/tutorials/what-is-html</a></p>",
    "sectionType": "chapter",
    "sequence": 2,
    "parentSection": {
      "parentSectionPart": 2,
      "parentSectionType": "part",
      "parentSectionSequence": 2
    }
  },
  {
    "title": "View Templates",
    "slug": "view-templates",
    "content": "<h2 id=\"viewtemplates\">View Templates</h2><p>Static HTML files make up the majority of web pages delivered on the internet. An HTML file is considered \"static\" because the content is the same regardless of user identity or any other real-time factors. The benefit of a web <em>application</em> is that the application layer has the ability to process the user request and deliver a dynamic experience.</p><p>The ability to deliver a dynamic experience at the view layer is accomplished by use of <strong>view templating.</strong> This allows developers to create files that are a mix of static content and variables which are determined at the time the template is rendered, e.g. in response to a user request.</p><p>A template file is written in a <strong>template language</strong>. Template languages are often HTML-like, and support variable injection and often more complex scripting logic such as <code>for</code> loops. Modern web browsers cannot natively read the template language. A <strong>templating engine</strong> handles the conversion of a template and variables to an HTML file which is then delivered to the users' browsers.</p><p>A view template may have the content <code>&lt;p&gt;Hello, {{ user.name }}!&lt;/p&gt;</code>, and a template engine would render <code>&lt;p&gt;Hello, Alexa!&lt;/p&gt;</code>.</p><p>There are several template languages from which to choose. Because of the separation of presentational concerns from application logic, a given language is usually not specfic to a given application architecture, e.g. Node.js. Learning the template language once is transferrable  The application logic will invoke the template <em>engine</em> with parameters for which template file to render and what variables should be rendered therein, so it is important to choose a language with a respective template engine compatible with the application.</p><p>Given the ubiquity of view templating across all web server architectures, the problem of compatibility is not generally a concern. Many architectures come with built-in template rendering and a default templating language, and a developer can customize away from the default by adding a new rendering library.</p><h3 id=\"resources\">Resources</h3><p>Template Engines: <a href=\"https://expressjs.com/en/guide/using-template-engines.html\">https://expressjs.com/en/guide/using-template-engines.html</a></p>",
    "sectionType": "section",
    "sequence": 1,
    "parentSection": {
      "parentSectionPart": 2,
      "parentSectionType": "chapter",
      "parentSectionSequence": 2
    }
  },
  {
    "title": "Add Template Engine",
    "slug": "add-template-engine",
    "content": "<h2 id=\"addatemplateengine\">Add a Template Engine</h2><p>The Express ecosystem supports many trusted template languages. <code>smartsite</code> will use the Liquid template language.</p><h3 id=\"1installtemplatelibraries\">1. Install template libraries</h3><p>The Node.js application requires functionality for parsing and rendering the template language into HTML. The package <code>liquidjs</code> provides the JavaScript bindings for Liquid template rendering. use <code>npm install</code> to add the library.</p><div class=\"filename\">command line</div><pre><code>$ npm install liquidjs</code></pre><h3 id=\"2registertheliquidtemplateengine\">2. Register the Liquid template engine</h3><p>Using <code>liquidjs</code> as the template engine in the application server requires importing the library, initializing it, and registering it with the Express <code>app</code>.</p><p>Code like the following should be added to <code>index.js</code> before the route declarations.</p><div class=\"filename\">index.js</div><pre><code class=\"javascript language-javascript\">const { Liquid } = require('liquidjs');app.engine('liquid', new Liquid().express());</code></pre><p>Express' <code>app.engine</code> method relates a file extension with a rendering engine. As Liquid files are created, they should be created with the <code>.liquid</code> file extension (e.g. <code>filename.liquid</code>). Express allows multiple <code>app.engine</code>s to be set. As such, multiple extensions and multiple rendering engines are valid.</p><h3 id=\"3createaviewtemplate\">3. Create a view template</h3><p>A liquid template file supports all valid HTML with the additional functionality of variable rendering and logicial operators. They use a file extension of <code>.liquid</code> instead of <code>.html</code>. Copy the current <code>index.html</code> into a new file named <code>index.liquid</code> in the root directory of the application.</p><div class=\"filename\">index.liquid</div><pre><code class=\"html language-html\">&lt;!DOCTYPE html&gt;&lt;head&gt;  &lt;title&gt;SmaRtsite&lt;/title&gt;&lt;/head&gt;&lt;html&gt;  &lt;body&gt;    &lt;h1&gt;Welcome to SmaRtsite!&lt;/h1&gt;  &lt;/body&gt;&lt;/html&gt;</code></pre><h3 id=\"4rendertheviewtemplate\">4. Render the view template</h3><p>To send a static HTML file, Express' <code>response.sendFile</code> method was used. In the case of view template rendering, a different method must be used to indicate the desired response to send to the user must first be generated through a templating engine, <code>response.render</code>.</p><p><code>response.render</code> accepts two parameters, 1) the filename and 2) an object of variables with which to render the file.</p><ol><li>Use <code>response.render</code> within the root route handler in place of <code>response.sendFile</code>.</li></ol><div class=\"filename\">index.js</div><pre><code class=\"javascript language-javascript\">app.get('/', function(request, response) {  response.render(__dirname + '/index.liquid');});</code></pre><ol start=\"2\"><li>Save and navigate to <code>localhost:3000</code>.</li></ol><p>[image welcome to my app]</p><h3 id=\"5configureviewoptions\">5. Configure view options</h3><p>An Express application can be configured with a variety of view options. Setting these options globally well explicity set filesystem architecture, and often allows for cleaner code in Express middleware and improves developer experience.</p><p>To continue the trend of clearly separating concerns, the architecture of <code>smartsite</code> will utilize a views directory. Once created, files that are meant to be rendered and/or sent as a user response should be placed in this folder to clearly separate the presentation layer from the JavaScript logic.</p><ol><li><p>Create a new folder named <code>views</code> in the root directoryExpress, by default, will look for views (i.e. templates) in a directory named <code>views</code>. Specifically, it will look for a directory matching the definition <code>process.cwd() + '/views'</code>, where <code>process.cwd()</code> is the \"current working directory\" (<code>cwd</code>). As most node applications initialize from the root directory, the expanded file path is <code>&lt;root directory&gt;/views</code>. Although <code>smartsite</code> will utilize the default, this setting is configurable.</p></li><li><p>Move <code>index.liquid</code> into the <code>views</code> folder.</p></li></ol><div class=\"filename\">views/index.liquid</div><pre><code class=\"html language-html\">&lt;!DOCTYPE html&gt;&lt;head&gt;  &lt;title&gt;SmaRtsite&lt;/title&gt;&lt;/head&gt;&lt;html&gt;  &lt;body&gt;    &lt;h1&gt;Welcome to SmaRtsite!&lt;/h1&gt;  &lt;/body&gt;&lt;/html&gt;</code></pre><p>At this point, visiting <code>localhost:3000</code> should lead to an error response returned. follow the next step to correct this.</p><ol start=\"3\"><li>Modify <code>index.js</code> to render <code>views/index.liquid</code>With the Express application set to default its search for views in <code>/views</code>, route handlers no longer have to specify the full file path to renderable files. Modify the handler of <code>/</code> by removing references to <code>_dirname</code>.</li></ol><div class=\"filename\">index.js</div><pre><code class=\"javascript language-javascript\">app.get('/', function(request, response) {  response.render('index.liquid');});</code></pre><p><code>localhost:3000</code> should now render the familiar \"Welcome!\" message.</p><ol start=\"4\"><li>Set the view engineExpress' <code>app.set</code> method provides a way for developers to configure application-wide settings. A standard setting is \"view engine\" which is used to configure the default file extension for views. Adding the view engine setting allows for developers to omit the file extension from calls to <code>app.render</code>.</li></ol><p>Add the setting to <code>index.js</code> and remove the <code>.liquid</code> extension in the root route.</p><pre><code class=\"javascript language-javascript\">app.set('view engine', 'liquid');app.get('/', function(request, response) {  response.render('index');});</code></pre><p>The application should work as expected.</p><h3 id=\"6gitcommit\">6. <code>git commit</code></h3><p>Configuring and initializing the view engine within <code>smartsite</code> is a significant unit of development. This is a perfect time to bookmark filesystem state within version control.</p><div class=\"filename\">command line</div><pre><code>$ git status$ git add .$ git commit -m 'Add template engine'</code></pre><p><strong>Keep in mind:</strong> As application development continues, place template files in the <code>/views</code> directory with a file extension of <code>.liquid</code>. The files may contain static or dynamic content.</p><h3 id=\"resources\">Resources</h3><p>Express' <code>app.set</code>: <a href=\"https://expressjs.com/en/api.html#app.set\">https://expressjs.com/en/api.html</a></p><p>Express' <code>response.render</code>: <a href=\"https://expressjs.com/en/api.html#res.render\">https://expressjs.com/en/api.html</a></p>",
    "sectionType": "section",
    "sequence": 2,
    "parentSection": {
      "parentSectionPart": 2,
      "parentSectionType": "chapter",
      "parentSectionSequence": 2
    }
  },
  {
    "title": "Dynamic Content",
    "slug": "dynamic-content",
    "content": "<h2 id=\"dynamicallyrendercontent\">Dynamically Render Content</h2><p>A benefit of using view templates is the ability to add content to be rendered at the point of a user request. Within a Liquid template, use the syntax <code>{{ variable_name }}</code> to indicate a value passed at render time should be rendered to string. In addition, Liquid's <code>if/else</code> syntax <code>{% if variable_name %} ... {% else %} ... {% endif %}</code>, offers basic logical switching to determine what block of content to render based on whether the variable is defined at render time. If the statement evaluates to true, </p><p>To directly render a variable, use the double curly brace syntax, <code>{{ }}</code>. To script non-rendered view logic, use the curly brace and percent sign syntax, <code>{% %}</code>.</p><h3 id=\"1modifytheviewtorespondtodynamicallyinjectedvariables\">1. Modify the view to respond to dynamically injected variables.</h3><p>Add a section to <code>index.liquid</code> that renders passed in variables. </p><div class=\"filename\">views/index.liquid</div><pre><code class=\"html language-html\">&lt;!DOCTYPE html&gt;&lt;head&gt;  &lt;title&gt;SmaRtsite&lt;/title&gt;&lt;/head&gt;&lt;html&gt;  &lt;body&gt;    &lt;h1&gt;Welcome to SmaRtsite!&lt;/h1&gt;    &lt;p&gt;This application is running in the &lt;b&gt;{{ nodeEnv }}&lt;/b&gt; environment.&lt;/p&gt;    {% if debug %}      &lt;p&gt;&lt;b&gt;Debug Information&lt;/b&gt;&lt;/p&gt;      &lt;p&gt;Node version: {{ nodeVersion }}&lt;/p&gt;      &lt;p&gt;Server Time: {{ serverTime }}&lt;/p&gt;    {% endif %}    &lt;p&gt;&lt;/p&gt;  &lt;/body&gt;&lt;/html&gt;</code></pre><p>Notice that the \"Debug Information\" section will only render if the <code>debug</code> variable is defined. If you navigate to the page at <code>localhost:3000</code>, there will be no visible difference. We need to render the page with at least the <code>debug</code> variable.</p><h3 id=\"2renderthetemplatewithvariables\">2. Render the template with variables.</h3><p>Modify the <code>/</code> route handler to define the variables <code>debug</code>, <code>nodeVersion</code>, and <code>serverTime</code>, and pass them in as the second parameter to <code>response.render</code>.</p><div class=\"filename\">index.js</div><pre><code class=\"javascript language-javascript\">app.get('/', function(request, response) {  const debug = request.query.debug;  const nodeVersion = process.version;  const serverTime = new Date();  response.render('index', { debug, nodeVersion, serverTime });});</code></pre><p>Notice the definition of the <code>debug</code> variable: <code>request.query.debug</code>. The <code>query</code> property of Express <code>Request</code> objects returns the query parameters section of the requested URL string. By default, query parameters found at <code>request.query</code> are formatted as a JavaScript object. For example, the query string of <code>?debug=true&amp;limit=10</code> will be of the form <code>{ debug: 'true', limit: '10' }</code>.</p><p><strong>Note:</strong> Query string values are necessarily coerced to string for HTTP transport. While a developer may intend to use a boolean or number value from the query string, Express provides the values as strings that must be type cast for use as a boolean or number, etc.</p><h3 id=\"3loadthepage\">3. Load the page</h3><p>With the above changes in place, loading the page at <code>localhost:3000</code> renders the same landing page.</p><p>To see the new changes, request the page with a <code>debug</code> query string parameter: <code>localhost:3000?debug=true</code>. The page should now display a section of \"Debug Information.\"</p><p>[image debug information]</p><h3 id=\"4gitcommit\">4. <code>git commit</code></h3><p>Dynamically rendering the index view within <code>smartsite</code> is a significant unit of development. This is a perfect time to save state to version control.</p><div class=\"filename\">command line</div><pre><code>$ git status$ git add .$ git commit -m 'Dynamically render index.liquid'</code></pre><h3 id=\"review\">Review</h3><p>Dynamic display content must be located in the <code>/views</code> directory with a file extension of <code>.liquid</code>. The files may contain static or dynamic content. If the content should be dynamically rendered, provide an object of local variables as the second parameter <code>response.render</code> within the route handler.</p><p>The Liquid template language provides additional functiontality to the HTML specification in the form of flow control (<code>if/else</code>), iteration, and many more advanced operations. Visit the Liquid reference guide in <strong>Resources</strong> section to explore Liquid's full feature set.</p><h3 id=\"resources\">Resources</h3><p>Liquid Template Language: <a href=\"https://shopify.github.io/liquid/\">https://shopify.github.io/liquid/</a></p>",
    "sectionType": "section",
    "sequence": 3,
    "parentSection": {
      "parentSectionPart": 2,
      "parentSectionType": "chapter",
      "parentSectionSequence": 2
    }
  },
  {
    "title": "Liquid Templating",
    "slug": "liquid-templating",
    "content": "<h2 id=\"liquidtemplating\">Liquid Templating</h2><p>A benefit of a template engine is the ability to separate units of presentation. This allows developers to define view logic once, and reuse the template across multiple pages. This concept will become more explicit by practice. This section details reusing template components between pages to eliminate the need to repeat and maintain separate view scripts.</p><h3 id=\"1createanewpage\">1. Create a new page</h3><p>Within the <code>views</code> directory, create a new file names <code>hello-world.liquid</code>.</p><div class=\"filename\">views/hello-world.liquid</div><pre><code class=\"html language-html\">&lt;!DOCTYPE html&gt;&lt;head&gt;  &lt;title&gt;SmaRtsite&lt;/title&gt;&lt;/head&gt;&lt;html&gt;  &lt;body&gt;    &lt;h1&gt;Hello World!&lt;/h1&gt;    {% if showDog %}      &lt;img src=\"https://i.imgur.com/5Swc751.png\" alt=\"brown dog marley\" width=\"150px\"/&gt;    {% endif %}    &lt;p&gt;Show Marley with query parameter &lt;code&gt;showDog&lt;/code&gt;.&lt;/p&gt;    &lt;p&gt;&lt;code&gt;Page loaded at {{ serverDate }}.&lt;/code&gt;&lt;/p&gt;  &lt;/body&gt;&lt;/html&gt;</code></pre><h3 id=\"2createanewroute\">2. Create a new route</h3><p>Register a route with the application to allow users to access the new page from a web browser.</p><div class=\"filename\">index.js</div><pre><code class=\"javascript language-javascript\">app.get('/hello-world', function(request, response) {  const showDog = request.query.showDog;  response.render('hello-world', {    showDog,    serverDate: new Date()  });});</code></pre><p>With the server running (<code>npm run start</code>), navigate to <code>localhost:3000/hello-world</code>, and you should be presented with the greeting \"Hello World!\"</p><h3 id=\"theneedfortemplating\">The Need for Templating</h3><p>Take a look at <code>index.liquid</code> and <code>hello-world.liquid</code>. Both pages have the standard HTML boilerplate -- <code>&lt;html&gt;</code>, <code>&lt;head&gt;</code>, <code>&lt;body&gt;</code> -- in common. In fact, any new HTML page will need the basic HTML layout. As front-end development development, it is highly likely that <code>CSS</code> and JavaScript assets will be shared between pages. Given the current paradigm of fully separating each web page, a developer adding a global CSS asset would have to add a <code>&lt;link&gt;</code> tag <em>each</em> .liquid file.</p><p>Standard application of the DRY principle (Don't Repeat Yourself) dictates we isolate and define repeated patterns, and reference the one-time definition where necessary. To DRY up <code>smartsite</code>'s presentational layer, we need to isolate the base HTML markup layout, and implement the layout in each of the view scripts. This strategy is known as \"template inheritance.\"</p><h3 id=\"3addaliquidlayout\">3. Add a Liquid <code>layout</code></h3><p>Liquid has a standard concept of a \"layout\" template. A layout template defines whatever view logic it is meant to encapsulate, and defines areas within its markup meant to be customized by each implementer of the layout.</p><p>Create a file to serve as the layout. This file will contain HTML boilerplate, as well as a delimited section for child pages to provide custom content.</p><div class=\"filename\">views/default-layout.liquid</div><pre><code class=\"html language-html\">&lt;!DOCTYPE html5&gt;&lt;html&gt;  &lt;head&gt;    &lt;title&gt;smartsite&lt;/title&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;header&gt;      &lt;a href=\"/\"&gt;home&lt;/a&gt;    &lt;/header&gt;    {% block content %}      default-html.liquid's default content is showing.    {% endblock %}    &lt;br/&gt;&lt;br/&gt;    &lt;footer&gt;&amp;copy; by Popular Demand&lt;/footer&gt;  &lt;/body&gt;&lt;/html&gt;</code></pre><p>The syntax <code>{% block &lt;block_name&gt; %}{% endblock %}</code> specifies an area of the template to be overwritten by child pages. A developer can provide default markup within the layouts <code>block</code>; the default content is rendered if the child page does not define its own markup for the area.</p><h3 id=\"4usethelayout\">4. Use the layout</h3><p>The <code>block</code> to be referenced in the sub-pages is named <code>content</code>. An individual sub-page must reference the parent layout, <code>default-layout.liquid</code>, and define its own <code>content</code> block. A reference to the parent layout is defined with a <code>layout</code> block.</p><p>Modify <code>hello-world.liquid</code> to implement the layout and define custom <code>content</code>.</p><div class=\"filename\">views/hello-world.liquid</div><pre><code class=\"html language-html\">{% layout 'default-layout.liquid' %}{% block content %}  &lt;h1&gt;Hello World!&lt;/h1&gt;  {% if showDog %}    &lt;img src=\"https://i.imgur.com/5Swc751.png\" alt=\"brown dog marley\" width=\"150px\"/&gt;  {% endif %}  &lt;p&gt;Show Marley with query parameter &lt;code&gt;showDog&lt;/code&gt;.&lt;/p&gt;  &lt;p&gt;&lt;code&gt;Page loaded at {{ serverDate }}.&lt;/code&gt;&lt;/p&gt;{% endblock %}</code></pre><p>Notice this page no longer features any boiler plate HTML. It only defines two features -- a <code>layout</code>block and a <code>content</code> block.</p><p>From the browser, reload the <code>/hello-world</code> route to be delivered the page with its newly defined layout. The main content of the pages, a heading and two paragraphs should remain visible. There should also be two elements added from the <code>default-layout.liquid</code> layout -- a page header with a link to the root route and a footer element with site information.</p><h3 id=\"5refactorindexliquid\">5. Refactor <code>index.liquid</code></h3><dl>  <dt>Refactor</dt>  <dd>restructure the code of an application so as to improve it without altering functionality</dd></dl><p>Isolating the base HTML into a layout was an improvement to the codebase in terms of maintainability. Let's reuse this architecture in all of the pages of the application.</p><div class=\"filename\">views/index.liquid</div><pre><code class=\"html language-html\">{% layout 'default-layout.liquid' %}{% block content %}  &lt;h1&gt;Welcome to SmaRtsite!&lt;/h1&gt;  {% if debug %}    &lt;p&gt;&lt;b&gt;Debug Information&lt;/b&gt;&lt;/p&gt;    &lt;p&gt;Node version: {{ nodeVersion }}&lt;/p&gt;    &lt;p&gt;Server Time: {{ serverTime }}&lt;/p&gt;  {% endif %}{% endblock %}</code></pre><p>Again, the child page must define its parent <code>layout</code> and the <code>content</code> block to fill in the layout's <code>content</code> block.</p><p>Navigating to the root route, <code>/</code>, in the broswer should render the <code>Welcome to SmaRtsite!</code> heading as well as the Header and footer defined in <code>default-layout.liquid</code>.</p><h3 id=\"review\">Review</h3><p><code>block</code> is a standard tag provided by Liquid. A layout file uses a <code>block</code> tag to define an area that will be replaces with a child page's content. A child page uses <code>block</code> to define what to render in its layout's identically named <code>block</code>.</p><p><code>layout</code> is a functional tag provided by Liquid. It is used in a child page to define what layout the defined markup should be rendered within.</p><p>In the specific case of these changes, \"<code>content</code>\" is a developer defined variable name that references an area within the parent layout to be replaced by the markup of a identically named block within the child page.</p><h3 id=\"6addalinktohelloworld\">6. Add a link to Hello World!</h3><p>As new pages are added to the application, it is good practice to give users an easy method of navigating to the page. Below the heading on the index page, add a link to <code>hello-world</code>. (<strong>Note:</strong> In this code block and going forward, only the affected parts of the code are shown. It's unnecessary to alter the unshown elements. Use discernment.)</p><div class=\"filename\">views/index.liquid</div><pre><code class=\"html language-html\">&lt;h1&gt;Welcome to SmaRtsite!&lt;/h1&gt;&lt;p&gt;Links&lt;/p&gt;&lt;ul&gt;  &lt;li&gt;&lt;a href=\"/hello-world\"&gt;hello-world&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;</code></pre><h3 id=\"7gitcommit\">7. <code>git commit</code></h3><p>Creating a view layout architecture within <code>smartsite</code> is a significant unit of development. Time to save to version control.</p><div class=\"filename\">command line</div><pre><code>$ git status$ git add .$ git commit -m 'Add default layout and hello-world'</code></pre><h3 id=\"reference\">Reference</h3><ol><li>Liquid's <code>layout</code>: <a href=\"https://liquidjs.com/tags/layout.html\">https://liquidjs.com/tags/layout.html</a></li></ol>",
    "sectionType": "section",
    "sequence": 4,
    "parentSection": {
      "parentSectionPart": 2,
      "parentSectionType": "chapter",
      "parentSectionSequence": 2
    }
  },
  {
    "title": "Deployed Env Heroku",
    "slug": "deployed-env-heroku",
    "content": "<h2 id=\"adeployedenvironment\">A Deployed Environment</h2><p>So far, <code>smartsite</code> has only been served from a local development server. To open the application for public web traffic, the application has to have a public IP address, the proper configuration with OSI layer-7 programs allowing public web traffic. Chances are you do not want to open your personal computer to public traffic. As well, learning how to provision a operating system level server is a walkthrough in its own. Luckily, there are Platforms-as-a-Service that provide fully-provisioned server space for launching public web applications with ease. One such platform is Heroku.</p><h3 id=\"heroku\">Heroku</h3><p>Heroku provides the public server space <code>smartsite</code> needs. The Heroku platform offers server-processing in the form of what they call \"dynos.\" Heroku's free-tier includes unlimited dynos and 550 dyno hours per month. Verifying the account with a credit card will increase the number of free dyno hours to 1100. Dynos on the free tier will sleep after 30 minutes of inactivity. Visiting the web address of a sleeping dyno will take longer than usual to render the first request as the dyno is activated from the sleeping state.</p><p>When an application is ready for production-level availability, simply upgrade the dyno to a paid tier to have the application accessible 24/7. At the time of this writing, paid tiers start at $7 per month per dyno.</p><p>In addition to upgrading application availability, Heroku has an Add-ons marketplace which provides database, cache, and application monitoring services to name a few. These services include industry standard tools specially configured for plug-and-play interfacing with the Heroku platform. Each add-on has it's own tiered pricing system, and there are many with a free tier which match Heroku's free tier on being perfectly suited for learning and prototyping.</p>",
    "sectionType": "chapter",
    "sequence": 3,
    "parentSection": {
      "parentSectionPart": 2,
      "parentSectionType": "part",
      "parentSectionSequence": 2
    }
  },
  {
    "title": "Deploying To Heroku",
    "slug": "deploying-to-heroku",
    "content": "<h2 id=\"deployingtoheroku\">Deploying to Heroku</h2><h3 id=\"prerequisites\">Prerequisites</h3><p>Heroku manages application deployments with Git. A Git application repository is Prerequisite 0, and necessary for Heroku deployment. A <code>smartsite</code> Git repository was initialized in a previous section, but keep this requirement in mind for any future new build.</p><ol><li><p>Create a Heroku accountTo get started with Heroku, you will need a Heroku account. If you do not yet have a Heroku account, navigate to <a href=\"https://heroku.com\">heroku.com</a> and create one.</p></li><li><p>Install the Heroku CLIHeroku provides a command-line interface so that creating, configuring, and maintaining Heroku applications and add-ons is as easy as a terminal command. This is very powerful functionality that ultimately could be done via Heroku's web interface, yet the Heroku terminal commands are much more concise approach to accomplishing these tasks. Install the <a href=\"https://devcenter.heroku.com/articles/heroku-cli\">Heroku CLI</a> (https://devcenter.heroku.com/articles/heroku-cli).</p></li></ol><h3 id=\"1herokucreate\">1. <code>heroku create</code></h3><p>Run the <code>heroku create</code> command. Use the optional <code>&lt;appName&gt;</code> parameter to create a user friendly slug.</p><div class=\"filename\">command line</div><pre><code class=\"bash language-bash\">$ heroku create &lt;appName&gt;</code></pre><p>Replace <code>&lt;appName&gt;</code> with your choice of app name. This affects the application's URL. For example, <code>heroku create smartsite</code> will be accessible from the URL <code>smartsite.herokuapp.com</code>. The output of the command will list the remote application's URL.</p><div class=\"filename\">command line</div><pre><code class=\"bash language-bash\">$ heroku create smartsiteCreating ⬢ smartsite... donehttps://smartsite.herokuapp.com/ | https://git.heroku.com/smartsite.git</code></pre><p>`</p><p>Heroku subdomains must be unique. If the <code>&lt;appName&gt;</code> selected is already in use, you will need to re-run the command with a new name. If no <code>&lt;appName&gt;</code> is provided, creates the app with a random slug. For example <code>heroku create</code> with no name specified will create the URL with a random subdomain such as <code>sleepy-meadow-81798.herokuapp.com</code>.</p><p>Notice as well that the output of the <code>create</code> command also lists the URL for the application's Heroku Git repository. This is Heroku's copy of the filesystem to which <code>git commit</code>ed changesets will be applied.</p><h3 id=\"2gitcommit\">2. <code>git commit</code></h3><p>The most recent git commit is what will go live on Heroku. If there are local changes to the working directory that are not committed, they will not be made live on Heroku. Keep this in mind, and use it when appropriate. For now, we will save all local changes to the local git repository and sync the changes to Heroku.</p><div class=\"filename\">command line</div><pre><code>$ git status$ git add .$ git commit -m 'Create commit'</code></pre><h3 id=\"3pushtoheroku\">3. Push to Heroku</h3><p>The <code>heroku create</code> command added a remote git repository on Heroku's servers. See this new remote by running the command <code>$ git remote -v</code>. Push the code to this remote.</p><div class=\"filename\">command line</div><pre><code>$ git push heroku [branchName]</code></pre><p>You can watch the build logs output in the terminal. Whether the deployment is successful or not is displayed in the terminal at the end of the logs.</p><h3 id=\"4accesstheapplication\">4. Access the application.</h3><p>The deployed application can be accessed by navigating in the browser to the URL output by Step 1. You can also open the deployed application with the command <code>heroku open</code>.</p><div class=\"filename\">command line</div><pre><code class=\"bash language-bash\">$ heroku open</code></pre><h3 id=\"resources\">Resources</h3><p>The Heroku CLI: <a href=\"https://devcenter.heroku.com/articles/heroku-cli\">https://devcenter.heroku.com/articles/heroku-cli</a></p>",
    "sectionType": "section",
    "sequence": 1,
    "parentSection": {
      "parentSectionPart": 2,
      "parentSectionType": "chapter",
      "parentSectionSequence": 3
    }
  },
  {
    "title": "Authentication",
    "slug": "authentication",
    "content": "<h2 id=\"authentication\">Authentication</h2><p><strong>Authentication</strong> is the process of verifying the identity of an individual. User authentication allows developers of a web application to craft individualized experiences. In practice, this means allowing access to priveleged material such as creating database records and visiting . This ability to deliver dynamic content individualized per visitor session is the general differentiator between a web<em>site</em> and a web <em>application</em>.</p><p>The ability to register a user account with the app, and sign in and out on request is the basis of user authentication. Identity and Access Management systems is a discipline in its own right. It is a foundational component to the interactive internet. Consider the example of a social media platform.</p><p>Once a user logs in, the application can display content based on user preferences and saved data. Consider the FaceBook profile page. Every user of FaceBook can navigate to <code>facebook.com/profile</code>, and be presented with a profile page. Despite receiving the same webpage template, the page is customized to display the feed and information of the currently logged in user.</p><p>Further, if a user <em>is not</em> a logged in user of FaceBook, the page does not display and instead redirects to registration form. The ability to gate features is an additional benefit of adding an authentication component to a web application.</p><h3 id=\"authorization\">Authorization</h3><p><strong>Authorization</strong> is a term closely related to Authentication. Where authentication refers to the ability to verify the user's identity, authorization refers to allowing or restricting a user's access to certain resources.</p><p>In the example of a social media network, a user that has <em>not</em> authenticated with the server (i.e. not signed in) will likely be blocked from accessing a <code>/profile</code> page. Further, even if a user is signed in, certain actions like updating a different user's profile information is likely prohibited. For Software-as-a-Service (SAAS) web applications, authorization comes in the form of allowing and restricting application features based on a user's payment tier.</p><p>While the need for authorization is generally universal for web applications, authorization concerns are specific to the \"business logic\" or domain rules of the application. Questions like how many tiers of user access are necessary and what resources should be available to whom are answered in examination of the real-world business rules the application is built to model.</p>",
    "sectionType": "chapter",
    "sequence": 4,
    "parentSection": {
      "parentSectionPart": 2,
      "parentSectionType": "part",
      "parentSectionSequence": 2
    }
  },
  {
    "title": "Add Auth",
    "slug": "add-auth",
    "content": "<h2 id=\"addauthenticationwithauth0\">Add Authentication with Auth0</h2><p><code>smartsite</code> will utilize the Auth0 service for authentication. Auth0 is a drop-in IAM solution to add authentication and authorization services to an application. Notably, it comes with single-sign on which will allow users of <code>smartsite</code> to sign up with the social provider (e.g. Google, Apple) of their choice. In addition to the fundamental authentication flow featured in <code>smartsite</code> Basics, Auth0 offers further authentication features such as multi-factor authentication, custom landing pages, and multi-domain applications.</p><h3 id=\"1signupforauth0\">1. Sign up for Auth0</h3><p>Auth0 provides a user interface for configuring applications' authentication settings. Setting up an application in the interface is a step-by-step walkthrough process.</p><ol><li>Sign up for Auth0's free tier</li><li>Navigate to the Applications Dashboard</li><li>\"Create Application\". Set name and select \"Regular Web Application\"</li><li>Select Node.js from the list of supported frameworks and \"Integrate now\"</li><li>Set the \"Allowed Callback URL\"</li></ol><ul><li>Set this value to <code>https://localhost:3001/callback</code>.</li><li>More the callback URL is covered in the \"Caddy reverse proxy\" section.</li><li>Set \"Allowed Logout URLs\"</li><li>Set this value to <code>https://localhost:3001</code></li></ul><h3 id=\"2addauth0tosmartsite\">2. Add Auth0 to <code>smartsite</code></h3><p>Now that the third-party service is configured to accept requests, we must now add code within <code>smartsite</code> that makes calls to Auth0's application interface (API). While using raw HTTP calls to accomplish this is possible, <code>smartsite</code> will utilize Auth0 provided API wrapping library, <code>express-openid-connect</code>. This package abstracts the HTTP routing and configuration to JavaScript functions and classes with developer-friendly interfaces.</p><ol><li>Install the <code>express-openid-connect</code> authentication middleware.</li></ol><div class=\"filename\">command line</div><pre><code>$ npm install express-openid-connect</code></pre><ol start=\"2\"><li>Copy the configuration code provided by Auth0's Quick Start wizard.</li></ol><p>The Express OpenID library provides a router that defines authentication routes -- <code>/login</code>, <code>/logout</code>, and <code>/callback</code> -- for the application. Under the hood, the package is using the familiar syntax for defining a route for an Express app.</p><pre><code class=\"javascript language-javascript\">app.get('/login', handleLogin);app.get('/logout', handleLogout);</code></pre><p>Instead of the end using developer having to define this logic or handling functions, <code>express-openid-connect</code> exposes a configuration object interface. The developer simply initializes the router with application specific configuration, and all authentication routing is forwarded to Auth0 as necessary.</p><p>Better yet, Auth0 provides the configuration object and JavaScript snippet within their Quick Start interface. The snippet goes in <code>index.js</code>. It requires the <code>auth</code> router from <code>express-openid-connect</code>, and configures the <code>auth</code> router with variables provided by Auth0.</p><div class=\"filename\">index.js</div><pre><code class=\"javascript language-javascript\">const { auth } = require('express-openid-connect');const config = {  authRequired: false,  auth0Logout: true,  secret: 'a long, randomly-generated string stored in env',  baseURL: 'https://localhost:3001',  clientID: '[UNIQUE CLIENT ID]',  issuerBaseURL: 'https://[UNIQUE ID].us.auth0.com'};// auth router attaches /login, /logout, and /callback routes to the baseURLapp.use(auth(config));</code></pre><p>Next, the snippet provides an example route that utilizes the <code>isAuthenticated</code> helper method provided by the <code>auth</code> middleware. <code>smartsite</code> already has a <code>/</code> route, so if you intend to keep the example route, rename its path to avoid pathname conflicts.</p><div class=\"filename\">index.js</div><pre><code class=\"javascript language-javascript\">// req.oidc is provided from the auth router// isAuthenticated is a method on the req.oidc objectapp.get('/auth-check', (req, res) =&gt; {  res.send(req.oidc.isAuthenticated() ? 'Logged in' : 'Logged out');});</code></pre><h3 id=\"3setupanhttpsproxy\">3. Set up an HTTPS proxy</h3><p>Notice that the <code>baseURL</code> Auth0 is aware of is <code>https://localhost:3001</code>. Auth0 requires authentication traffic be delivered via the HTTP<strong>Secure</strong> protocol. HTTPS is an extension to the HTTP protocol, but includes layers of security via encryption and certificate checking to ensure the identity of web servers.</p><p>The Auth0 configuration is different in two ways from the Express server in <code>index.js</code>:</p><ol>  <li>It is served over the <pre>HTTPS</pre> protocol.</li>  <li>Its port address is 3001.</li></ol><p>In this step, we'll set up a webserver to traffic (i.e. proxy) HTTPS web traffic at port 3001 to the Express server listening at port 3000. When the proxy server is running, the application available at both <code>http://localhost:3000</code> and <code>https://localhost:3001</code>.</p><p>Note: This solution is for local development. The proxy server will not need to be run in production because Heroku defaults to serving all web traffic over HTTPS.</p><p>Install the <code>@leafac/caddy</code> npm library as a dev dependency.</p><div class=\"filename\">command line</div><pre><code>$ npm i --save-dev @leafac/caddy</code></pre><h3 id=\"4createastartscriptfortheproxyserver\">4. Create a start script for the proxy server</h3><p>Add a script, <code>https-proxy</code>, to <code>package.json</code>:</p><div class=\"filename\">package.json</div><pre><code class=\"javascript language-javascript\">\"scripts\": {  ...,  \"https-proxy\": \"npx @leafac/caddy reverse-proxy --from localhost:3001 --to localhost:3000\"}</code></pre><p>The caddy library defaults to interpreting the <code>--from</code> parameter as <code>https</code> and the <code>to</code> parameter as <code>http</code> -- exactly what is needed in this case.</p><p>We can now run <code>npm run https-proxy</code> and the proxy server will initialize and forward traffic HTTPS traffic at port 3001 to port 3000. You will have to open seperate terminal windows to run <code>npm run start</code> and <code>npm run https-proxy</code> concurrently. Alternatively, look into an npm library like <a href=\"https://www.npmjs.com/package/npm-run-all\"><code>npm-run-all</code></a> for a tool to run both commands from one terminal window.</p><h3 id=\"5testlocally\">5. Test locally</h3><ol><li>Within <code>index.js</code>, alter <code>/</code> route to pass the <code>isAuthenticated()</code> boolean to the front end.</li></ol><div class=\"filename\">index.js</div><pre><code class=\"javascript language-javascript\">app.get('/', function(request, response) {  response.render('index', {    loggedIn: request.oidc.isAuthenticated()  });});</code></pre><ol start=\"2\"><li>Alter <code>index.liquid</code> to show a Logout or Login button depending on whether there is a currently logged in user. Within the list of links:</li></ol><div class=\"filename\">index.liquid</div><pre><code class=\"html language-html\">&lt;li&gt;  {% if loggedIn %}  &lt;a href=\"/logout\"&gt;Logout&lt;/a&gt;  {% else %}  &lt;a href=\"/login\"&gt;Login&lt;/a&gt;  {% endif %}&lt;/li&gt;</code></pre><ol start=\"3\"><li>To see the full changes, first run the Express and Caddy servers (<code>npm run start</code> and <code>npm run dev-proxy</code> respectively.) Next, open a browser to <code>localhost:3001</code>, and navigate through the authentication flow.</li></ol><ol>  <li>Click Login</li>  <li>Authenticate with Auth0</li>  <li>Be redirected back to the base URL, <pre>localhost:3001</pre>.</li>  <li>Click Logout</li></ol><h3 id=\"6gitcommitthechanges\">6. Git commit the changes</h3><p>This was a significant unit of development. The server now has the ability to authenticate users, albeit only for the local environment. We will look at authentication for the deployed environment in the next section. For now, <code>git commit</code>!</p><div class=\"filename\">command line</div><pre><code>$ git add .$ git commit -m 'Add auth in development'</code></pre><h3 id=\"resources\">Resources</h3><p>Auth0: https://auth0.com/docs/</p><p>Auth0 Explainer Video: https://auth0.com/resources/videos/auth0-explainer-video</p><p>Auth0 Express: https://auth0.com/docs/quickstart/webapp/express</p><p>HTTPS in Development: https://auth0.com/docs/libraries/secure-local-development</p><p>Run Node Commands Simultaneously: https://itnext.io/4-solutions-to-run-multiple-node-js-or-npm-commands-simultaneously-9edaa6215a93</p>",
    "sectionType": "section",
    "sequence": 1,
    "parentSection": {
      "parentSectionPart": 2,
      "parentSectionType": "chapter",
      "parentSectionSequence": 4
    }
  },
  {
    "title": "Auth Deployed",
    "slug": "auth-deployed",
    "content": "<h2 id=\"authenticationinthedeployedenvironment\">Authentication in the Deployed Environment</h2><p>To get authentication accessible to an internet audience, we will have to get the feature live in a deployed environment. After some minor changes to the Auth0 configuration and application code, the application will be ready for deploy to Heroku.</p><p>The application, both within the code and within the Auth0 interface, is currently configured to use <code>localhost</code> addresses for callbacks and redirects. The base URL in the deployed state will be different -- <code>&lt;your_app_slug&gt;.herokuapp.com</code> if you are following this walkthrough.</p><p>The first approach to look at is using the same Auth0 application for local development and in the deployed environment. There are use cases for this method, but it is not the most robust solution.</p><h3 id=\"authenticationusingthesameauth0application\">Authentication Using the Same Auth0 Application</h3><p>Within the Auth0 interface, the application will need to be configured to listen for traffic coming from both the development server <em>and</em> the live deployment server. Notably, these servers have different root URLs. </p><h3 id=\"1modifytheauth0configuration\">1. Modify the Auth0 configuration</h3><p>Add <code>https://&lt;your-app&gt;.herokuapp.com</code> alongside the <code>https://localhost</code> entries.</p><p>[image callback_urls.png]</p><p>The \"Allowed Callback URLs\" and \"Allowed Logout URLs\" fields accept comma-separated values. Be sure to use <code>https</code> as you type these values. Save changes.</p><h3 id=\"2modifytheexpressserver\">2. Modify the Express server</h3><p>Within <code>index.js</code>, alter the Auth0 configuration to conditionally use the Heroku URL as the application's <code>baseURL</code>.</p><div class=\"filename\">index.js</div><pre><code class=\"javascript language-javascript\">// Auth0const config = {  baseURL:    process.env.NODE_ENV == 'production' ? 'https://&lt;your-app&gt;.herokuapp.com' : 'https://localhost:3001',  ...};</code></pre><h3 id=\"3modifytheprocfile\">3. Modify the Procfile</h3><p>The conditional added in step 2 evaluates to true if the <code>NODE_ENV</code> environment variable is set to <code>'production'</code>. If the env variable is not set or is set to a different value, the conditional will evaluate to false. We will force the environment variable to be set to <code>'production'</code> when Heroku starts the server process.</p><p>A common method of providing environment variables to a process is to define them immediately before the process command. The <code>Procfile</code> contains the command Heroku uses to start the web server. Define <code>NODE_ENV</code> at the start of the <code>web</code> process.</p><div class=\"filename\">Procfile</div><pre><code>web: NODE_ENV=production npm run start</code></pre><ol start=\"4\"><li>Deploy the application to Heroku.<code>git add</code> and <code>commit</code> all changes, then push the Git repository to Heroku.</li></ol><div class=\"filename\">command line</div><pre><code>$ git add .$ git commit -m 'Add auth for Heroku'$ git push heroku master</code></pre><p>When the deploy is finished and if all is configured properly, the application will be available at its deployed URL with the authentication feature. Use the <code>heroku open</code> utility to open the app in a web browser.</p><div class=\"filename\">command line</div><pre><code>$ heroku open</code></pre><h3 id=\"resources\">Resources</h3><p>Environment Variables in Node.js: <a href=\"https://www.twilio.com/blog/working-with-environment-variables-in-node-js-html\">https://www.twilio.com/blog/working-with-environment-variables-in-node-js-html</a></p>",
    "sectionType": "section",
    "sequence": 2,
    "parentSection": {
      "parentSectionPart": 2,
      "parentSectionType": "chapter",
      "parentSectionSequence": 4
    }
  },
  {
    "title": "Environment Variables",
    "slug": "environment-variables",
    "content": "<h2 id=\"environmentvariables\">Environment Variables</h2><p>The need for environment specific configuration is inherent in developing a web application. Environment variables are variables that describe the environment in which the application or script is being invoked. <code>smartsite</code> is currently configured to run in two environments: a developer's local system and Heroku for production. As we encountered in the last section, a web application will likely be required to have different configuration for the different environments.</p><p>Specifically, the application needed to be aware of which environment it was running in to know with what <code>baseUrl</code> to configure the Auth0 middleware.</p><div class=\"filename\">index.js</div><pre><code class=\"javascript language-javascript\">const config = {  baseURL:    process.env.NODE_ENV == 'production' ? 'https://&lt;your-app&gt;.herokuapp.com' : 'https://localhost:3001',  ...};</code></pre><p>Environment variables are the solution for the differing configuration variables, yet the implementation varies. Currently, <code>smartsite</code> uses an inline ternary operator to determine a selection between two publically available datum. This solution a) does not scale, and b) will not work for datasets we would not like to be publically exposed.</p><p>To get a good grasp on the issues of scalability and security, let's look at the example of adding a new application configuration that will need to be different per environment. For illustration, we'll consider adding database credentials. A database connection requires the Node.js application to be configured with a username, password, and host URL to authenticate with the database server. These values will be different between environments.</p><p>As a look ahead, the foundations covered here will be implemented in the <strong>Database</strong> section.</p><h3 id=\"scalability\">Scalability</h3><p>Because <code>smartsite</code> runs in only two environments, checking if an environment variable is one of the possible values is able to be accomplished in one line. But what if there were more than two environments? To use the example of adding database credentials, the application will need to be configured for development, production and <em>test</em> environment -- this would require a check for one of three values.</p><div class=\"filename\">pseudocode</div><pre><code>const dbHost = process.env.NODE_ENV == 'production' ? 'production.database' : process.env.NODE_ENV == 'test' ? 'test.database' : 'development.database';</code></pre><p>This process is barely legible using ternary operators, and a <code>switch</code> statement is likely more suited:</p><div class=\"filename\">pseudocode</div><pre><code class=\"javascript language-javascript\">let dbHost;switch(process.env.NODE_ENV) {  case 'production':    dbHost = 'production.database'  case 'test':    dbHost = 'test.database'  default:    dbHost = 'development.database'}</code></pre><p>This is barely more readable. Developers must now contend with minimum 9-line <code>switch</code> statements for each database configuration variable. If this pattern continues into future development, each new database, third-party integration or <em><reason></em> to use environment variables will come with the same burden of clutter.</p><p>A solution for scalability looks like keeping configuration variables stored in environment-specific objects. When the application boots up, select the appropriate configuration object based on <code>NODE_ENV</code>.</p><div class=\"filename\">pseudocode</div><pre><code class=\"javascript language-javascript\">// index.jsconst environments = {  \"development\": {    \"dbUser\": \"popdemtech\",    \"dbPassword\": \"popdemtech123\",    \"dbName\": \"smartsite\",    \"dbHost\": \"localhost:5432\"  },  \"production\": {    \"dbUser\": \"smartsite\",    \"dbPassword\": \"myappXYZ123\",    \"dbName\": \"smartsite\",    \"dbHost\": 'heroku-postgres://smartsite',  },  \"test\": {    \"dbUser\": \"popdemtech\",    \"dbPassword\": \"popdemtech123\",    \"dbName\": \"smartsite-test\",    \"dbHost\": \"localhost:5432\"  }};const config = environments[process.env.NODE_ENV] || environments['development'];</code></pre><p>By collecting variables into environment specific objects, using environment variables within application scripts is as simple as accessing the appropriate property on the environment specific <code>config</code> object. Because checking <code>NODE_ENV</code> occurs at the point of selecting the correct <code>config</code> object, the need for <code>switch</code> statments and ternary operators is removed.</p><div class=\"filename\">pseudocode</div><pre><code class=\"javascript language-javascript\">const dbHost = process.env.NODE_ENV == 'production' ? 'production.database' : process.env.NODE_ENV == 'test' ? 'test.database' : 'development.database';// turns intoconst dbHost = config.dbHost;</code></pre><p>This solves scalability in the following ways:</p><ol><li><p>As new <strong>environment variables</strong> are added, the process for development is to add the variable to each environment's object, and access the variable within the JavaScript as <code>config.&lt;property&gt;</code>.</p></li><li><p>As new <strong>environments</strong> are added -- such as a remote test environment for a continuous integration workflow -- configuring a environment is as simple as adding a new top-level configuration object, and setting <code>NODE_ENV</code> to the proper value at server initialization.</p></li><li><p>There is no complex logic involved in determining the correct set of environment variables to use.</p></li></ol><h3 id=\"security\">Security</h3><p>The need for security arises when a web application needs access to data that should not be checked into source code. This is clearly illustrated in the example database credentials within the <code>environments</code> object:</p><div class=\"filename\">pseudocode</div><pre><code class=\"javascript language-javascript\">const environments = {  \"production\": {    \"dbUser\": \"smartsite\",    \"dbPassword\": \"myappXYZ123\",    \"dbName\": \"smartsite\",    \"dbHost\": 'heroku-postgres://smartsite',  }};</code></pre><p>If this code is checked into the source repository using <code>git commit</code>, a nefarious internet abuser would be able to impersonate the application, and gain full access to the database. While there are many safeguards in place to encrypt transmissions carrying the source code, e.g. HTTPS, there are many areas of the deployment pipeline where application code is readable in plaintext.</p><p><strong>Do not save private keys and passwords to source code.</strong> More than a best practice, this is standard operating procedure for organizational and user security.</p><p>We have been speaking of environment variables in terms of their use in a web application, but have glossed over their practical feature as it pertains to application development at large. An environment variable, conventionally written in <code>ALL_CAPS</code> snakecase, is set at the <em>operating system</em> or <em>process</em> level. This is external to the JavaScript application. The <code>process.env</code> variable within Node.js has access to these lower-level variables.</p><p>After setting the variables within the operating system environment, using these variables within the app is as simple as <code>process.env</code>.</p><div class=\"filename\">pseudocode</div><pre><code class=\"javascript language-javascript\">const environments = {  \"production\": {    \"dbUser\": process.env.DB_USER,    \"dbPassword\": process.env.DB_PASS,    \"dbName\": process.env.DB_NAME,    \"dbHost\": process.env.DB_HOST,  }};</code></pre><p>While the secure variable now will be defined external to the application, an open question remains: <em>\"Where will environment variables be defined?\"</em></p><p>For local development, a file that's been added to <code>.gitignore</code> suffices. Heroku, the deployed environment, provides both a CLI and graphic interface for entering custom environment variables.</p><h3 id=\"review\">Review</h3><p>Environment variables provide a standard interface for developers to specifiy configuration on a per-environment basis. By extracting environment-dependent configuration into a structured object, we simplify the application code. The code is simplified by a reduction of logic and a compacting of locations where environment variable data can be found.</p><p>Environment variables are also used to keep secure data out of application logic. By defining and providing variables <em>external</em> to the application, these values are not accessible to unethical hackers who may get access to source code.</p><h3 id=\"resources\">Resources</h3><p>Environment variable: <a href=\"https://en.wikipedia.org/wiki/Environment_variable\">https://en.wikipedia.org/wiki/Environment_variable</a></p><p>Working with Environment Variables in Node.js: <a href=\"https://www.twilio.com/blog/working-with-environment-variables-in-node-js-html\">https://www.twilio.com/blog/working-with-environment-variables-in-node-js-html</a></p><p>The Twelve Factor App (Config): <a href=\"https://12factor.net/config\">https://12factor.net/config</a></p>",
    "sectionType": "chapter",
    "sequence": 5,
    "parentSection": {
      "parentSectionPart": 2,
      "parentSectionType": "part",
      "parentSectionSequence": 2
    }
  },
  {
    "title": "Using Env Vars",
    "slug": "using-env-vars",
    "content": "<h2 id=\"usingenvironmentvariables\">Using Environment Variables</h2><p>As covered in the last section, environment variables are used to capture environment specifc configuration. We will use the conventions outlined in the previous section to handle environment variables in <code>smartsite</code>.</p><p>The Node.js community has converged on the <code>dotenv</code> library to manage environment variables in application code. We will add <code>dotenv</code> to the application and use environment variables to manage Auth0 configuration variables.</p><h3 id=\"1installdotenv\">1. Install dotenv</h3><p>Dotenv will be used in all environments. Save it as an application dependency.</p><div class=\"filename\">command line</div><pre><code>$ npm install dotenv</code></pre><h3 id=\"2createenv\">2. Create .env</h3><p>Dotenv works by reading a file named <code>.env</code> located in the root directory. Variables defined in <code>.env</code> using the format <code>VARIABLE_NAME=\"value\"</code> are read into the application and made available on the <code>process.env</code> object.</p><ol><li>Create <code>.env</code>In the root directory, create a new file named <code>.env</code>. In this file, define a variable for Auth0 base URL.</li></ol><div class=\"filename\">.env</div><pre><code>AUTH0_BASE_URL=\"https://localhost:3001\"</code></pre><h3 id=\"3usethevariablesintheapplication\">3. Use the variables in the application</h3><p>Using the dotenv library within the web application involves importing the library, and calling it's <code>config()</code> method. This method call attaches the variables to <code>process.env</code>, and should be invoked as early in the application script as necessary.</p><ol><li>Require <code>dotenv</code></li></ol><div class=\"filename\">index.js</div><pre><code class=\"javascript language-javascript\">require('dotenv').config();</code></pre><ol start=\"2\"><li>Set <code>baseUrl</code> to the environment variableReplace the ternary operation with the <code>AUTH0_BASE_URL</code> environment variable.</li></ol><div class=\"filename\">index.js</div><pre><code class=\"javascript language-javascript\">// Auth0const config = {  ...  baseURL: process.env.AUTH0_BASE_URL,  ...};</code></pre><ol start=\"3\"><li>Restart the serverTest that the new configuration works by restarting the server and walking through the authentication steps. Remember to start the HTTPS proxy in a separate terminal window. Expect the features to work as before.</li></ol><div class=\"filename\">command line</div><pre><code>$ npm run start$ npm run https-proxy</code></pre><h3 id=\"3migrateauth0configuration\">3. Migrate Auth0 configuration</h3><p>Using the same process as outlined, we will migrate more Auth0 configuration to the <code>.env</code> file. The criteria used to determine which properties should be managed as environment variables are whether a) the property is configurable within the Auth0 dashboard, b) the property is likely to change if a different Auth0 application is used as a backend, and c) if the data should be kept secure.</p><ul><li>Configurable within Auth0</li><li><code>baseURL</code></li><li><code>routes.callback</code></li><li>Different per Auth0 application</li><li><code>clientID</code></li><li><code>issuerBaseURL</code></li><li>Should be kept secure</li><li><code>secret</code></li></ul><ol><li>Add the specified data to <code>.env</code></li></ol><div class=\"filename\">.env</div><pre><code>AUTH0_BASE_URL=\"https://localhost:3001\"AUTH0_CALLBACK_ROUTE=\"/auth0/callback\"AUTH0_CLIENT_ID=\"BdsyUqLCLcMDv21lT9VzCRuo8fP2xvZl\"AUTH0_ISSUER_BASE_URL=\"https://dev-r6lb7q89.us.auth0.com\"AUTH0_SECRET=\"a long, randomly-generated string stored in env\"</code></pre><ol start=\"2\"><li>Use environment variables to configure Auth0Replace the hard-coded strings used to configure the Auth0 middleware with <code>process.env</code> variables.</li></ol><div class=\"filename\">index.js</div><pre><code class=\"javascript language-javascript\">// Auth0const config = {  authRequired: false,  auth0Logout: true,  secret: process.env.AUTH0_SECRET,  baseURL: process.env.AUTH0_BASE_URL,  clientID: process.env.AUTH0_CLIENT_ID,  issuerBaseURL: process.env.AUTH0_ISSUER_BASE_URL,  routes: {    callback: process.env.AUTH0_CALLBACK_ROUTE  }};</code></pre><h3 id=\"4generateasecretstring\">4. Generate a <code>secret</code> string</h3><p>The Auth0 configuration object's <code>secret</code> key is used to encrypt the user's session cookie. This value should be a \"long, random string.\" Technically, the value provided by Auth0's Quick Start satisfies this constraint. To generate a more random string, Auth0 recommends the OpenSSL command line utility.</p><div class=\"filename\">macOS/*nix command line</div><pre><code>$ openssl rand -hex 32</code></pre><div class=\"filename\">Windows command line</div><pre><code>&gt; &amp; 'C:\\Program Files\\Git\\usr\\bin\\openssl.exe' rand -hex 32</code></pre><p>If none of the above options work, an online random string generator will do.</p><ol start=\"3\"><li>Replace the environment variable with the output from the command.</li></ol><div class=\"filename\">.env</div><pre><code>AUTH0_SECRET=\"ce0b8df696236657682ca78c233b174b1d7581761467270256d778baf1fb9cd5\"</code></pre><h3 id=\"5restarttheserver\">5. Restart the server</h3><p>Changes to the <code>.env</code> file do not trigger the <code>nodemon</code> filesystem watcher to restart the Express server. Stop and restart the server process for the application to reflect changes to the <code>.env</code> file.</p><div class=\"filename\">command line</div><pre><code>$ npm run start</code></pre><p>The authentication flow should perform as usual.</p><h3 id=\"6addaroute\">6. Add a Route</h3><p>Add to the chronicle of <code>smartsite</code> by adding a webpage that renders dynamic content based on environment variables.</p><ol><li>Create a <code>GET</code> routeDefine a route on the Express app that renders a template, <code>env-vars.liquid</code>, with local variables.</li></ol><div class=\"filename\">index.js</div><pre><code class=\"javascript language-javascript\">app.get('/env-vars', function (request, response) {  const isProduction = process.env.NODE_ENV == 'production';  const auth0BaseUrl = process.env.AUTH0_BASE_URL;  response.render('env-vars', { isProduction, auth0BaseUrl })});</code></pre><ol start=\"2\"><li>Create the view templateDisplay the <code>isProduction</code> and <code>auth0BaseUrl</code> local variables within a simple template.</li></ol><div class=\"filename\">app/views/env-vars.liquid</div><pre><code class=\"html language-html\">{% layout 'layouts/default-html.liquid' %}{% block content %}&lt;div&gt;  &lt;h1&gt;Environment Variables&lt;/h1&gt;  &lt;p&gt;    This webpage has been    {% if isProduction %}      &lt;b&gt; served from the production environment.&lt;/b&gt;    {% else %}      &lt;b&gt; served from a non-production environment.&lt;/b&gt;    {% endif %}  &lt;/p&gt;  &lt;p&gt;    The Auth0 base URL is    {% if auth0BaseUrl %}      &lt;b&gt;{{ auth0BaseUrl }}&lt;/b&gt;    {% else %}      &lt;b&gt; not defined.&lt;/b&gt;    {% endif %}  &lt;/p&gt;&lt;/div&gt;{% endblock %}</code></pre><ol start=\"3\"><li>Add this new page to the site navigation in <code>index.liquid</code>.</li></ol><div class=\"filename\">app/views/index.liquid</div><pre><code class=\"html language-html\">&lt;li&gt;&lt;a href=\"/env-vars\"&gt;env-vars&lt;/a&gt;&lt;/li&gt;</code></pre><p>With your development server started, you can now navigate to <code>/env-vars</code> from the home page and visualize some of the application's environment variables.</p><p>[env-vars-webpage.png image]</p><p>This simplistic page is for demonstration purposes; the primary takeaway should be the new abilities to set application configuration on a per-environment basis.</p><h3 id=\"6distributeenvironmentvariables\">6. Distribute Environment Variables</h3><p>Environment variables should be kept out of version control. If you used the <code>.gitignore</code> provided by this walkthough, <code>.env</code> is already included to be ignored.</p><p>Despite keeping the sensitive information out of the version control, developers will need a way to share a list of what environment variables are required to configure the application. The standard solution to this is to distribute a <code>.env.dist</code> file with source control which contains the environment variable names, but not the sensitive values.</p><p>The <code>.env.dist</code> file should be kept up to date as more environment variables are added to the application. This file can be used to onboard new developers to the project, as well it records a list of what environment variables need to be set for the application to run properly in any new environment.</p><ol><li><p>Ensure <code>.env</code> is an ignored file in <code>.gitignore</code>.</p></li><li><p>Create a <code>.env.dist</code> fileCreate the new file mirroring <code>.env</code>, but with the sensitive values removed. Discernment dictates the only value that raises security flags is <code>AUTH0_SECRET</code>, so its value will be redacted.</p></li></ol><div class=\"filename\">.env.dist</div><pre><code>AUTH0_BASE_URL=\"https://localhost:3001\"AUTH0_CALLBACK_ROUTE=\"/auth0/callback\"AUTH0_CLIENT_ID=\"BdsyUqLCLcMDv21lT9VzCRuo8fP2xvZl\"AUTH0_ISSUER_BASE_URL=\"https://dev-r6lb7q89.us.auth0.com\"AUTH0_SECRET=</code></pre><h3 id=\"7gitcommitallchanges\">7. Git commit all changes</h3><p>Environment variables configuration is now complete, and the application is working locally. Time to <code>git commit</code> the changes in preparation for deployment to Heroku.</p><p>Use the command <code>git status</code> before running <code>git add</code> to ensure <code>.env</code> is not saved to version control. <code>.env.dist</code> should be listed as an \"untracked file\".</p><div class=\"filename\">command line</div><pre><code>$ git status$ git add .$ git commit -m 'Use Auth0 environment variables'</code></pre><h3 id=\"resources\">Resources</h3><p>Dotenv: <a href=\"https://www.npmjs.com/package/dotenv\">https://www.npmjs.com/package/dotenv</a></p><p>OpenSSL on Windows: <a href=\"https://stackoverflow.com/a/68253950/18752242\">https://stackoverflow.com/a/68253950/18752242</a></p><p>Random String Generator: <a href=\"https://www.random.org/strings/\">https://www.random.org/strings/</a></p>",
    "sectionType": "section",
    "sequence": 1,
    "parentSection": {
      "parentSectionPart": 2,
      "parentSectionType": "chapter",
      "parentSectionSequence": 5
    }
  },
  {
    "title": "Env Vars In Production",
    "slug": "env-vars-in-production",
    "content": "<h2 id=\"environmentvariablesinproduction\">Environment Variables in Production</h2><p>A cursory glance at the code changes in the last section reveals that we have removed references to <code>https://&lt;your-app&gt;.herokuapp.com</code>, but have yet to replace this value. When <code>require('dotenv').config()</code> is invoked, <em>no values will be appended to</em> <code>process.env</code> <em>since there is no</em> <code>.env</code> <em>file in the filesystem pushed to Heroku.</em></p><p>Different deployment strategies have different requirements for how environment variables are set. Deployment onto a remote Linux machine may require accessing the server via SSH and manualy creating a <code>.env</code> file in the remote environment. Containerized deployment often uses platform-specific configuation files -- such as <code>docker-compose.yml</code> for organizing the environment.</p><p>Heroku's platform-as-a-service solves deployed environment variables in simple terms. Each Heroku application comes with a Settings page for configuring variables within Heroku's web UI. As well, the <code>heroku</code> CLI utility provides a one-line command for setting environment variables remotely.</p><h3 id=\"herokuconfigurationvariablesgraphicinterface\">Heroku Configuration Variables: Graphic Interface</h3><p>Heroku calls environment variables \"Config Vars,\" and these can be found within an application's Settings page.</p><p>[heroku application settings.png]</p><p>Click \"Reveal Config Vars\" button to show all variables and reveal input fields to edit them. If there are no Config Vars, a descriptive message will be shown. In both cases, a developer can add a new configuration variable directly in this interface by entering a new <code>KEY</code> and <code>VALUE</code>, and clicking \"Add\".</p><p>[heroku empty config vars.png]</p><p>Feel free to use the graphic interface to set environment variables. The <code>smartsite</code> walkthrough details using Heroku's CLI to accomplish this task.</p><h3 id=\"herokuconfigvarscommandlineinterface\">Heroku Config Vars: Command-Line Interface</h3><p>The Heroku CLI allows developers to manage Heroku apps directly from the terminal. An app's config vars are accessible via the subcommand <code>config</code>. Issuing the command <code>heroku config --help</code> displays options for the subcommand.</p><div class=\"filename\">command line</div><pre><code>$ heroku config --helpdisplay the config vars for an appUSAGE  $ heroku configOPTIONS  -a, --app=app        (required) app to run command against  -j, --json           output config vars in json format  -r, --remote=remote  git remote of app to use  -s, --shell          output config vars in shell formatCOMMANDS  config:edit   interactively edit config vars  config:get    display a single config value for an app  config:set    set one or more config vars  config:unset  unset one or more config vars</code></pre><h3 id=\"1setaconfigvar\">1. Set a Config Var</h3><p>Issue the command <code>heroku config:set</code> to set the <code>NODE_ENV</code> configuration variable to <code>production</code>.</p><p><strong>Note:</strong> Remember what Heroku calls \"config vars\" are more provided to the running application as environment variables.</p><div class=\"filename\">command line</div><pre><code>$ heroku config:set NODE_ENV=production</code></pre><p>Check that the variable is set by issuing the command <code>heroku config</code> with no options.</p><h3 id=\"2setauth0configuration\">2. Set Auth0 Configuration</h3><p>Use the sme process to set a config var for each of the Auth0 environment variables. The one variable which must be different from local configuration is <code>AUTH0_BASE_URL</code>. The example commands cover two methods of setting the variables: one at a time and many at once.</p><div class=\"filename\">command line</div><pre><code>$ heroku config:set AUTH0_BASE_URL=https://&lt;your-app&gt;.herokuapp.com$ heroku config:set AUTH0_CALLBACK_ROUTE=/auth0/callback$ heroku config:set AUTH0_CLIENT_ID=&lt;your-client-id&gt; AUTH0_ISSUER_BASE_URL=&lt;your-issuer-url&gt; AUTH0_SECRET=&lt;your-secret&gt;</code></pre><p>Check that the variables are set by issuing the command <code>heroku config</code> with no options.</p><h3 id=\"3deploytoheroku\">3. Deploy to Heroku</h3><p>Now that the Heroku is aware of the environment variables the Node.js application requires, it is safe to deploy to Heroku without causing an application crash.</p><div class=\"filename\">command line</div><pre><code>$ git push heroku master$ heroku open</code></pre><p>After the deployment process, run <code>heroku open</code> to open the Heroku app. Test that all changes are successful by traversing the authentication flow. Navigate to the <code>/env-vars</code> route to see the programmed display messages.</p><h3 id=\"resources\">Resources</h3><p>Heroku config CLI: <a href=\"https://devcenter.heroku.com/articles/config-vars\">https://devcenter.heroku.com/articles/config-vars</a></p>",
    "sectionType": "section",
    "sequence": 2,
    "parentSection": {
      "parentSectionPart": 2,
      "parentSectionType": "chapter",
      "parentSectionSequence": 5
    }
  },
  {
    "title": "Databases",
    "slug": "databases",
    "content": "<h2 id=\"databases\">Databases</h2><p>End-users of an application are more engaged if the web application is dynamic. This dynamism can be accomplished with presentational logic alone, yet an improvement to user engagement a web application can provide is if data state can be saved and retrieved across user sessions.</p><p>As an example, imagine a feature that allows the user to log in and create an invoice. A user can log in and create a document with this Invoice Creator. The usefulness of the Invoice Creator application can be increased for the user if, the next time they log in, they see a list of previously created documents. A further increase in feature set -- such as the ability to edit previously saved documents -- is an increase of usability.</p><p>A solution to saving and retrieving user data is to save this data in a database.</p><p>Approaching the term from a general sense, a database is for persistent data storage. Data storage can be handled in many ways. At the most basic, pen and paper or Google Sheets suffice. Different technical solutions may require different paradigms of database solutions.</p><p>A solution to saving and retrieving user data is to save this data in a persisted storage database. This data stays in the application's database when the user is logged in or not, and can be retrieved by the user interacting with the web page or by a developer running analytics on the data.</p><h3 id=\"decidingondatabasesoftware\">Deciding on Database Software</h3><p>To reiterate, a database is for persistent data storage. Data storage can be handled in many ways. At the most basic, pen and paper or Google Sheets suffice. Different technical solutions may require different paradigms of database solutions -- such as relational, graph or time-series.</p><p>[image of relational and influxdb architecture]</p><p>The question to answer when deciding on a products database technology is, as usual:</p><p>What is it for?</p><ul><li>What types of data will go in the database?</li><li>Are there clear domain models or is there simply a need to set and retrieve singular datum?</li><li>Is this data clearly represented by relationships between the domain models (e.g. books and authors)?</li><li>Will the data need to be queried for time-series (e.g. a graph display temperature sensor measurements)</li><li>Do the objects of a given domain model always have the sames attributes or can different objects have different attribute structures?</li><li>Who is the end user of the queries for the database -- end-users of the product or business analytics tools like Tableau?</li></ul><p>Finally, consider overarching questions that relate to development and maintance of the database:</p><ul><li>What is the budget for the database?</li><li>What is the time-budget for implementing a database? A developer will have more speed with technology they are already familiar with.</li><li>What is the experience of maintainers with the technology?</li><li>Is there a solution offered on the technology platform already in production (e.g. Heroku, AWS)?</li></ul><p>From questions such as these, parse out the top three considerations that are important to the decision.</p><p>For <code>smartsite</code>, three requirements stick out:</p><ul><li>Heroku add-ons: <code>smartsite</code> already deployed on Heroku. A single-click, Heroku add-on will be ideal.</li><li>Free tier: <code>smartsite</code> is an open-source walkthrough that offers introductory Node.js guidance for developers of all budgets.</li><li>SQL: SQL is <strong>the</strong> industry standard language of relational databases. It's likely a builder of <code>smartsite</code> is already familiar with its syntax, and, if not, there are decades worth of resources to extend one's knowledge of it.</li></ul><p><code>smartsite</code> will use PostgreSQL as its persistent database. Postgres is a open-source and battle-tested SQL based database server and library. There is a Heroku add-on, Heroku Postgres, that will be used for the production database. Locally, developers will need to install the Postgres database.</p>",
    "sectionType": "chapter",
    "sequence": 6,
    "parentSection": {
      "parentSectionPart": 2,
      "parentSectionType": "part",
      "parentSectionSequence": 2
    }
  },
  {
    "title": "Install Postgres Windows",
    "slug": "install-postgres-windows",
    "content": "<h2 id=\"1installpostgresqlonwindows\">1. Install PostgreSQL on Windows</h2><p>There is a PostgreSQL installer distributed by Enterprise DB (EDB), an enterprise-level Postgres solution. Download the Windows installer from EDB, and follow the steps. https://www.enterprisedb.com/downloads/postgres-postgresql-downloads</p><p>Keep note of what is set as the installation directory. The default location is a <code>C:\\Program Files\\PostgreSQL\\[##]</code> directory, where <code>[##]</code> is the numerical version number of the installation. For example, the installation directory for version 14 is <code>C:\\Program Files\\PostgreSQL\\14\\</code>.</p><p>Keep note of the password set for the default user as well.</p><h3 id=\"2configurebinarypaths\">2. Configure binary paths</h3><p>The PostgreSQL installation comes with a library of binary executables. These executables, such as <code>psql</code>, <code>pg_dump</code>, and <code>createdb</code>, live within the <code>/bin</code> directory of the installation folder, and are how a computer user or different program can interact with the database server. The binary path will be the installation directory from Step 1 suffixed with <code>\\bin\\</code>.</p><p>For example, the default binary path for version 14 is <code>C:\\Program Files\\PostgreSQL\\14\\bin</code>.</p><p><strong>Note:</strong> Within any software package or application, binary files and executables are conventionally placed within a directory named <code>\\bin\\</code>. PostgreSQL follows this convention.</p><h4 id=\"addthebinarypathtodpath\">Add the binary path to <code>$PATH</code></h4><p>To be able to interact with the database servers, we will need to be able to run the binary exectuables from the terminal. For this, add the binary path to the system's <code>$PATH</code> variable</p><ol><li>Search Windows for the Edit System Environment Variables dialog by pressing Windows key and typing \"environment variables\". Select the result, and a System Properties dialog should appear.</li></ol><p>[env-vars-windows.png]</p><ol start=\"2\"><li>Click \"Environment Variables…\" at the bottom of the dialog.</li><li>The Environment Variables window is split top and bottom as \"User variables\" and \"System variables\". Within \"System variables,\" double-click the row for the variable name \"Path\".</li></ol><p>[3_env-vars.png]</p><ol start=\"4\"><li>Within the Edit environment varibale window that appearch, click the New button, and paste the binary path for PostgreSQL.</li><li>Click OK on each of the windows opened for this process.</li><li>The PostgreSQL executables have been added to the <code>$PATH</code>. To test this, start a new terminal instance and <code>psql</code> to see the output of the command.</li></ol><h4 id=\"addthebinarypathtopgadmin\">Add the binary path to pgAdmin</h4><p>The EDB Installation wizard installs the pgAdmin program, a graphical interface for PostgreSQL. This is can be an alternative interface to access database servers, databases, tables, and other</p><ul><li>Login to pgAdmin as the default user, <code>postgres</code>, using the password set within the installation wizard.</li><li>Open Preferences dialog, and add the binary path to the version of Postgres you have installed. The location for this is found at File &gt; Preferences &gt; Paths &gt; Binary Paths &gt; PostgreSQL Binary Path &gt; [YOUR_VERSION].</li></ul><p>[pgadmin<em>binary</em>paths.png]</p><h3 id=\"3startthedatabase\">3. Start the Database</h3><ol><li>Start a database serverThe <code>pg_ctl</code> command is used to manage Postgres database servers. Start and stop a database server by specifying the data directory, and supplying the <code>start</code> or <code>stop</code> subcommand, respectively. The data directory was set in the installation wizard. It defaults to <code>&lt;postgresql_installation_directory&gt;\\data\\</code>.</li></ol><div class=\"filename\">command line</div><pre><code>&gt; pg_ctl restart -D C:\\Program Files\\PostgreSQL\\14\\data\\&gt; pg_ctl stop -D C:\\Program Files\\PostgreSQL\\14\\data\\&gt; pg_ctl start -D C:\\Program Files\\PostgreSQL\\14\\data\\</code></pre><h3 id=\"4createanondefaultuser\">4. Create a non-default user</h3><p>The <code>createuser</code> command is used to create PostgreSQL users. Note that this is a separate list of users than the Windows login users. For example, it is common to create a separate user per software application with database access.</p><div class=\"filename\">command line</div><pre><code>&gt; createuser --superuser --pwprompt --username=postgres $Env:Username</code></pre><p>This command:</p><ul><li>creates a user</li><li>with superuser privileges</li><li>prompts for the user's password after creation</li><li>connects to the database server as the <code>postgres</code> user</li><li>sets the user's name to <code>$Env:Username</code>, an environment variable within Windows Terminal</li></ul><h3 id=\"5createanondefaultdatabase\">5. Create a non-default database</h3><p>The <code>createdb</code> command is used to create PostgreSQL databases. The database server serves a \"database cluster.\" A database cluster collection of databases that is managed by a single instance of a running database server. In file system terms, it is a single directory in which all data will be stored (i.e. Postgres' <code>/data</code> directory.)</p><p>The PostgreSQL installer created a default database named <code>postgres</code>. It is convention for each software program to have its own, uniquely-named database. For practice and utility with the <code>psql</code> command in upcoming sections, create a new database named after your Windows user.</p><div class=\"filename\">command line</div><pre><code>&gt; createdb $Env:Username --username=$Env:Username</code></pre><p>This command:</p><ul><li>creates a database</li><li>named after the logged in user</li><li>using the PostgreSQL user named after the logged in user</li></ul><h3 id=\"6testtheinstallation\">6. Test the Installation</h3><p>If all has gone well, you have the PostgreSQL command-line tools, a running database server, and a user and database within that server. Test all of these by issuing the <code>psql</code> command from the command line. This command defaults to connecting with a username of the currently logged in user, and connecting to a database with the same name as the logged in user. This simple command will test all three aspects of installation.</p><div class=\"filename\">command line</div><pre><code>&gt; psql</code></pre><h3 id=\"references\">References</h3><p>Managing Postgres users and privileges: <a href=\"https://kb.objectrocket.com/postgresql/how-to-list-users-in-postgresql-782\">https://kb.objectrocket.com/postgresql/how-to-list-users-in-postgresql-782</a></p><p>PostgreSQL Security Best Practices: <a href=\"https://resources.2ndquadrant.com/hubfs/Whitepaper%20PDFs/PostgreSQL_Security_Best_Practices_Whitepaper.pdf\">https://resources.2ndquadrant.com/hubfs/Whitepaper PDFs/PostgreSQL<em>Security</em>Best<em>Practices</em>Whitepaper.pdf</a></p><p>How to start PostgreSQL on Windows: <a href=\"https://stackoverflow.com/questions/36629963/how-can-i-start-postgresql-on-windows\">https://stackoverflow.com/questions/36629963/how-can-i-start-postgresql-on-windows</a></p>",
    "sectionType": "section",
    "sequence": 1,
    "parentSection": {
      "parentSectionPart": 2,
      "parentSectionType": "chapter",
      "parentSectionSequence": 6
    }
  },
  {
    "title": "Install Postgres Mac",
    "slug": "install-postgres-mac",
    "content": "<h2 id=\"installpostgresqlonmacwithhomebrew\">Install PostgreSQL on Mac with Homebrew</h2><p>Homebrew is a popular package manager for MacOS. A package manager provides the ability to quickly install packages, their dependency packages, and keep the packages up to date. \"Packages\" are software libraries and executables generally runnable from a command-line interface.</p><ol><li>Install HomebrewWhile we will use Homebrew to install PostgreSQL and its dependencies, we first need to install the Homebrew package itself. If you do not already have Homebrew installed, run the following from a MacOS terminal:</li></ol><div class=\"filename\">command line</div><pre><code class=\"bash language-bash\">$ /usr/bin/ruby -e \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\"</code></pre><ol start=\"2\"><li>Install PostgreSQL</li></ol><div class=\"filename\">command line</div><pre><code class=\"bash language-bash\">$ brew update$ brew install postgresql$ postgres --v</code></pre><ol start=\"3\"><li>Create a database clusterA database storage area on disk must be initialized before. A database cluster is a collection of databases that is managed by a single instance of a running database server. In file system terms, it is a single directory in which all data will be stored. There is no default location for this to be stored; we will set the location to be <code>/usr/local/var/postgres</code>:</li></ol><div class=\"filename\">command line</div><pre><code class=\"bash language-bash\">$ initdb /usr/local/var/postgres</code></pre><p>You may see the error message: <code>initdb: directory \"/usr/local/var/postgres\" exists but is not empty</code>. It means the folder you are attempting to create already exists. You are safe to move on to the next step.</p><ol start=\"4\"><li>Start the database serverUse the command <a href=\"https://www.postgresql.org/docs/current/app-pg-ctl.html\"><code>pg_ctl</code></a> to control PostgreSQL database servers. The parameter to the <code>-D</code> flag indicates the data directory. Use the data directory created in the previous step via <code>initdb</code>.</li></ol><div class=\"filename\">command line</div><pre><code class=\"bash language-bash\">$ pg_ctl -D /usr/local/var/postgres start</code></pre><p>This will log the initialization processes, output <code>server started</code>, and return function of the CLI to the user. This command started the database process in the background. To stop the database process, run</p><div class=\"filename\">command line</div><pre><code class=\"bash language-bash\">$ pg_ctl -D /usr/local/var/postgres stop</code></pre><ol start=\"5\"><li>Create a databaseWithin the database cluster, the <code>initdb</code> command created a database named <code>postgres</code>. Make an additional database named by your MacOS username with the following command:</li></ol><div class=\"filename\">command line</div><pre><code class=\"bash language-bash\">$ createdb $USER</code></pre><h3 id=\"references\">References</h3><p>Managing Postgres users and privileges: <a href=\"https://kb.objectrocket.com/postgresql/how-to-list-users-in-postgresql-782\">https://kb.objectrocket.com/postgresql/how-to-list-users-in-postgresql-782</a></p><p>PostgreSQL Security Best Practices: <a href=\"https://resources.2ndquadrant.com/hubfs/Whitepaper%20PDFs/PostgreSQL_Security_Best_Practices_Whitepaper.pdf\">https://resources.2ndquadrant.com/hubfs/Whitepaper PDFs/PostgreSQL<em>Security</em>Best<em>Practices</em>Whitepaper.pdf</a></p>",
    "sectionType": "section",
    "sequence": 2,
    "parentSection": {
      "parentSectionPart": 2,
      "parentSectionType": "chapter",
      "parentSectionSequence": 6
    }
  },
  {
    "title": "Using Psql",
    "slug": "using-psql",
    "content": "<h2 id=\"usingpsql\">Using <code>psql</code></h2><p>The command <code>psql</code> allows the developer to enter into a PostgreSQL command line environment for executing SQL and other tasks involving the data in the database. Despite, the examples in this section using the <code>$</code> bash shell prompt, these commands work on Windows as well as Unix-based systems.</p><p>To enter into the postgres shell, use the command <code>psql</code> and indicate the database. If <code>psql</code> is used with no arguments, a database of the current user's name is assumed.</p><div class=\"filename\">command line</div><pre><code>$ psql postgres</code></pre><p>In this mode, the command line is prefixed by <code>[DATABASE NAME]=#</code>. To see this in action, type <code>exit</code> to exit the process for the <code>postgres</code> database, and enter into a session with the database named by your username by using <code>psql</code> with no arguments.</p><div class=\"filename\">command line</div><pre><code>postgres=# exit$ psql # Run this command with no arguments# List databasespopdemtech=# \\l# List userspopdemtech=# \\du</code></pre><p>See the Reference of this section for more utilities available within the <code>psql</code> environment.</p><ol start=\"7\"><li>Get database connection infoAs part of the NodeJS walkthrough, we will be creating application databases, tables, and queries within the NodeJS application using a JavaScript library specfically for interfacing with the PostgreSQL server.</li></ol><p>Like a web server, the PostgreSQL server is accessed via TCP -- that is to say, the web application opens a connection to the database server, requests for data, and receives a response. To successfully connect to the data server, and retrieve data, the web application needs to have record of:</p><ul><li>The database server host location</li><li>The specific database's name</li><li>The user attempting access, and</li><li>The user's password</li></ul><p>The host for local development is <code>localhost</code>. The database name, user name, and password are known by the developer.</p><p>To see connection information, enter the <code>psql</code> interface and use the <code>\\conninfo</code> command. It will output the database, user, and port of the active <code>psql</code> session.</p><div class=\"filename\">command line</div><pre><code>$ psql databasenamedatabasename=# \\conninfoYou are connected to database \"databasename\" as user \"popdemtech\" via socket in \"/tmp\" at port \"5432\".</code></pre><p>A separate database is recommended per web application, and, although user and password can be shared between applications, there are benefits to using unique users and passwords per application as well. This can be called the \"Principle of Least Privilege,\" and revolves around database security.</p><p>Most high-level languages (e.g. JavaScript) come with wrapper libraries that handle Postgres database creation. It will likely be necessary to create the <code>user</code> and <code>password</code> using <code>psql</code> or similar utilities.</p><p>See the References for further on PostgreSQL user management and security.</p><h3 id=\"references\">References</h3><p>PSQL utilities: <a href=\"https://www.postgresguide.com/utilities/psql/\">https://www.postgresguide.com/utilities/psql/</a></p>",
    "sectionType": "section",
    "sequence": 3,
    "parentSection": {
      "parentSectionPart": 2,
      "parentSectionType": "chapter",
      "parentSectionSequence": 6
    }
  },
  {
    "title": "Postgres In Node",
    "slug": "postgres-in-node",
    "content": "<h2 id=\"settinguppostgresqlinannodejsapplication\">Setting up PostgreSQL in an NodeJS Application</h2><p>PostgreSQL is a separate server than the NodeJS web server. It provides a TCP interface to access and modify data in the database. The NodeJS application must be configured to connect to a PostgreSQL database server.</p><p>Once the connection with PostgreSQL is configured, we will introduce a JavaScript library, Sequalize, to provide a developer-friendly interface for the data models and queries.</p><h3 id=\"1installsequelizeandpostgreslibraries\">1. Install Sequelize and Postgres Libraries</h3><p>Use the package manager to add the sequeilze and postgres client libraries.</p><div class=\"filename\">command line</div><pre><code>$ npm install --save sequelize sequelize-cli pg pg-hstore </code></pre><p><code>sequelize</code> and <code>sequelize-cli</code> are the developer interface, and contain the functions and classes we will be using primarily. <code>pg</code> and <code>pg-hstore</code> are lower-level client drivers between Node and Postgres. These libraries are required for runtime in production, so use the <code>--save</code> flag to add them as dependencies in <code>package.json</code>.</p><h3 id=\"2initializesequelize\">2. Initialize Sequelize</h3><ol><li>Create a file in the root of the project named <code>.sequelizerc</code> with the following contents:</li></ol><div class=\"filename\">.sequelizerc</div><pre><code class=\"javascript language-javascript\">const path = require('path');module.exports = {  'config': path.resolve('config', 'sequelize.js'),  'models-path': path.resolve('models'),  'migrations-path': path.resolve('db', 'migrations'),  'seeders-path': path.resolve('db', 'seeds'),};</code></pre><ol start=\"2\"><li>Run the <code>sequelize-cli init</code> command for the library to add the required boilerplate.</li></ol><div class=\"filename\">command line</div><pre><code>$ npx sequelize-cli init</code></pre><p>Based on the configuration within <code>.sequelizerc</code>, the command creates following folders:</p><ul><li>config/sequelize.js -- the Sequelize config file which tells CLI how to connect with database</li><li>models -- the directory for the data models for your project</li><li>db/migrations -- the directory for the database migration files</li><li>db/seeds -- the directory for the database seed files</li></ul><h3 id=\"3configuredatabasecredentials\">3. Configure database credentials</h3><p>For the Node.js application to connect to the Postgres server, it must be configured with the a) server's address, b) user name, and c) user password. The file <code>./config/sequelize.js</code>, contains the database connection configuration for three environments -- <code>development</code>, <code>test</code>, and <code>production</code>. set the username, password, database, and dialect.</p><p>Change the username and password for the <code>development</code> connection to credentials of your Postgres user. Change the database to the name of the database your application should use. Sequelize will create the database if one by the name specified does not already exist. Change the dialect to <code>postgres</code>. </p><p>The <code>test</code> and <code>production</code> configurations will need to be corrected before running database transactions in those environment.</p><div class=\"filename\">config/sequelize.js</div><pre><code>module.exports = {  \"development\": {    \"username\": \"root\",        // Change this    \"password\": null,          // Change this    \"database\": \"my-service\",  // Change this    \"host\": \"127.0.0.1\",    \"dialect\": \"postgres\"      // Change this  },  ...}</code></pre><p>As shown in the code example, export the configuration object using <code>module.exports =</code> at the beginning of the file.</p><h3 id=\"4createthedatabase\">4. Create the database</h3><p>Create the application's database.</p><div class=\"filename\">command line</div><pre><code>$ npx sequelize db:create</code></pre><h3 id=\"resources\">Resources</h3><p><code>sequlize-cli</code> documentation: <a href=\"https://github.com/sequelize/cli\">https://github.com/sequelize/cli</a></p><p>What is an ORM?: <a href=\"https://stackoverflow.com/a/1279678/18752242\">https://stackoverflow.com/a/1279678/18752242</a></p>",
    "sectionType": "section",
    "sequence": 4,
    "parentSection": {
      "parentSectionPart": 2,
      "parentSectionType": "chapter",
      "parentSectionSequence": 6
    }
  },
  {
    "title": "Using Sequelize",
    "slug": "using-sequelize",
    "content": "<h2 id=\"usingsequelizeinanodejsapplication\">Using Sequelize in a Node.js Application</h2><p>Sequelize is an ORM -- an Object Relational Mapping library. The benefit of an ORM is that it abstracts SQL query dialect into application language. It also converts the response of any query into application level data types such as arrays or custom objects. Sequelize and many other ORM libraries call these custom objects \"models.\" </p><p>A database table is a collection of objects with specified data attributes. Viewed as a table, there is a row for each specific object and columns for attributes an object can have. A ficticious \"posts\" that contains a collection of resources with the attributes of title, content, and created_at.</p><pre><code>postgres=# select * from posts;id | title               | content                         | publishDate ---+---------------------+---------------------------------+------------------------1  | My First Post       | Hello World!                    |  2022-04-03 12:00:00-062  | How to JavaScript   | Objects and functions.          |  2022-04-04 12:00:00-063  | SOLID Breakfast     | The principles of SOLID design. |  2022-04-05 12:00:00-06(3 rows)</code></pre><p>In an ORM, this structure is made accessible in the programming language, such as JavaScript's class objects. These models are an abstraction that represents a table in the database.</p><p>We can use <code>sequelize-cli</code> to generate both the database tables and JavaScript classes. </p><h3 id=\"1generateapostsmigrationandjsclassesusingthemodelgeneratecommand\">1. Generate a <code>posts</code> migration and JS classes using the <code>model:generate</code> command.</h3><div class=\"filename\">command line</div><pre><code>$ npx sequelize model:generate --name Post --attributes title:string,content:text,publishDate:date</code></pre><p>This creates two files</p><ul><li>models/post.js</li><li>db/migrations/[timestamp]-create-post.js</li></ul><h3 id=\"2runthemigration\">2. Run the migration.</h3><p>Migration files are used to keep track of changes made to a database. Migrations are used to track creating tables, adding and removing columns to existing tables, and other operations. Migration files record how to transition the database to a new state, and how to rollback the changes to get back to the older state.</p><p>Database migration files are like a version control system for the application database, and provide replayable changes that keep the variety of development databases, test databases, and production databases in sync.</p><p>Looking at the migration file generated by <code>model:generate</code>, we can see that Sequelize added two attributes <code>createdAt</code> and <code>updatedAt</code>. This is convention, and the values will be set and kept up to date by the Sequelize engine.</p><p>Run the migration command to create the <code>posts</code> table in the database.</p><div class=\"filename\">command line</div><pre><code>$ npx sequelize db:migrate</code></pre><p>This command executes the following steps:</p><ul><li>Ensures a table called SequelizeMeta is in database. This table is used to record which migrations have run on the database.</li><li>Runs any migration files which haven't run yet. This is possible by checking SequelizeMeta table.</li></ul><p>In this case, the <code>create-post</code> migration file will be executed against the database resulting in a new <code>posts</code> table being created.</p><h3 id=\"3seedthedatabase\">3. Seed the database</h3><p>To \"seed\" the database is to programmatically insert values into the database -- no user interaction required. This is useful for transferring a known data set into the database or populating tables with dummy data for development.</p><ol><li>Track development seeds within database.Unlike migrations, database seeding events are not stored anywhere by default. This means every time the <code>db:seed:all</code> command is run, the database will be re-seeded with previously run seeds. To change from the default behavior, add the configuration <code>\"seederStorage\": \"sequelize\"</code> to the development object of <code>config/sequelize.js</code>.</li></ol><p>This will save to the database which seeds have been run, allowing for use of the developer friendly <code>db:seed:all</code>.</p><div class=\"filename\">config/sequelize.js</div><pre><code>module.exports = {  \"development\": {    ...,    \"seederStorage\": \"sequelize\"  },  ...}</code></pre><ol start=\"2\"><li>Generate a new seed fileUse the <code>seed:generate</code> command provided by <code>sequelize-cli</code> to generate a seed file for the Post model.</li></ol><div class=\"filename\">command line</div><pre><code>$ npx sequelize seed:generate --name first-posts</code></pre><p>This command creates a file, <code>db/seeds/[timestamp]-first-posts.js</code>. Like a migration, the seed file implements an <code>up/down</code> interface. The <code>up</code> command specifies what actions should be performed to seed the database. The <code>down</code> function should specify how to undo the actions.</p><ol start=\"3\"><li>Define a few post objects in an array:</li></ol><div class=\"filename\">db/seeds/[timestamp]-first-posts.js</div><pre><code class=\"javascript language-javascript\">const posts = [{  title: 'Hello World',  content: 'This is the first post!',  publishDate: new Date('2022-01-01'),  createdAt: new Date(),  updatedAt: new Date()}, {  title: 'Lorem Ipsum',  content: `    Lorem Ipsum is simply dummy text of the printing and typesetting industry.    Lorem Ipsum has been the industry's standard dummy text ever since the 1500s,    when an unknown printer took a galley of type and scrambled it to make a type specimen book.    Contrary to popular belief, Lorem Ipsum is not simply random text.    It has roots in a piece of Latin literature from 45 BC.  `,  publishDate: new Date('2022-01-02'),  createdAt: new Date(),  updatedAt: new Date()}];</code></pre><ol start=\"4\"><li>Define the <code>up</code> and <code>down</code> methodsIn the <code>up</code> method, use the provided <code>queryInterface</code> class to bulk insert the posts into the database.</li></ol><div class=\"filename\">db/seeds/[timestamp]-first-posts.js</div><pre><code class=\"javascript language-javascript\">async up (queryInterface, Sequelize) {  await queryInterface.bulkInsert('Posts', posts, {});},</code></pre><p>In the <code>down</code> method, perform the reverse action of the <code>up</code> method by deleting the posts. To use Sequelize's <code>Op</code> (short for \"operation\") library, import it at the top of the file.</p><div class=\"filename\">db/seeds/[timestamp]-first-posts.js</div><pre><code class=\"javascript language-javascript\">const { Op } = require(\"sequelize\");const posts = [...];module.exports = {  async up (queryInterface, Sequelize) { ... },  async down (queryInterface, Sequelize) {     await queryInterface.bulkDelete('Posts', {      title: {        [Op.in]: posts.map((post) =&gt; post.title)      }     }, {});  }}</code></pre><p>This <code>bulkDelete</code> query generates the following SQL:</p><pre><code>DELETE FROM \"Posts\" WHERE posts.title IN [\"Hello World\", \"Lorem Ipsum\"];</code></pre><ol start=\"3\"><li>Seed the database</li></ol><div class=\"filename\">command line</div><pre><code>$ npx sequelize-cli db:seed:all</code></pre><p>This command inserts the records into the database.</p><h3 id=\"4displaydatabaserecords\">4. Display database records</h3><p>The purpose of a database is to keep data organized. The purpose of keeping the data around is for human end-users to view and manipulate. To get the data viewable by the user, we will provide a webpage that lists the data. As part of handling the webpage request, we will query the database for the records, and supply the records as template variables.</p><ol><li>Create the route.Create a route <code>/posts</code> in <code>index.js</code>.</li></ol><div class=\"filename\">index.js</div><pre><code class=\"javascript language-javascript\">app.get('/posts', (request, response) =&gt; {  response.render('posts', {    posts: []  });});</code></pre><ol start=\"2\"><li>Create the templateCreate a new file, <code>app/views/posts.liquid</code> with the following code:</li></ol><div class=\"filename\">views/posts.liquid</div><pre><code class=\"html language-html\">{% layout 'layouts/default-html.liquid' %}{% block content %}&lt;div&gt;  &lt;h1&gt;Posts&lt;/h1&gt;  {% for post in posts %}    &lt;h2&gt;{{ post.title }}&lt;/h2&gt;    &lt;p&gt;&lt;i&gt;{{ post['publishDate'] }}&lt;/i&gt;&lt;/p&gt;    &lt;p&gt;{{ post['content'] }}&lt;/p&gt;  {% else %}    &lt;p&gt;&lt;i&gt;There are no posts to display.&lt;/i&gt;&lt;/p&gt;  {% endfor %}&lt;/div&gt;{% endblock %}</code></pre><p>Navigate to <code>localhost:3000/posts</code>. Because the <code>posts</code> template variable is hard-coded to be an empty array, you should see a page that says \"There are no posts to display.\"</p><ol start=\"3\"><li>Query the database for postsSequelize as an ORM provides JavaScript classes as abstraction over the SQL query language. The <code>Post</code> class found in <code>models/post.js</code> is such a class. We will import the class into <code>index.js</code> and use the <code>.findAll()</code> method to populate the <code>posts</code> template variable.</li></ol><div class=\"filename\">index.js</div><pre><code class=\"javascript language-javascript\">const { Post } = require('./models');app.get('/posts', async function(request, response) {  response.render('posts', {    posts: await Post.findAll()  });});</code></pre><p>With the addition of the asynchronous method <code>Post.findAll()</code>, we must also label the route handling function as <code>async</code>. Notice the addtion of the keyword <code>async</code> before the function defintion.</p><p>Place the require statement at near the top of the file with the other <code>require</code> statements. Place the route near the other routes definitions.</p><p>Refreshing the <code>/posts</code> web page now shows the two posts seeded in the database.</p><ol start=\"4\"><li>Add a link to Posts on the homepage.Show off the database! Add a navigation link to the <code>views/index.liquid</code>.</li></ol><div class=\"filename\">index.liquid</div><pre><code class=\"html language-html\">&lt;li&gt;&lt;a href=\"/posts\"&gt;Posts&lt;/a&gt;&lt;/li&gt;</code></pre><h3 id=\"resources\">Resources</h3><p>Sequelize model basics: <a href=\"https://sequelize.org/docs/v6/core-concepts/model-basics\">https://sequelize.org/docs/v6/core-concepts/model-basics</a></p><p>Sequelize Seeds: <a href=\"https://sequelize.org/docs/v6/other-topics/migrations/#creating-the-first-seed\">https://sequelize.org/docs/v6/other-topics/migrations</a></p><p>Sequelize Query Interface: <a href=\"https://sequelize.org/docs/v6/other-topics/query-interface/\">https://sequelize.org/docs/v6/other-topics/query-interface/</a></p><p>Sequelize <code>QueryInterface</code> API : <a href=\"https://sequelize.org/api/v6/class/src/dialects/abstract/query-interface.js~queryinterface\">https://sequelize.org/api/v6/class/src/dialects/abstract/query-interface.js</a></p>",
    "sectionType": "section",
    "sequence": 5,
    "parentSection": {
      "parentSectionPart": 2,
      "parentSectionType": "chapter",
      "parentSectionSequence": 6
    }
  },
  {
    "title": "Deployed Database",
    "slug": "deployed-database",
    "content": "<h2 id=\"databaseinthedeployedenvironment\">Database in the Deployed Environment</h2><p>Each environment -- development, test, production, etc -- will likely use a different PostgreSQL database server. This means the Node.js application will need to be configured with a database URL and user credentials at a per environment specification. Sequelize's <code>config</code> file provides the location to specify these differences.</p><p>The platform we will be using to host the PostgreSQL server is Heroku Postgres, an add-on provided by Heroku. There is a free tier with paid plans available to increase data capacity and concurrency as the application storage and/or traffic grows. Heroku Postgres configures the server URL and user credentials, and provides these values via an environment variable, <code>DATABASE_URL</code>.</p><h3 id=\"1addtheherokupostgresaddon\">1. Add the Heroku Postgres add-on</h3><ol><li>From the command-line interface, use the <code>heroku addons:create</code> command to add the Heoku Postgres add-on, hobby-dev tier.</li></ol><div class=\"filename\">command line</div><pre><code>$ heroku addons:create heroku-postgresql:hobby-dev</code></pre><ol start=\"2\"><li>Use the <code>DATABASE_URL</code> environment variable in productionWithin the <code>config/sequelize.js</code> <strong>production</strong> object, set the keys <code>use_environment_variable</code> and <code>ssl.rejectUnauthorized</code>. Remove the unneeded piecewise credentials; <code>DATABASE_URL</code> contains user and database location information. The following code snippet includes the full <code>production</code> object.</li></ol><div class=\"filename\">config/sequelize.js</div><pre><code>\"production\": {  \"use_env_variable\": \"DATABASE_URL\",  \"dialect\": \"postgres\",  \"dialectOptions\": {    \"ssl\": {      \"rejectUnauthorized\": false    }  }}</code></pre><ol start=\"3\"><li>Ensure the NODE_ENV environment variable is set on Heroku server.</li></ol><div class=\"filename\">command line</div><pre><code>$ heroku config:set NODE_ENV=production</code></pre><h3 id=\"2runtheapplication\">2. Run the application</h3><ol><li>Commit and push the new changes to Heroku</li></ol><div class=\"filename\">command line</div><pre><code>$ git add .$ git commit -m 'Use Heroku Postgres'$ git push heroku HEAD</code></pre><ol start=\"2\"><li>Run the database migration on HerokuUse the <code>heroku run</code> command to execute the Sequelize CLI commands in Heroku's server environment.</li></ol><div class=\"filename\">command line</div><pre><code>$ heroku run npx sequelize db:migrate --env production</code></pre><ol start=\"3\"><li>Seed the database</li></ol><div class=\"filename\">command line</div><pre><code>$ heroku run npx sequelize db:seed:all</code></pre><ol start=\"4\"><li>View the appIssue the command <code>heroku open</code> to open the deployed application. Navigate to the <code>/posts</code> route to see the seeded posts.</li></ol><div class=\"filename\">command line</div><pre><code>$ heroku open</code></pre><p>That's a deployed database! This simple tool is the backbone of the internet. Now that we have a database live on the interconnected web, we are able to provide our users with experiences on our web apps that can be customized on a per user basis.</p><p>We will be looking at saving user generated information in upcoming sections.</p><h3 id=\"resources\">Resources</h3><p>Heroku Postgres: <a href=\"https://devcenter.heroku.com/articles/heroku-postgresql\">https://devcenter.heroku.com/articles/heroku-postgresql</a></p><p>Sequelize Heroku Postgres Settings: <a href=\"https://github.com/sequelize/sequelize/issues/956#issuecomment-778149933\">https://github.com/sequelize/sequelize/issues/956</a></p><p>Deploy Sequelize to Heroku: <a href=\"https://anjelicaa.medium.com/deploying-a-node-js-postgres-sequelize-app-to-heroku-da3dc9de07cd\">https://anjelicaa.medium.com</a></p>",
    "sectionType": "section",
    "sequence": 6,
    "parentSection": {
      "parentSectionPart": 2,
      "parentSectionType": "chapter",
      "parentSectionSequence": 6
    }
  },
  {
    "title": "User Interaction Project",
    "slug": "user-interaction-project",
    "content": "<h2 id=\"capturinguserinformation\">Capturing User Information</h2><p>The strength of a database comes into play when the developer uses it to capture user interaction within the web application. This saved information can then be displayed to the user to demonstrate the applications interactivity.</p><h3 id=\"clicktrackerapplication\">Click Tracker Application</h3><p>This feature will allow any user to click a button and counter will increment. This counter increments over time as users click the button. If you think about it, users from anywhere on the globe can log into this application, and click this button. Pretty cool.</p><p>This feature will require:</p><ul><li>a button</li><li>text displaying how many times the button has been clicked</li></ul><h3 id=\"1decidethedatamodel\">1. Decide the data model</h3><p>This feature will require that we persist the total number of times a button has been clicked in a database. To accomplish this, we will create a database table, <code>Clicks</code>.</p><pre><code>Clicks-----------+-------------+user       | VARCHARcreatedAt  | DATEupdatedAt  | DATE</code></pre><p>To find how many times the button has been clicked, a SQL <code>COUNT(*)</code> command can be used. This data model has the additional benefit of saving user information with the click event. This will be aided by the authentication system, and allows for a follow-up feature of displaying how many times a particular user has clicked the button.</p><p>Generate a model and migration using Sequelize's <code>model:generate</code> command, and migrate the database with <code>db:migrate</code>.</p><div class=\"filename\">command line</div><pre><code>$ npx sequelize model:generate --name Click --attributes user:string$ npx sequelize db:migrate</code></pre><h3 id=\"2createthewebpageroute\">2. Create the web page route</h3><p>Within <code>index.js</code>, create a route, <code>/click-tracker</code>. This route should render a page <code>click-tracker.liquid</code>.</p><p>The number of times the button has been clicked in total will be saved in a database, and fetched at the initial user request. The liquid-HTML template will be rendered with this number. Hard-code the value to 10 for now.</p><ol><li>Import the <code>Click</code> class from Sequelize's model directory.</li></ol><div class=\"filename\">index.js</div><pre><code class=\"javascript language-javascript\">const { Post, Click } = require('./app/models');</code></pre><ol start=\"2\"><li>Create the route.The route handler must be labeled async to be able to use the asynchronous <code>await Click.count()</code>. Send the result of <code>Click.count()</code> to the view as the template variable <code>timesClicked</code>.</li></ol><div class=\"filename\">index.js</div><pre><code class=\"javascript language-javascript\">app.get('/click-tracker', async function (request, response) {  response.render('click-tracker', {    timesClicked: await Click.count()  });});</code></pre><ol start=\"3\"><li>Create the webpage.A view template named <code>click-tracker.liquid</code> must be created.</li></ol><div class=\"filename\">views/click-tracker.liquid</div><pre><code class=\"html language-html\">{% layout 'layouts/default-html.liquid' %}{% block content %}&lt;h1&gt;Click Tracker&lt;/h1&gt;&lt;button id=\"click-me\"&gt;Click Me!&lt;/button&gt;&lt;p&gt;This button has been clicked &lt;span id=\"times-clicked\"&gt;{{ timesClicked }}&lt;/span&gt; times.&lt;/p&gt;{% endblock %}</code></pre><p>You should now be able to start the server, navigate to <code>https://localhost:3000/click-tracker</code>, and see the desired initial page.</p><h3 id=\"3handleuserinteraction\">3. Handle user interaction</h3><p>At this point, nothing happens if a user clicks the on-screen button. Let's change this by adding a JavaScript click event listener on the button. Add a <code>&lt;script&gt;</code> tag within the <code>content</code> block.</p><div class=\"filename\">views/click-tracker.liquid</div><pre><code class=\"html language-html\">&lt;script&gt;  const button = document.getElementById('click-me');  button.addEventListener('click', function(event) {    console.log('Button clicked!');  });&lt;/script&gt;</code></pre><h3 id=\"4makeapirequestonclick\">4. Make API request on click</h3><p>For the moment, the click handling function only prints out <code>'Button clicked!'</code>. The desired functionality is for the button click to initiate a request to the webserver. The webserver will receive the request and add a <code>Click</code> database record.</p><p>From the front-end, we will use the Fetch API to make and handle the network request. The Fetch API provides a JavaScript interface for fetching resources and interacting with the HTTP pipeline. Within a browser (e.g. Chrome), a global  <code>fetch()</code> method provides an easy-to-use way to fetch resources asynchronously across the network.</p><p>The <code>fetch()</code> method returns a Promise. A JavaScript Pro</p><p>Replace the <code>console.log</code> within the click handler with a <code>fetch</code> call.</p><div class=\"filename\">views/click-tracker.liquid</div><pre><code class=\"html language-html\">&lt;script&gt;  const button = document.getElementById('click-me');  button.addEventListener('click', function(event) {    fetch('/api/clicks', { method: 'POST' })    .then((response) =&gt; {      response.ok ? console.log('Click Added') : console.log('Error Occured');    });  });&lt;/script&gt;</code></pre><p>The <code>response.ok</code> is a utility property on the <code>Response</code> object returned by <code>fetch</code>. A response with an HTTP status code 200-299 has and <code>ok</code> value of <code>true</code>.</p><h3 id=\"5createtheapiroute\">5. Create the API route</h3><p>In line with RESTful standards, we will make a route that accepts a <code>POST</code> request to <code>/clicks</code> to create a click resource. The the <code>POST</code> request is successful, we will return to the user the new total number of clicks in the database.</p><ol><li>Create the POST <code>/clicks</code> route</li></ol><div class=\"filename\">indes.js</div><pre><code class=\"javascript language-javascript\">app.post('/api/clicks', async function(request, response) {  const user = request.oidc.user ? request.oidc.user.email : null;  await Click.create({ user: user });  response.json({ timesClicked: await Click.count() });});</code></pre><h3 id=\"6handleanerrorusingexpressmiddleware\">6. Handle an error using Express middleware</h3><p>Due to validations and user input errors, creating database records is a process that is expectedly error prone. Click Tracker deals with a relatively small model with no truly custom user input, yet it is good practice to handle where known errors may arise and deliver useful information to the front-end application and user.</p><p>The Express way to handle errors is to use its middleware framework. We have already used Express' middleware in implementing the <code>auth()</code> functionality. The middleware framework is a pipeline of functions that have access to the <code>request</code> and <code>response</code> objects. A given middleware can execute any code and make changes to the <code>request</code> and <code>response</code> objects. When it is done with its computation, it must end the request/response cycle or call the <code>next</code> middleware function in the pipeline.</p><p>In this way, every route that is defined -- e.g. <code>GET /hello-world</code> -- is part of the middleware pipeline. The routes created thus far end the request/response cycle by not calling a <code>next</code> middleware. In fact, because <code>next</code> has not been needed, I have left this variable out of the route handler definitions. An Express route handler has the following signature:</p><div class=\"filename\">pseudocode</div><pre><code class=\"javascript language-javascript\">const routeHandler = function(request, response, next) { ... };app.get('/path', routeHandler);</code></pre><p>A middleware handler has the similar signature:</p><div class=\"filename\">pseudocode</div><pre><code class=\"javascript language-javascript\">const middleware = function(request, response, next) { ... };app.use(middlewareHandler);</code></pre><p>Error handling middleware has a slightly differing signature; the first parameter is a JavaScript error object.</p><div class=\"filename\">pseudocode</div><pre><code class=\"javascript language-javascript\">const errorHandlingMiddleware = function(error, request, response, next) { ... };app.use(errorHandlingMiddleware);</code></pre><p>The application knows to use the error handling middleware if <code>next</code> is invoked with an error object.</p><ol><li>Create the error handling middleware.As will all middleware, Express will invoke the functions in the order they are applied to the application with <code>app.use()</code>, top to bottom. As such, <code>app.use</code> this middleware below the route definitions within <code>index.js</code>.</li></ol><div class=\"filename\">index.js</div><pre><code class=\"javascript language-javascript\">app.use(function (error, request, response, next) {  if (!error.apiError) {    return next(error, request, response, next);  }  response.status(error.statusCode);  response.json({ message: error.message });});</code></pre><p>This code checks for the existance of the a property <code>apiError</code> on the <code>error</code> parameter. If it is not present, the function passes the error to the next error handling middleware. If the property is present, the status of the response is set to the statusCode of the error, and a JSON response is returned with the error's message.</p><p>An important aspect of this code is that it returns a JSON response. Express' default error handler returns an HTML response. For <code>pd-service</code>, we will standardize this behavior and return JSON in case of error.</p><ol start=\"2\"><li>Invoke the error handler in case of application error.With the error handler is in place, the route handler must be changed to pass any errors to the error handling middleware. The third parameter, <code>next</code>, should be added to the handler's function definition. It has always been passed in at runtime, but because it was unnecessary, it hasn't been added to the code until now.</li></ol><p><code>Click.create</code> will throw an error if the create is unsuccessful. Wrap this function call in a <code>try/catch</code> block. If an error is caught, set the properties on it the custom error handling middleware is expecting -- <code>apiError</code> and <code>statusCode</code> -- and invoke the <code>next</code> middleware the error.</p><div class=\"filename\">index.js</div><pre><code class=\"javascript language-javascript\">app.post('/api/clicks', async function(request, response, next) {  const user = request.oidc.user ? request.oidc.user.email : null;  try {    await Click.create({ user: user });    response.json({ timesClicked: await Click.count() });  } catch (e) {    e.apiError = true;    e.statusCode = 422;    next(e);  }});</code></pre><p>With the last line -- <code>next(e)</code> -- the request/response cycle is moved to the error handling middleware pipeline.</p><h3 id=\"7handletheapiresponse\">7. Handle the API response</h3><p>The sequence of events currently programmed is the following:</p><ul><li>User clicks the button</li><li>A <code>fetch</code> request is made to the <code>/clicks</code> route</li><li>The route processes the request and returns a JSON response</li></ul><p>A response handler must be written within the front-end JavaScript to process the response.</p><p>The <code>fetch</code> call resolves to a <code>Response</code> interface that represents the response to a request. The <code>json()</code> method on this interface returns a promise of the result of parsing the response body into JSON. We'll want to access the <code>timesClicked</code> property we set on the response body.</p><div class=\"filename\">views/click-tracker.liquid</div><pre><code class=\"html language-html\">&lt;script&gt;  const button = document.getElementById('click-me');  button.addEventListener('click', function(event) {    fetch('/api/clicks', { method: 'POST' })    .then((response) =&gt; {      if (!response.ok) return;      response.json()      .then((data) =&gt; {        document.getElementById('times-clicked').innerHTML = data.timesClicked;      });    });  });&lt;/script&gt;</code></pre><p>The script makes use of a preset <code>&lt;span id=\"times-clicked\"&gt;</code>, and replaces the value that present there with the more recent count of clicks.</p><p>You should now be able to click the button multiple times and see the number on screen increment by one each time. If you refresh the page, the number will remain at the last seen value.</p><h3 id=\"8handletheapierrorresponse\">8. Handle the API error response</h3><p>It is good practice to inform the user of an application error. It's wise to consider whether the user can be helped by the error. For example, it's prudent to show the user if the error is due to an input validation error; the user can change their input and correct the problem. If the error is due to an obscure error the user cannot correct, such as invalid database credentials failing authentication, it is more appropriate to show the user a generic error or none at all.</p><p>The case of the Click Tracker application coming into an error state fits into the latter distinction. The plan is to place an error message within the HTML. It will be hidden by default, but when an error response is received, it will be displayed. Whenever a new request is initalized -- when the user re-clicks the button -- the error message will be re-hidden while the new <code>fetch</code> request is sent and allowed to return successfully or not.</p><ol><li>Add the HTML/CSS for error handling.For this, we will need to add the error message element, and set it to be hidden by default. Add the new element after the <code>click-me</code> button. Add the style tags within the <code>content</code> block.</li></ol><div class=\"filename\">views/click-tracker.liquid</div><pre><code class=\"html language-html\">&lt;span id=\"error\" class=\"hidden\"&gt;Oops, something happened.&lt;/span&gt;&lt;style&gt;  .hidden {    display: none;  }  #error {    color: red;  }&lt;/style&gt;</code></pre><ol start=\"2\"><li>Add error handling JavaScriptWhen an error response is encountered, remove the <code>hidden</code> class on the <code>#error</code> element to remove the <code>display: none</code> attribute. In the case of resubmitting the button click, hide the element again by re-adding the <code>hidden</code> class.</li></ol><div class=\"filename\">views/click-tracker.liquid</div><pre><code class=\"html language-html\">&lt;script&gt;  const button = document.getElementById('click-me');  button.addEventListener('click', function(event) {    document.getElementById('error').classList.add('hidden');    fetch('/api/clicks', { method: 'POST' })    .then((response) =&gt; {      if (!response.ok) {        document.getElementById('error').classList.remove('hidden');        return;      };      response.json()      .then((data) =&gt; {        document.getElementById('times-clicked').innerHTML = data.timesClicked;      });    });  });&lt;/script&gt;</code></pre><p>To test the error handling, you can force the API to return an error response.</p><div class=\"filename\">index.js</div><pre><code class=\"javascript language-javascript\">app.post('/api/clicks', async function(request, response, next) {  // const user = request.oidc.user ? request.oidc.user.email : null;  // try {  //   await Click.create({ user: user });  //   response.json({ timesClicked: await Click.count() });  // } catch (e) {  //   e.apiError = true;  //   e.statusCode = 422;  //   next(e);  // }  const e = new Error();  e.apiError = true;  e.statusCode = 500;  next(e);});</code></pre><p>Be sure to revert this intermediate step for the application to function as planned long-term.</p><h3 id=\"9addahomepagelink\">9. Add a homepage link</h3><p>Add the Click Tracker app to the list of pages on the homepage.</p><div class=\"filename\">views/index.liquid</div><pre><code class=\"html language-html\">&lt;li&gt;&lt;a href=\"/click-tracker\"&gt;Click Tracker&lt;/a&gt;&lt;/li&gt;</code></pre><h3 id=\"10commitanddeploy\">10. Commit and deploy</h3><ol><li>Commit the repositoryGit commit the new changes and deploy to Heroku to see the results in a deployed environment.</li></ol><div class=\"filename\">command line</div><pre><code>$ git add .$ git commit -m 'Add Click Tracker'$ git push heroku HEAD</code></pre><ol start=\"2\"><li>Migrate the production databaseThere is now a new table the application expects to be in the database. A database migration must be run on the Heroku Postgres instance to create this table.</li></ol><div class=\"filename\">command line</div><pre><code>$ heroku run sequelize db:migrate</code></pre><ol start=\"3\"><li>Run the deployed application</li></ol><div class=\"filename\">command line</div><pre><code>$ heroku open</code></pre><p>Navigate to <code>/click-tracker</code> directly or via the homepage link, and verify the incrementing Click Tracker.</p><h3 id=\"resources\">Resources</h3><p>What is Web 2.0?: <a href=\"https://www.znetlive.com/blog/web-2-0/\">https://www.znetlive.com/blog/web-2-0/</a></p><p>Using the Fetch API: <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch\">https://developer.mozilla.org/en-US/docs/Web/API/Fetch<em>API/Using</em>Fetch</a></p><p>Express Error Handling: <a href=\"http://expressjs.com/en/guide/error-handling.html\">http://expressjs.com/en/guide/error-handling.html</a></p><p>JavaScript Promises: <a href=\"https://nodejs.dev/learn/understanding-javascript-promises#chaining-promises\">https://nodejs.dev/learn/understanding-javascript-promises</a></p>",
    "sectionType": "chapter",
    "sequence": 7,
    "parentSection": {
      "parentSectionPart": 2,
      "parentSectionType": "part",
      "parentSectionSequence": 2
    }
  },
  {
    "title": "Features",
    "slug": "features",
    "content": "<h2 id=\"readmemd\">README.md</h2><p><strong>Features</strong> is an exploration of the range of applicationscan be built from the tooling of the Basics. Features contains walkthroughsfor extending the functionality of the app.</p><p>Features are standalone front-end or full-stack modules that can be completed in any order.</p>",
    "sectionType": "part",
    "sequence": 3,
    "parentSectionId": null,
    "childSections": [
      {
        "title": "Book Catalog",
        "slug": "Book-Catalog",
        "content": "## Book Catalog\n\nA book catalog will list book, text resources. Each book will have a title, author, description, and blurb for display purposes. Each book will also have a slug which will be used for routing purposes. Each book will be accesible at a route `/books/<book-slug>`, where `book-slug` is dynamic per book.\n\nEach book will be composed of parts. Each part will have futher sub-parts. This resembles the structure of book, part, chapter, chapter section, etc. while allowing the developer (and authors) to add however many nested sub-parts. To accomplish the relation of part to child-part, a parent key will be recorded on the child part. A list of all child parts for a given book part can be found by querying for all resourcess with a parent key matching the primary key of the interested book part.\n\n\n",
        "sectionType": "chapter",
        "sequence": 1,
        "parentSection": {
          "parentSectionPart": 3,
          "parentSectionType": "part",
          "parentSectionSequence": 3
        }
      },
      {
        "title": "Book Resource",
        "slug": "book-resource",
        "content": "## The Book Resource\n\n### 1. Create the Book Data Model\n1. Generate the book model\n```\nnpx sequelize model:generate --name Book --attributes title:string,author:string,description:text,blurb:text,slug:string\n```\n\n2. Seed the database\n```\n npx sequelize seed:generate --name first-book\n ```\n\n ```javascript\nconst { Op } = require(\"sequelize\");\nconst { Book } = require('../../app/models');\n\nconst books = [{\n  title: 'Build a SmartSite',\n  author: 'Popular Demand',\n  description: 'A step-by-step guide to creating a dynamic website using Node.js.',\n  blurb: 'A step-by-step guide to creating a dynamic website using Node.js.',\n  slug: 'build-a-smartsite',\n  createdAt: new Date(),\n  updatedAt: new Date()\n}];\n\nmodule.exports = {\n  async up (queryInterface, Sequelize) {\n     await queryInterface.bulkInsert('Books', books, {});\n  },\n\n  async down (queryInterface, Sequelize) {\n     await queryInterface.bulkDelete('Books', {\n      title: {\n        [Op.eq]: books[0].title\n      }\n     }, {});\n  }\n};\n ```\n\n ```\nnpx sequelize-cli db:seed:all\n ```\n\n### 2. All Books index page\n\n1. Create Books index route\n```\nconst { Post, Click, Book } = require('./app/models');\napp.get('/books', async function(request, response) {\n  const books = await Book.findAll();\n  response.render('books/index', { books });\n});\n```\n\n2. Create Books index view\n```\n{% layout 'layouts/default-html.liquid' %}\n{% block content %}\n<div>\n  <h1>Books</h1>\n\n  {% for book in books %}\n    <h2>{{ book.title }}</h2>\n    <p><i>{{ book.author }}</i></p>\n    <p>{{ book.blurb }}</p>\n  {% else %}\n    <p><i>There are no books to display.</i></p>\n  {% endfor %}\n</div>\n{% endblock %}\n```\n\n```\n<li><a href=\"/books\">Books</a></li>\n```\n\nBooks page is available at `localhost:3000/books`.\n\n### 3. One Book show page\n\n1. Create show route for single Book\n```\napp.get('/books/:slug', async function(request, response, next) {\n  const book = await Book.findOne({ where: { slug: request.params.slug }});\n  if (book == null) {\n    // handling if a book is not found is covered next\n  }\n  response.render('books/show', { book });\n});\n```\n\n2. Create Book show view\n```\n{% layout 'layouts/default-html.liquid' %}\n{% block content %}\n<div>\n  <h1>{{ book.title }}</h1>\n  <p><i>{{ book.author }}</i></p>\n  <p>{{ book.description }}</p>\n</div>\n{% endblock %}\n```\n\n3. Link to the book show page\n```\n<a href=\"/books/{{ book.slug }}\">\n  <span class=\"book-panel\">\n    <h2>{{ book.title }}</h2>\n    <p><i>{{ book.author }}</i></p>\n    <p>{{ book.blurb }}</p>\n  </span>\n</a>\n```\n\n### 4. 404 - Not Found Route\n1. Handle if a book is not found\nSet the response status to `404`, and forward the request to the next middleware.\n```\napp.get('/books/:slug', async function(request, response, next) {\n  const book = await Book.findOne({ where: { slug: request.params.slug }});\n  if (book == null) {\n    response.status(404);\n    next();\n    return;\n  }\n  response.render('books/show', { book });\n});\n```\n\n2. Create a 404 middleware\n```\napp.use(function(request, response, next) {\n  if (response.statusCode === 404) {\n    response.render('404');\n    return;\n  }\n  next();\n});\n```\n\n3. Create a 404 view template\n```\n{% layout 'layouts/default-html.liquid' %}\n{% block content %}\n<div>\n  <h1>Not Found</h1>\n\n  <p>\n    The requested resource was not found.\n  </p>\n</div>\n{% endblock %}\n```\n\n### 5. Add Breadcrumbs\nAdd breadcrumbs to the show page.\n```\n<div class=\"breadcrumbs\">\n  <a href=\"/books\">Books</a> > {{ book.title }}\n</div>\n```",
        "sectionType": "section",
        "sequence": 1,
        "parentSection": {
          "parentSectionPart": 3,
          "parentSectionType": "chapter",
          "parentSectionSequence": 1
        }
      },
      {
        "title": "Book Part Resource",
        "slug": "book-part-resource",
        "content": "## The Book Divison Resource\n\nBookPart\n- title\n- slug\n- content\n- sectionType\n- sequence\n- parent_part\n- book\n\n### 1. Create the Data Model\n\n1. Generate model\n```\nnpx sequelize model:generate --name BookSection --attributes title:string,slug:string,content:text,sectionType:string,sequence:integer,bookId:integer\n```\n\n2. Customize generated files\nCustomize the generated model and migration files to refect the Book to Book Section one-to-many relatonship.\nmodel file:\n\n```\nconst {\n  Model\n} = require('sequelize');\n\nmodule.exports = (sequelize, DataTypes) => {\n  class BookSection extends Model {\n    static associate(models) {\n      BookSection.belongsTo(models.Book, { foreignKey: 'bookId' });\n    }\n  }\n\n  BookSection.init({\n    title: DataTypes.STRING,\n    slug: DataTypes.STRING,\n    content: DataTypes.TEXT,\n    sectionType: DataTypes.STRING,\n    sequence: DataTypes.INTEGER,\n    bookId: {\n      type: DataTypes.INTEGER,\n      references: {\n        model: 'Books',\n        key: 'id'\n      }\n    },\n    parentSectionId: {\n      type: DataTypes.INTEGER,\n      references: {\n        model: 'BookSections',\n        key: 'id'\n      }\n    }\n  }, {\n    sequelize,\n    modelName: 'BookSection',\n  });\n\n  return BookSection;\n};\n```\n\nmigration, changes to slug and bookId:\n```\nmodule.exports = {\n  async up(queryInterface, Sequelize) {\n    await queryInterface.createTable('BookSections', {\n      id: {\n        allowNull: false,\n        autoIncrement: true,\n        primaryKey: true,\n        type: Sequelize.INTEGER\n      },\n      title: {\n        type: Sequelize.STRING\n      },\n      slug: {\n        type: Sequelize.STRING,\n        allowNull: false\n      },\n      content: {\n        type: Sequelize.TEXT\n      },\n      sectionType: {\n        type: Sequelize.STRING\n      },\n      sequence: {\n        type: Sequelize.INTEGER\n      },\n      bookId: {\n        type: Sequelize.INTEGER,\n        references: {\n          model: {\n            tableName: 'Books'\n          },\n          key: 'id'\n        },\n        allowNull: false\n      },\n      createdAt: {\n        allowNull: false,\n        type: Sequelize.DATE\n      },\n      updatedAt: {\n        allowNull: false,\n        type: Sequelize.DATE\n      }\n    });\n  },\n  async down(queryInterface, Sequelize) {\n    await queryInterface.dropTable('BookSections');\n  }\n};\n```\n\n```\n$ npx sequelize db:migrate\n```\n\n### 3. Add Parent Section Reference\n1. generate migration\n```\n$ npx sequelize migration:generate --name add-parent-book-section\n```\n\n2. Fill in migration\n```\nmodule.exports = {\n  async up (queryInterface, Sequelize) {\n     return await queryInterface.addColumn('BookSections', 'parentSectionId', {\n       type: Sequelize.INTEGER,\n       references: {\n          model: {\n            tableName: 'BookSections'\n          },\n          key: 'id'\n        }\n     })\n  },\n\n  async down (queryInterface, Sequelize) {\n     return queryInterface.removeColumn('BookSections', 'parentSectionId');\n  }\n};\n```\n\n3. Run migration\n```\n$ npx sequelize db:migrate\n```\n\n4. Modify the Model\n```\n\n```\n\n\n### 2. Seed Book Sections\n```\n$ npx sequelize seed:generate --name first-book-sections\n```\n\n\n### 2. List Book Sections\n\n### Resources\nAssociations in the model definition: https://sequelize.org/docs/v6/core-concepts/model-basics/#column-declaration-shorthand-syntax",
        "sectionType": "section",
        "sequence": 2,
        "parentSection": {
          "parentSectionPart": 3,
          "parentSectionType": "chapter",
          "parentSectionSequence": 1
        }
      }
    ]
  },
  {
    "title": "Book Catalog",
    "slug": "Book-Catalog",
    "content": "<h2 id=\"bookcatalog\">Book Catalog</h2><p>A book catalog will list book, text resources. Each book will have a title, author, description, and blurb for display purposes. Each book will also have a slug which will be used for routing purposes. Each book will be accesible at a route <code>/books/&lt;book-slug&gt;</code>, where <code>book-slug</code> is dynamic per book.</p><p>Each book will be composed of parts. Each part will have futher sub-parts. This resembles the structure of book, part, chapter, chapter section, etc. while allowing the developer (and authors) to add however many nested sub-parts. To accomplish the relation of part to child-part, a parent key will be recorded on the child part. A list of all child parts for a given book part can be found by querying for all resourcess with a parent key matching the primary key of the interested book part.</p>",
    "sectionType": "chapter",
    "sequence": 1,
    "parentSection": {
      "parentSectionPart": 3,
      "parentSectionType": "part",
      "parentSectionSequence": 3
    }
  },
  {
    "title": "Book Resource",
    "slug": "book-resource",
    "content": "<h2 id=\"thebookresource\">The Book Resource</h2><h3 id=\"1createthebookdatamodel\">1. Create the Book Data Model</h3><ol><li>Generate the book model</li></ol><pre><code>npx sequelize model:generate --name Book --attributes title:string,author:string,description:text,blurb:text,slug:string</code></pre><ol start=\"2\"><li>Seed the database</li></ol><pre><code> npx sequelize seed:generate --name first-book</code></pre><pre><code class=\"javascript language-javascript\">const { Op } = require(\"sequelize\");const { Book } = require('../../app/models');const books = [{  title: 'Build a SmartSite',  author: 'Popular Demand',  description: 'A step-by-step guide to creating a dynamic website using Node.js.',  blurb: 'A step-by-step guide to creating a dynamic website using Node.js.',  slug: 'build-a-smartsite',  createdAt: new Date(),  updatedAt: new Date()}];module.exports = {  async up (queryInterface, Sequelize) {     await queryInterface.bulkInsert('Books', books, {});  },  async down (queryInterface, Sequelize) {     await queryInterface.bulkDelete('Books', {      title: {        [Op.eq]: books[0].title      }     }, {});  }};</code></pre><pre><code>npx sequelize-cli db:seed:all</code></pre><h3 id=\"2allbooksindexpage\">2. All Books index page</h3><ol><li>Create Books index route</li></ol><pre><code>const { Post, Click, Book } = require('./app/models');app.get('/books', async function(request, response) {  const books = await Book.findAll();  response.render('books/index', { books });});</code></pre><ol start=\"2\"><li>Create Books index view</li></ol><pre><code>{% layout 'layouts/default-html.liquid' %}{% block content %}&lt;div&gt;  &lt;h1&gt;Books&lt;/h1&gt;  {% for book in books %}    &lt;h2&gt;{{ book.title }}&lt;/h2&gt;    &lt;p&gt;&lt;i&gt;{{ book.author }}&lt;/i&gt;&lt;/p&gt;    &lt;p&gt;{{ book.blurb }}&lt;/p&gt;  {% else %}    &lt;p&gt;&lt;i&gt;There are no books to display.&lt;/i&gt;&lt;/p&gt;  {% endfor %}&lt;/div&gt;{% endblock %}</code></pre><pre><code>&lt;li&gt;&lt;a href=\"/books\"&gt;Books&lt;/a&gt;&lt;/li&gt;</code></pre><p>Books page is available at <code>localhost:3000/books</code>.</p><h3 id=\"3onebookshowpage\">3. One Book show page</h3><ol><li>Create show route for single Book</li></ol><pre><code>app.get('/books/:slug', async function(request, response, next) {  const book = await Book.findOne({ where: { slug: request.params.slug }});  if (book == null) {    // handling if a book is not found is covered next  }  response.render('books/show', { book });});</code></pre><ol start=\"2\"><li>Create Book show view</li></ol><pre><code>{% layout 'layouts/default-html.liquid' %}{% block content %}&lt;div&gt;  &lt;h1&gt;{{ book.title }}&lt;/h1&gt;  &lt;p&gt;&lt;i&gt;{{ book.author }}&lt;/i&gt;&lt;/p&gt;  &lt;p&gt;{{ book.description }}&lt;/p&gt;&lt;/div&gt;{% endblock %}</code></pre><ol start=\"3\"><li>Link to the book show page</li></ol><pre><code>&lt;a href=\"/books/{{ book.slug }}\"&gt;  &lt;span class=\"book-panel\"&gt;    &lt;h2&gt;{{ book.title }}&lt;/h2&gt;    &lt;p&gt;&lt;i&gt;{{ book.author }}&lt;/i&gt;&lt;/p&gt;    &lt;p&gt;{{ book.blurb }}&lt;/p&gt;  &lt;/span&gt;&lt;/a&gt;</code></pre><h3 id=\"4404notfoundroute\">4. 404 - Not Found Route</h3><ol><li>Handle if a book is not foundSet the response status to <code>404</code>, and forward the request to the next middleware.</li></ol><pre><code>app.get('/books/:slug', async function(request, response, next) {  const book = await Book.findOne({ where: { slug: request.params.slug }});  if (book == null) {    response.status(404);    next();    return;  }  response.render('books/show', { book });});</code></pre><ol start=\"2\"><li>Create a 404 middleware</li></ol><pre><code>app.use(function(request, response, next) {  if (response.statusCode === 404) {    response.render('404');    return;  }  next();});</code></pre><ol start=\"3\"><li>Create a 404 view template</li></ol><pre><code>{% layout 'layouts/default-html.liquid' %}{% block content %}&lt;div&gt;  &lt;h1&gt;Not Found&lt;/h1&gt;  &lt;p&gt;    The requested resource was not found.  &lt;/p&gt;&lt;/div&gt;{% endblock %}</code></pre><h3 id=\"5addbreadcrumbs\">5. Add Breadcrumbs</h3><p>Add breadcrumbs to the show page.</p><pre><code>&lt;div class=\"breadcrumbs\"&gt;  &lt;a href=\"/books\"&gt;Books&lt;/a&gt; &gt; {{ book.title }}&lt;/div&gt;</code></pre>",
    "sectionType": "section",
    "sequence": 1,
    "parentSection": {
      "parentSectionPart": 3,
      "parentSectionType": "chapter",
      "parentSectionSequence": 1
    }
  },
  {
    "title": "Book Part Resource",
    "slug": "book-part-resource",
    "content": "<h2 id=\"thebookdivisonresource\">The Book Divison Resource</h2><p>BookPart</p><ul><li>title</li><li>slug</li><li>content</li><li>sectionType</li><li>sequence</li><li>parent_part</li><li>book</li></ul><h3 id=\"1createthedatamodel\">1. Create the Data Model</h3><ol><li>Generate model</li></ol><pre><code>npx sequelize model:generate --name BookSection --attributes title:string,slug:string,content:text,sectionType:string,sequence:integer,bookId:integer</code></pre><ol start=\"2\"><li>Customize generated filesCustomize the generated model and migration files to refect the Book to Book Section one-to-many relatonship.model file:</li></ol><pre><code>const {  Model} = require('sequelize');module.exports = (sequelize, DataTypes) =&gt; {  class BookSection extends Model {    static associate(models) {      BookSection.belongsTo(models.Book, { foreignKey: 'bookId' });    }  }  BookSection.init({    title: DataTypes.STRING,    slug: DataTypes.STRING,    content: DataTypes.TEXT,    sectionType: DataTypes.STRING,    sequence: DataTypes.INTEGER,    bookId: {      type: DataTypes.INTEGER,      references: {        model: 'Books',        key: 'id'      }    },    parentSectionId: {      type: DataTypes.INTEGER,      references: {        model: 'BookSections',        key: 'id'      }    }  }, {    sequelize,    modelName: 'BookSection',  });  return BookSection;};</code></pre><p>migration, changes to slug and bookId:</p><pre><code>module.exports = {  async up(queryInterface, Sequelize) {    await queryInterface.createTable('BookSections', {      id: {        allowNull: false,        autoIncrement: true,        primaryKey: true,        type: Sequelize.INTEGER      },      title: {        type: Sequelize.STRING      },      slug: {        type: Sequelize.STRING,        allowNull: false      },      content: {        type: Sequelize.TEXT      },      sectionType: {        type: Sequelize.STRING      },      sequence: {        type: Sequelize.INTEGER      },      bookId: {        type: Sequelize.INTEGER,        references: {          model: {            tableName: 'Books'          },          key: 'id'        },        allowNull: false      },      createdAt: {        allowNull: false,        type: Sequelize.DATE      },      updatedAt: {        allowNull: false,        type: Sequelize.DATE      }    });  },  async down(queryInterface, Sequelize) {    await queryInterface.dropTable('BookSections');  }};</code></pre><pre><code>$ npx sequelize db:migrate</code></pre><h3 id=\"3addparentsectionreference\">3. Add Parent Section Reference</h3><ol><li>generate migration</li></ol><pre><code>$ npx sequelize migration:generate --name add-parent-book-section</code></pre><ol start=\"2\"><li>Fill in migration</li></ol><pre><code>module.exports = {  async up (queryInterface, Sequelize) {     return await queryInterface.addColumn('BookSections', 'parentSectionId', {       type: Sequelize.INTEGER,       references: {          model: {            tableName: 'BookSections'          },          key: 'id'        }     })  },  async down (queryInterface, Sequelize) {     return queryInterface.removeColumn('BookSections', 'parentSectionId');  }};</code></pre><ol start=\"3\"><li>Run migration</li></ol><pre><code>$ npx sequelize db:migrate</code></pre><ol start=\"4\"><li>Modify the Model</li></ol><pre><code></code></pre><h3 id=\"2seedbooksections\">2. Seed Book Sections</h3><pre><code>$ npx sequelize seed:generate --name first-book-sections</code></pre><h3 id=\"2listbooksections\">2. List Book Sections</h3><h3 id=\"resources\">Resources</h3><p>Associations in the model definition: https://sequelize.org/docs/v6/core-concepts/model-basics/#column-declaration-shorthand-syntax</p>",
    "sectionType": "section",
    "sequence": 2,
    "parentSection": {
      "parentSectionPart": 3,
      "parentSectionType": "chapter",
      "parentSectionSequence": 1
    }
  }
]
